{"version":3,"sources":["ads/ads.js","deals/deals.js","dropdown/dropdown.js","footer/footer.js","header/browse-menu.js","header/header.js","login/login.js","login/sidebar-login.js","loyalty/loyalty.js","nav/nav.js","onload/list-onload.js","onload/onload.js","onload/pdp-onload.js","plugins/carousel.js","plugins/slider.js","plugins/tinysort.js","pricegraph/pricegraph.js","pricetable/gts.js","pricetable/pricetable.js","pricetable/sidebar-pricetable.js","product-detail/product-detail.js","product-item/product-item.js","product-list/list.js","promo-banner/promo-banner.js","qna/qna-search.js","qna/qna.js","recently-viewed/recently-viewed.js","reviews/expert-review.js","reviews/user-reviews.js","search/search.js","session/session.js","videos/videos.js","site-utils/page-events/page-events-actions.js","site-utils/page-events/scroll.js","site-utils/popout/popout.js","site-utils/popup/popup.js","site-utils/tooltip/tooltip.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5mCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACr4CA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACntBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5jBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all-non-module-components.js","sourcesContent":["/* Decide whether to show or hide sidebar ads */\n;\n(function sidebarAdsHandler() {\n    var sidebarAds = function(gptId) {\n            return [\n                /* '<div class=\"ad-sdbr__cls\">&times;</div>', */\n                '<div id=\"' + gptId + '\" style=\"height:600px; width:120px;\">',\n                '<script> googletag.cmd.push(function() { googletag.display(\"' + gptId + '\"); }); </script>',\n                '</div>'\n            ].join('');\n        },\n        sideFreeSpace = window.innerWidth - 1000,\n        adWidth = 120,\n        adMarginFromCenter = 500 + Math.max(10, Math.min(40, (sideFreeSpace / 2 - adWidth) / 2));\n\n    if (!Modules.Cookie.get('hideSidebarAds')) {\n        var $leftAd = $('.ad-sdbr--left'),\n            $rightAd = $('.ad-sdbr--rght');\n        $leftAd.append(sidebarAds($leftAd.data('id')));\n        $rightAd.append(sidebarAds($rightAd.data('id')));\n        $leftAd.css('margin-right', adMarginFromCenter + 'px');\n        $rightAd.css('margin-left', adMarginFromCenter + 'px');\n        $('.ad-sdbr__cls').on('click', function() {\n            setCookie('hideSidebarAds', 1, 1);\n            $('.ad-sdbr').remove();\n        });\n    }\n})();","Modules.$doc.ready(function() {\n    $(\".js-shr-dl\").on(\"click\", function() {\n        var tltp = $(\".prdct-dtl__tlbr-shr-tltp\");\n        tltp.toggleClass(\"hide\");\n    });\n});\n\n//Capturing Email for newletter (from eight sidebar widger)\n$('.cptr-eml-card__btn').click(function() {\n    if (!$(this).hasClass('btn--red')) {\n        return false;\n    };\n    var $emailbox = $(this).closest('.cptr-eml-card__frm');\n    var email = $emailbox.find('.cptr-eml-card__inpt').val();\n    var emailRegex = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    if (!emailRegex.test(email)) {\n        alert(\"Please enter a valid Email ID.\");\n        return false;\n    }\n    var url;\n    if ($('.algn-wrpr__dls').length || $(\".prdct-dtl--deal\").length) {\n        url = '/deals/save_email.php';\n    } else {\n        url = 'http://www.mysmartprice.com/fashion/promotion/capture_email';\n    }\n    var page_url = window.location.href;\n    $.ajax({\n        'url': url,\n        'type': 'POST',\n        'data': {\n            \"email\": email,\n            \"page_url\": page_url,\n            \"type\": 'sidebar'\n        },\n    }).done(function(response) {\n        // if (response.data == \"SUCCESS\") {\n        $emailbox.find('.cptr-eml-card__inpt-wrpr').hide();\n        $emailbox.find('.cptr-eml-card__msg').hide();\n        $emailbox.find('.cptr-eml-card__alt-msg.sccss-msg').show();\n        $emailbox.find('.btn--red').html('Subscribed');\n        $emailbox.find('.btn--red').removeClass('btn--red');\n\n        if ($emailbox.parents().hasClass(\"prdct-dtl__deal-sbscrb\")) {\n            $emailbox.html(\"\");\n            $(\".prdct-dtl__deal-sbscrb__lbl\").html(\"Email Subscribed Successfully!\");\n\n        }\n\n    }).fail(function(response) {\n        $emailbox.find('.cptr-eml-card__inpt-wrpr').hide();\n        $emailbox.find('.cptr-eml-card__msg').hide();\n        $emailbox.find('.cptr-eml-card__alt-msg.err-msg').show();\n        $emailbox.find('.btn--red').html('Not Subscribed');\n        $emailbox.find('.btn--red').removeClass('btn--red');\n    });\n    return false;\n});","headerDropdownsHandlers();\n\nModules.$doc.on(\"click\", hideDropdownContent)\n    .on(\"click\", \".dropdown .btn-dropdown\", toggleDropdownContent);\n    \nfunction headerDropdownsHandlers() {\n    var menuShowTimeout;\n    Modules.$doc.on('click', 'body, .js-ctgry-btn, .js-drpdwn-menu-wrpr', function(e) {\n        var data, time, now, diffTime, loadingTimeout;\n\n        e.stopPropagation();\n\n        if (!$('.drpdwn-menu-wrpr--show').length && $(this).hasClass(\"js-ctgry-btn\")) {\n            $('.js-drpdwn-menu-wrpr').addClass('drpdwn-menu-wrpr--show');\n            $('.js-drpdwn-menu-ovrly').addClass('drpdwn-menu-ovrly--show');\n            if (Modules.$win.height() < $(\".drpdwn-menu\").height() + $('.js-drpdwn-menu-wrpr').offset().top) {\n                $(\".js-drpdwn-menu-wrpr\").addClass(\"drpdwn-menu-wrpr--s\");\n            }\n            if ($('.drpdwn-menu').data('processed') == 'done' && location.hash !== '#forcepopup') {\n                menuShowTimeout = setTimeout(function() {\n                    $('.drpdwn-menu').addClass('drpdwn-menu--show');\n                }, 340);\n                return; //if already procesed\n            }\n\n            if (localStorage && location.hash !== '#forcepopup') {\n                //check if data is not one week old\n                time = parseInt(localStorage.browsePopupDataTime, 10);\n                now = new Date().getTime();\n                diffTime = (now - time) / (1000 * 60 * 60 * 24);\n\n                if (diffTime < 30 && localStorage.browsePopupDataVer == $('.js-drpdwn-menu-wrpr').data('ver')) {\n                    //getting data from localStorage\n                    data = localStorage.browsePopupData;\n                }\n            }\n\n            if (!data || data == 'undefined' || data === undefined) {\n                loadingTimeout = setTimeout(function() {\n                    $('.js-drpdwn-menu-wrpr').find('.drpdwn-menu-wrpr__ldng').show();\n                }, 600);\n                data = getBrowsePopupData();\n                localStorage.browsePopupData = data;\n                localStorage.browsePopupDataTime = new Date().getTime();\n                localStorage.browsePopupDataVer = $('.js-drpdwn-menu-wrpr').data('ver');\n                // if data is not avaialble in localStorage do ajax and save in localStorage for later use\n            }\n            if (data && data != 'undefined' && data !== undefined) {\n                $('.drpdwn-menu').html(data).data('processed', 'done');\n                menuShowTimeout = setTimeout((function() {\n                    $('.js-drpdwn-menu-wrpr').find('.drpdwn-menu-wrpr__ldng').hide();\n                    clearTimeout(loadingTimeout);\n                    $('.drpdwn-menu').addClass('drpdwn-menu--show');\n                }), 340);\n                // on data available hide loading and show data\n            }\n        } else if (!$(this).hasClass('js-drpdwn-menu-wrpr')) {\n            clearTimeout(menuShowTimeout);\n            $('.js-drpdwn-menu-wrpr').removeClass('drpdwn-menu-wrpr--show');\n            $('.drpdwn-menu').removeClass('drpdwn-menu--show');\n            $('.js-drpdwn-menu-ovrly').removeClass('drpdwn-menu-ovrly--show');\n            $('.js-drpdwn-menu-wrpr').find('.drpdwn-menu-wrpr__ldng').hide();\n        }\n    });\n}\n\nfunction hideDropdownContent() {\n    $(\".dropdown .dropdown-content\").addClass(\"hide\");\n}\n\nfunction toggleDropdownContent() {\n    $(\".dropdown .dropdown-content\").toggleClass(\"hide\");\n    return false;\n}","// New footer setup and event handlers:\n(function initFooter() {\n    var footerEmailInput = $('.js-ftr-eml-inpt'),\n        footerEmailSubmit = $('.ftr__lylty__eml-wrpr-sbmt');\n\n    /* Opens Login Popup: To be called only when user is logged out (or partial login) */\n    function footerLogin($this) {\n        var _email = $this.val();\n        if (!Modules.Validator.email(_email)) {\n            alert('Please enter a valid email address');\n        } else {\n            var partiallyLoggedIn = Modules.Cookie.get('partial_login');\n            if (!partiallyLoggedIn) {\n                popupDataObj = {\n                    type: \"signup\"\n                };\n            }\n            // Set Email Cookie to prefill input on popup:\n            setCookie('msp_login_email', _email);\n            openPopup('/users/login.html');\n        }\n    }\n\n    if (footerEmailInput.length) {\n        var savedEmail = Modules.Cookie.get('msp_login_email'),\n            loggedIn = Modules.Cookie.get('msp_login');\n\n        if (loggedIn) { // Show different message if logged in\n            var $ftrLoyaltyInfoHead = $('.js-lylty-info-hdr'),\n                $ftrLoyaltyInfoSteps = $('.js-lylty-info-stps'),\n                $ftrLoyaltyEmailWrapper = $('.js-ftr-eml-wrpr'),\n                $ftrLoyaltyStatsWrapper = $('.js-ftr-stats-wrpr');\n\n            $ftrLoyaltyInfoHead.html('Congratulations! You\\'re already a Cashback Program member.');\n            $ftrLoyaltyInfoSteps.html([\n                'Shop &rarr; Earn Cashback &rarr; Transfer to your Bank A/c ',\n                '<span class=\"ftr__lylty__txt-link js-open-link\" data-open-link=\"/cashback/more-details/?ref=desktop_footer\">Know more.</span>'\n            ].join(''));\n            $ftrLoyaltyEmailWrapper.hide();\n            $ftrLoyaltyStatsWrapper.replaceWith([\n                '<div data-href=\"/users/login.html\" class=\" bttn bttn--scndry ftr__lylty__view-cshbk js-lylty-login js-open-link\" data-open-link=\"/loyalty/\">',\n                'View your cashback',\n                '</div>'\n            ].join(''));\n        } else {\n            if (savedEmail) footerEmailInput.val(savedEmail);\n\n            // Event Handlers:\n            footerEmailInput.on('keyup', function(e) {\n                if (e.keyCode === 13) { // \"Enter\" key's code is 13\n                    footerLogin(footerEmailInput);\n                }\n                return false;\n            });\n            footerEmailSubmit.on('click', function() {\n                footerLogin(footerEmailInput);\n                return false;\n            });\n        }\n    }\n})();","\n/* RUI:: added classes of new UI to the existing handlers - start */\n// binding keys start here\nModules.$doc.keyup(function(e) {\n    if (e.keyCode == 27) { //esc button\n        if ($('.browse-popup-cont.show, .drpdwn-menu-ovrly--show').length !== 0) {\n            $('.browse-menu-btn .js-ctgry-btn').click(); //if browse menu is displayed close it  \n        }\n        if ($('.popup-overlay').length !== 0) {\n            $('.popup-overlay').click(); //if popup is displayed close it\n        }\n\n        if ($(\".pop-up__cls-btn\")[0]) {\n            $link = $(\".pop-up__cls-btn > a\");\n            if ($link[0]) {\n                window.open($link.attr('href'), '_blank');\n            }\n            $link.trigger(closePopup_RUI());\n        }\n    }\n});\n\nModules.$doc.keydown(function(e) {\n    if (e.altKey) { // checking for alt key\n        var key = String.fromCharCode(e.keyCode).toLowerCase();\n        switch (key) {\n            case 'c':\n                {\n                    $('.browse-menu-btn, .js-ctgry-btn').click();\n                    break;\n                }\n            case 's':\n                {\n                    $('.srch-wdgt__fld').focus();\n                    break;\n                }\n        }\n    }\n});\n// binding keys end here\n/* RUI:: added classes of new UI to the existing handlers - start */\n\n// **START** \n// OLD MSP.JS CODE --> Category dropdown: browse menu --> for old headers on non-comparables pages\n// KEPT FOR COMPATIBILITY.\n// browse menu processing start here\nModules.$doc.ready(function() {\n    Modules.$doc.on('click', '.browse-menu-btn, .browse-popup-cont', function(e) {\n        var left = $('.browse-menu-btn')\n            .offset()\n            .left;\n        $('.browse-popup')\n            .css('left', left)\n            .toggleClass('show');\n        $('.browse-popup-cont')\n            .toggleClass('show');\n        if ($('.browse-popup.show')\n            .length !== 0) {\n\n            if ($('.browse-popup-data')\n                .data('processed') == 'done' && location.hash !== '#forcepopup') {\n                setTimeout((function() {\n                    $('.browse-popup')\n                        .find('.loading-circle')\n                        .hide();\n                    $('.browse-popup-data')\n                        .addClass('show');\n                }), 340);\n                return; //if already procesed\n            }\n\n            var data;\n\n            if (localStorage && location.hash !== '#forcepopup') {\n\n                //check if data is not one week old\n                var time = parseInt(localStorage.browsePopupDataTime, 10),\n                    now = new Date()\n                    .getTime(),\n                    diffTime = (now - time) / (1000 * 60 * 60 * 24);\n\n                if (diffTime < 30 && localStorage.browsePopupDataVer == $('.browse-popup-data')\n                    .data('ver')) {\n                    //getting data from localStorage\n                    data = localStorage.browsePopupData;\n                }\n\n            }\n\n            if (!data || data == 'undefined' || data === undefined) {\n                $('.browse-popup')\n                    .find('.loading-circle')\n                    .show();\n                data = getBrowsePopupData();\n                localStorage.browsePopupData = data;\n                localStorage.browsePopupDataTime = new Date()\n                    .getTime();\n                localStorage.browsePopupDataVer = $('.browse-popup-data')\n                    .data('ver');\n                // if data is not avaialble in localStorage do ajax and save in localStorage for later use\n            }\n            if (data && data != 'undefined' && data !== undefined) {\n                $('.browse-popup-data')\n                    .html(data)\n                    .data('processed', 'done');\n                setTimeout((function() {\n                    $('.browse-popup')\n                        .find('.loading-circle')\n                        .hide();\n                    $('.browse-popup-data')\n                        .addClass('show');\n                }), 340);\n                // on data available hide loading and show data\n            }\n\n        } else {\n            $('.browse-popup-data')\n                .removeClass('show');\n        }\n    });\n\n    Modules.$doc.on('click', '.browse-popup', function(e) {\n        e.stopPropagation();\n    });\n    // browse menu processing end here\n\n    // // browse popup functions start here\n    function getBrowsePopupData() {\n        return getAjaxDataSync(\"/old_browse-menu.htm\");\n    }\n    // browse popup functions end here\n\n    // ajax functions start here\n    function getAjaxDataSync(ajaxURL) {\n        var ajaxData;\n        $.ajax({\n            url: ajaxURL,\n            async: false\n        }).done(function(data) {\n            ajaxData = data;\n        });\n        return ajaxData;\n    }\n    // ajax functions end here\n});\n","(function headerSPEvent() {\n\n    Modules.$doc.on('click', '.js-lylty-hdr', function() {\n        var partialLogin = Modules.Cookie.get(\"partial_login\");\n\n        var gaEvent = partialLogin ? \"Partial-Login-Click\" : \"Loyalty-Header-Click\";\n\n        window.ga && ga(\"send\", \"event\", \"Loyalty\", gaEvent, Modules.Cookie.get(\"msp_uid\") || \"\");\n\n    })\n})();","var url = new Modules.Url(); // Common for the whole bundle\n\n(function signupDestUrlAppending() {\n    var $this = $('.usr-inputbox__optns-link--dlmtr');\n    if ($this.length && url.getAQueryParam('destUrl')) {\n        var rdrctUrl = url.getAQueryParam('destUrl');\n        rdrctUrl = url.getAQueryParam('utm_source') ? rdrctUrl + \"&utm_source=\" + url.getAQueryParam('utm_source') : rdrctUrl;\n        var crntUrl = $this.attr(\"href\");\n        $this.attr(\"href\", crntUrl + \"?destUrl=\" + encodeURIComponent(rdrctUrl));\n        return;\n    } else {\n        return;\n    }\n})();\n\nvar loginCallbackQueue = [];\n\nvar MSP = {};\n\nfunction loginCallback(fn, context, params) {\n    if (Modules.Cookie.get(\"msp_login\") == \"1\") {\n        fn.apply(context, params);\n    } else {\n        loginCallbackQueue.push(function() {\n            fn.apply(context, params);\n        });\n        $(\".js-lgn\").eq(0).click();\n    }\n}\n\nfunction isUserPasswordExist(userEmail) {\n\n    var dfd = $.Deferred();\n    $.ajax({\n        \"url\": \"/users/login_common.php\", //\"/users/usermanage.php\",\n        \"type\": \"POST\",\n        dataType: \"JSON\",\n        \"data\": {\n            \"email\": encodeURIComponent(userEmail),\n            \"process\": \"query_password\",\n            \"login_type\": \"isUserPasswordExist\"\n        }\n    }).done(function(response) {\n        dfd.resolve(response);\n    });\n\n    return dfd.promise();\n}\n\n\nvar extnsnWlcmPage = {};\n\nif ($(\".demo-login\").length) {\n    extnsnWlcmPage = {\n        changeMessage: function() {\n            var pluginInstallSource = Modules.Cookie.get(\"pluginInstallSource\"),\n                installationMessage = \"\";\n\n            if (Modules.Cookie.get(\"msp_login\")) {\n                installationMessage = \"Get Cashback on Every Purchase via MySmartPrice <a class='demo__knw-more' href='http://www.mysmartprice.com/loyalty/?ref=welcome#tabOpen=how_it_works'>Know More</a>\";\n                $(\".demo-login .demo-signup__form\").hide();\n                if (pluginInstallSource && (pluginInstallSource === \"deal-comparables\" || pluginInstallSource === \"pluginCashback\")) {\n                    installationMessage = \"Complete Purchase via MySmartPrice and Get Cashback\";\n                }\n            } else {\n                installationMessage = \"Signup and Get Rs.25<span class='demo-login__hdr-offr'>Cashback</span>\";\n                $(\".demo-login .demo-signup__form\").show();\n                if (pluginInstallSource && (pluginInstallSource === \"deal-comparables\" || pluginInstallSource === \"pluginCashback\")) {\n                    installationMessage = \"Signup to Get Cashback\";\n                }\n            }\n\n            $(\".demo-login .demo-login__hdr-cntnt\").html(installationMessage);\n        },\n        signupFormValidator: function() {\n            var $email = $('#demo-signup__email'),\n                $password = $('#demo-signup__password'),\n                $errorNode = $(\".demo-login div.error\");\n            MSP.utils.validate.form([{\n                \"type\": \"email\",\n                \"inputField\": $email,\n                \"errorNode\": $errorNode,\n                \"errorMsg\": \"Please enter a valid email\"\n            }, {\n                \"type\": \"required\",\n                \"inputField\": $password,\n                \"errorNode\": $errorNode,\n                \"options\": { \"min\": 6 },\n                \"errorMsg\": \"Password must be atleast 6 characters long\"\n            }]).done(function() {\n                captureEmail($email.val());\n                var loylaty_utm_source = url.getAQueryParam('utm_source') ? url.getAQueryParam('utm_source') : utmsource;\n                if ($(\".js-chrm-wlcm\").length || $(\".wlcm-hdr\").length) {\n                    loylaty_utm_source = \"chrome welcome\";\n                }\n\n                $.ajax({\n                    type: \"POST\",\n                    url: \"/users/login_common.php\", //\"/users/usermanage.php\"\n                    dataType: \"JSON\",\n                    async: false,\n                    data: {\n                        process: 'signup',\n                        email: encodeURIComponent($email.val()),\n                        password: $password.val(),\n                        subscribed_status: 'subscribed',\n                        source: 'desktop',\n                        login_type: 'signup',\n                        number: \"\",\n                        utm_source: loylaty_utm_source\n                    }\n                }).done(function(msg) {\n                    if (msg == \"error\" || msg.auth.result.msg == 'error') {\n                        $errorNode.html(\"There is some error in signup. Please try after sometime\");\n                        if (Modules.Cookie.get('u99rs1deal')) {\n                            alert('Unable to login. Please check credentials'); // Alert to bring back focus to current tab (Not GTS tab)\n                        }\n                    } else {\n                        if (msg.auth.result.msg == 'true') {\n                            setCookie(\"chrome_extension_welcome\", \"1\", 1);\n                            loginme(msg);\n                            closePopup();\n                        } else {\n                            $errorNode.html(msg.auth.result.msg + \". <a class='js-popup-trgt demo-login__link' data-href='/users/login.html'>Click here to login</a>\");\n                            $errorNode.show();\n                        }\n                    }\n                    return false;\n                });\n            });\n            return false;\n        },\n        eventHandlers: function() {\n            $(\".demo-signup__email\").change(function() {\n                $(\".demo-signup__email\").blur(function() {\n                    $this = $(this);\n                    if (Modules.Validator.email($this.val())) {\n                        $this.removeClass(\"hghlght-err-fld\");\n                        !$(\".demo-signup__form .hghlght-err-fld\").length && $(\".demo-signup__form div.error\").text(\"\");\n                    } else {\n                        $this.addClass(\"hghlght-err-fld\");\n                        $(\".demo-signup__form div.error\").text(\"Please enter a valid email\");\n                    }\n                });\n            });\n            $('.demo-signup__password').on('change', function() {\n                $('.demo-signup__password').on('blur', function() {\n                    $this = $(this);\n                    if (Modules.Validator.required($this.val())) {\n                        $this.removeClass(\"hghlght-err-fld\");\n                        !$(\".demo-signup__form .hghlght-err-fld\").length && $(\".demo-signup__form div.error\").text(\"\");\n                    } else {\n                        $this.addClass(\"hghlght-err-fld\");\n                        $(\".demo-signup__form div.error\").text(\"Please enter a password\");\n                    }\n                });\n            });\n            $('.demo-signup__submit').click(function(e) {\n                e.preventDefault();\n                extnsnWlcmPage.signupFormValidator();\n            });\n        },\n        init: function() {\n            this.eventHandlers();\n        }\n    }\n}\n\nfunction windowLogin(pageType, queryParams){\n    var pageURL = \"https://www.mysmartprice.com/users/\";\n\n    if (pageType == \"signup\") {\n        pageURL = \"https://www.mysmartprice.com/users/signup.php\";\n    } else if (pageType == \"login\") {\n        pageURL = \"https://www.mysmartprice.com/users/login.php\";\n    }\n    newWindow = window.open(pageURL + queryParams);\n    window.addEventListener(\"message\", receiveMessage, false);\n}\n\n\nModules.$doc.on(\"click\", \".js-lgn\", function() {\n    var windowParams = \"?destUrl=\" + encodeURIComponent(window.location.href);\n    if ((window.screenTop || window.screenY)) {\n        windowParams += \"&close=1\";\n    }\n    windowLogin($(this).data(\"page\"), windowParams);\n});\n\nfunction receiveMessage(event) {\n    if(event.origin==\"https://www.mysmartprice.com\" && event.data==\"update_ui\"){\n        postLogin();\n    }\n}\n\nfunction postLogin() {\n    newWindow.close();\n    update_ui();\n}\n\nfunction update_ui() {\n\n    var defaultLoginName = \"My Account\",\n        partial_login = Modules.Cookie.get(\"partial_login\"),\n        msp_login = Modules.Cookie.get(\"msp_login\"),\n        new_user = Modules.Cookie.get(\"new_user\"),\n        msp_user_image = Modules.Cookie.get(\"msp_user_image\"),\n        msp_login_name = Modules.Cookie.get(\"msp_login_name\") || \"\",\n        msp_login_email = Modules.Cookie.get(\"msp_login_email\") || \"\",\n        userLinks = [\n            '<div class=\"user-link\">',\n            '<div class=\"drpdwn-wdgt__item user-link__rwrds js-open-link\" data-open-link=\"/loyalty\">',\n            '<span class=\"user-link__icon-rwrds\"></span> My Cashback</div>',\n            '<div class=\"drpdwn-wdgt__item user-link__rfr js-open-link\" data-open-link=\"/promotions/refer/?ref=header_nav\">',\n            '<span class=\"user-link__icon-rfr\"></span> Refer &amp; Earn</div>',\n            '</div>'\n        ].join(\"\"),\n        partialLoginUserLinks = [\n            '<div class=\"user-link js-prtl-lgn\">',\n            '<div class=\"drpdwn-wdgt__item user-link__rwrds js-open-link\" data-need-login=\"true\" data-open-link=\"/loyalty\">',\n            '<span class=\"user-link__icon-rwrds\"></span> My Cashback</div>',\n            '<div class=\"drpdwn-wdgt__item user-link__rfr js-open-link\" data-need-login=\"true\" data-open-link=\"/promotions/refer/?ref=header_nav\">',\n            '<span class=\"user-link__icon-rfr\"></span> Refer &amp; Earn</div>',\n            '</div>'\n        ].join(\"\");\n\n    $(\".js-trck-sign-up\").show();\n    $(\".cshbck-str__top\").show();\n    $(\".cshbck-str__top-sign\").removeClass(\"hide\");\n    if (partial_login || msp_login) {\n        $(\".cshbck-str__top-sign\").addClass(\"hide\");\n        if (!Modules.Cookie.get(\"msp_loyalty_points\")) {\n            $.ajax({\n                url: '/users/get_msp_coins.php',\n                async: false,\n                type: \"POST\",\n                data: encodeURIComponent(msp_login_email)\n            }).done(function(result) {\n                result = JSON.parse(result);\n                if (result) {\n                    if (result[\"coins\"]) {\n                        // setting cookie for a day only\n                        // we need to check if the user is flagged or not daily\n                        setCookie(\"msp_loyalty_points\", result[\"coins\"], 1);\n                    }\n                    // check if the user is flagged\n                    // set cookie if the user is flagged\n                    if (result[\"may_4th\"]) {\n                        setCookie(\"may_4th\", \"712\", 30);\n                    }\n                }\n            });\n        }\n        $(\".js-trck-sign-up\").hide();\n        $(\".cshbck-str__top\").hide();\n    }\n\n    //Loyalty Experiment\n    var coinText = \"\",\n        coinSubText = \"\",\n        loyaltyPoints = $.trim(Modules.Cookie.get(\"msp_loyalty_points\")).replace(/\\D/g, \"\") || 0;\n    // Logged in and hideLoyaltyOnBoarded\n    if ((msp_login == \"1\" || partial_login) && Modules.Cookie.get(\"hideLoyaltyOnBoarded\")) {\n        coinText = '&#8377;<span class=\"js-lylty-pnts\">' + loyaltyPoints + '</span>';\n        coinSubText = 'in your account';\n    } else { // All other cases do not show amount\n        coinText = 'Upto 12%<br>Cashback';\n        coinSubText = 'on every purchase';\n    }\n\n    var hdrCoinsLoggedIn = [\n            '<div class=\"hdr__user\" style=\"display: block\">',\n            '<div class=\"hdr__call-out' + (Modules.Cookie.get(\"hideLoyaltyOnBoarded\") ? \" hdr__call-out--lgd-in\" : \"\") + ' js-lylty-hdr js-open-link\" data-need-login=\"true\" data-open-link=\"/loyalty/\">',\n            '<div class=\"hdr__call-out-ttl\">' + coinText + '</div>',\n            '<div class=\"hdr__call-out-sbttl\">' + coinSubText + '</div>',\n            '</div>',\n            '</div>'\n        ].join(''),\n        hdrCoinsLoggedOut = [\n            '<div class=\"hdr__user\" style=\"display: block\">',\n            '<div class=\"hdr__user-lgn btn btn--s btn--no-bg js-lgn\" data-page=\"login\">Login</div>',\n            '<div class=\"hdr__user-sign-up btn btn--s js-lgn\" data-page=\"signup\">Sign Up</div>',\n            '<div class=\"hdr__call-out js-lylty-hdr js-open-link\" data-open-link=\"/cashback/more-details/?utm_source=Loyalty-Header\">',\n            '<div class=\"hdr__call-out-ttl\">' + coinText + '</div>',\n            '<div class=\"hdr__call-out-sbttl\">' + coinSubText + '</div>',\n            '</div>',\n            '</div>'\n        ].join('');\n\n    if (msp_login == \"1\") {\n        while (loginCallbackQueue.length) {\n            (loginCallbackQueue.shift())();\n        }\n        \n        // [Start] Sidebar signup widget update \n        setCookie(\"partial_login\", \"\", -1);\n        $(\".sdbr-login\").length && sdbrWlcmPage.showCnfrmtn();\n        $(\".demo-login\").length && extnsnWlcmPage.changeMessage();\n\n        // [Start] changing contextual text and url of \"many more exciting gifts\" on how-it-works page\n        if ($(\".pnts-intro\")[0]) {\n            $(\".js-grid__text--sign-up\").removeClass(\"js-lgn js-popup-trgt\").attr(\"href\", \"/loyalty/#tabOpen=redemption\").removeAttr(\"data-href\").text(\"View all >>\");\n        }\n        // [End] changing contextual text and url of \"many more exciting gifts\" on how-it-works page\n\n        // [End] Sidebar signup widget update\n\n        $(\".hdr__user\").length && $(\".hdr__user\").replaceWith(hdrCoinsLoggedIn);\n        $(\".drpdwn-wdgt\").length && $(\".drpdwn-wdgt\").addClass('loggedIn').removeClass('loggedOut');\n\n        // If partial user is already login\n        if ($(\".user-dtls\").length) {\n            if ($(\".user-dtls\").html().indexOf(\"user-link\") < 0) {\n                $(\".user-nm-wrpr\").after(userLinks);\n            }\n        }\n\n        $(\".user-nm\").length && $(\".user-nm\").text(\"Hi\" + (msp_login_name ? \", \" + msp_login_name : \"\") + \"!\");\n        $(\".user-email\").length && $(\".user-email\").text(msp_login_email);\n        $(\".user-img\").length && $(\".user-img\").addClass(\"user-img--loggedin\");\n        if (msp_user_image) {\n            $(\".user-img\").length && $(\".user-img\").css(\"background-image\", 'url(' + msp_user_image + ')');\n        }\n        $(\".js-ftr-eml-wrpr\").hide();\n    } else if (partial_login) {\n        if (new_user == \"true\") {\n            isUserPasswordExist(msp_login_email).done(function(response) {\n                if (response.auth.result.msg == \"password_set\") {\n                    setCookie(\"new_user\", \"\", -1);\n                }\n            });\n        }\n\n        $(\".hdr__user\").length && $(\".hdr__user\").replaceWith(hdrCoinsLoggedIn);\n        $(\".drpdwn-wdgt\").length && $(\".drpdwn-wdgt\").addClass('loggedIn').removeClass('loggedOut');\n        $('.js-prtl-lgn')[0] ? $('.js-prtl-lgn').remove() : '';\n        $(\".user-nm-wrpr\").length && $(\".user-nm-wrpr\").after(partialLoginUserLinks).attr(\"data-need-login\", \"true\");\n        $(\".user-nm\").length && $(\".user-nm\").text(\"Hi\" + (msp_login_name ? \", \" + msp_login_name : \"\") + \"!\").attr(\"data-need-login\", \"true\");\n        $(\".user-email\").length && $(\".user-email\").text(msp_login_email).attr(\"data-need-login\", \"true\");\n        $(\".js-ftr-eml-wrpr\").show();\n    } else {\n        // [Start] Sidebar signup widget hide or show\n        $(\".sdbr-login\").length && sdbrWlcmPage.hideCnfrmtn();\n        $(\".demo-login\").length && extnsnWlcmPage.changeMessage();\n        // [End] Sidebar signup widget hide or show\n\n        $(\".hdr__user\").length && $(\".hdr__user\").replaceWith(hdrCoinsLoggedOut);\n        $(\".drpdwn-wdgt\").length && $(\".drpdwn-wdgt\").removeClass('loggedIn');\n        $(\".user-link\").length && $(\".user-link\").remove();\n        $(\".user-img\").length && $(\".user-img\").css(\"background-image\", '').removeClass(\"user-img--loggedin\");\n        $(\".js-ftr-eml-wrpr\").show();\n    }\n\n    setTimeout(function() {\n        $('.hdr__call-out').not('.hdr__call-out--lgd-in').addClass('slide-left');\n    }, 2000);\n}\n\nModules.$doc.on('mouseenter', '.drpdwn-wdgt', function() {\n    if (!$(this).hasClass('loggedIn')) {\n        $(\".drpdwn-wdgt\").addClass('loggedOut');\n    }\n});\n\nfunction loginme(msg) {\n    var responseInfo,\n        wiz_uid = get_uid(),\n        wiz_msg = '\"' + msg + '\"';\n\n    var loyalty_cookie = Modules.Cookie.get('msp_loyalty');\n    setCookie(\"msp_login\", \"1\", 365);\n\n    if (!loyalty_cookie) {  \n        setCookie(\"msp_loyalty\", \"1\", 365);\n    }\n    var msp_login = Modules.Cookie.get(\"msp_login\");\n\n    if (!(msg.auth.login_type == 'facebook' || msg.auth.login_type == 'gplus' || msg.auth.login_type == 'resetpass')) {\n        setCookie(\"msp_login_uid\", msg.auth.result.user_id, 365);\n        setCookie(\"msp_login_name\", msg.auth.result.user_name, 365);\n    }\n    setCookie(\"msp_login_email\", msg.auth.result.email_id, 365);\n    \n    if(msg.loyalty){\n        setCookie(\"msp_loyalty_points\", msg.loyalty.result.msp_coins, 1);\n        setCookie(\"hideLoyaltyOnBoarded\", msg.loyalty.result.onboarded, 365);\n    }\n    update_ui();\n\n    // Referral Logging.\n    if ($(\".body-wrpr\").data(\"page-type\") === 'refer') {\n        window.ga && ga('send', 'event', 'Refer', 'ReferralLoginAction');\n        setCookie('referralLoginReload', 1); // Cookie to prevent GA logging on reload.\n        window.location.reload(); // Reload the page so that refID for referral page is created for email.\n    }\n\n    if (dataLayer[0].pagetype === \"loyalty\") {\n        if (msg.loyalty.result.nonmsp_bonus_credited) { // If user haven't any account and eligible for nonmsp bonus\n            setCookieMins(\"nonmsp_bonus_credited\", msg.loyalty.result.nonmsp_bonus_credited, 20);\n        }\n        location.reload();\n    } else if ((msg.auth.login_type === \"signup\" || msg.auth.login_type === \"signup_loyalty\" || msg.auth.login_type === \"resetpass\" || msg.auth.login_type === \"facebook\" || msg.auth.login_type === \"gplus\") && !loyalty_cookie) {\n        if (msg.loyalty.nonmsp_bonus_credited) { // If user haven't any account and eligible for nonmsp bonus\n            setCookieMins(\"nonmsp_bonus_credited\", msg.loyalty.result.nonmsp_bonus_credited, 20);\n        }\n        if (Modules.Cookie.get(\"cb_instant\")) {\n            window.location.href = '/loyalty';\n        } else if (Modules.Cookie.get(\"u99rs1deal\")) {\n            window.location.href = '/loyalty';\n            deleteCookie('u99rs1deal');\n        } else {\n            if (!Modules.Cookie.get(\"chrome_extension_welcome\") && !url.getAQueryParam('destUrl'))\n                window.location.href = \"/loyalty/#tabOpen=how_it_works\";\n        }\n    }\n\n    // Temporary - for signup&email capture flow on extension install:\n    if (msg.auth.login_type === \"login\" && Modules.Cookie.get(\"cb_instant\")) {\n        window.location.href = '/loyalty';\n    }\n}\n\nvar FBloggedIn = false;\n\nfunction loginme_by_fb(msg, img, name) {\n    FBloggedIn = true;\n    setCookie(\"msp_login_name\", name, 365);\n    setCookie(\"msp_user_image\", img, 365);\n    loginme(msg);\n}\n\nfunction logoutme() {\n    setCookie(\"msp_login\", \"\", -1);\n    setCookie(\"partial_login\", \"\", -1);\n    setCookie(\"new_user\", \"\", -1);\n    setCookie(\"msp_login_name\", \"\", -1);\n    setCookie(\"msp_user_image\", \"\", -1);\n    setCookie(\"msp_loyalty_points\", \"\", -1);\n    setCookie(\"msp_tier\", \"\", -1);\n    setCookie(\"hideSupportPopup_loyalty\", \"\", -1);\n    setCookie(\"hideLoyaltyOnBoarded\", \"\", -1);\n\n    FBloggedIn = false;\n\n    if (dataLayer[0].pagetype === \"loyalty\") {\n        window.location.href = \"/\";\n    } else if ($(\".pnts-intro\")[0]) {\n        location.reload();\n    }\n\n    update_ui();\n}\n\nModules.$doc.on(\"click\", \".js-lylty-signup, .js-trck-sign-up\", function() {\n    if ($(this).hasClass(\"js-trck-sign-up-cb\")) {\n        window.ga && ga(\"send\", \"event\", \"Loyalty\", \"click\", \"PDP-signup\", \"cashback\");\n    }\n    setCookieMins(\"signup-utm\", $(this).data(\"utmsource\") || \"\", 2);\n});\n\n// LOGIN FUNCTIONS END HERE\n\n// Pre-fill email address from login cookie\n$(document).on(\"focus\", \"input.prefill-email\", function() {\n    var $this = $(this);\n    if (!$this.val() && Modules.Cookie.get(\"msp_login\") == \"1\")\n        $this.val(Modules.Cookie.get(\"msp_login_email\"));\n});\n// Use it till new single page goes live\n\n\n/* ******* User form input: Seems like a duplicate of earlier login & form validator functions ******* */\n\nif (!window.userFormValidations) {\n    var userFormValidations = {};\n}\nuserFormValidations = (function() {\n    var private = {\n        shakeBtn: function(btn) {\n            //defaults\n            var settings = {\n                'shakes': 2,\n                'distance': 5,\n                'duration': 200\n            };\n            $this = btn;\n            // shake it\n            for (var x = 1; x <= settings.shakes; x++) {\n                $this.animate({ left: settings.distance * -1 }, (settings.duration / settings.shakes) / 4)\n                    .animate({ left: settings.distance }, (settings.duration / settings.shakes) / 2)\n                    .animate({ left: 0 }, (settings.duration / settings.shakes) / 4);\n            }\n        },\n        showFieldValidation: function(inputField, isValid, errMsg) {\n            if (!isValid) {\n                if (!inputField.hasClass(\"hghlght-err-fld\")) {\n                    inputField.addClass(\"hghlght-err-fld\").siblings(\".js-vldtn-err\").add(\".lgn__err\").slideDown();\n                }\n                // Signup/login PAGE (not popup): Fetch error div\n                if ($('.lgn__err').length) {\n                    $('.lgn__err').html(errMsg).slideDown();\n                }\n                typeof errMsg !== \"undefined\" && inputField.siblings(\".usr-inputbox__error\").text(errMsg);\n            } else {\n                if (inputField.hasClass(\"hghlght-err-fld\")) {\n                    inputField.removeClass(\"hghlght-err-fld\").siblings(\".usr-inputbox__error\").add(\".lgn__err\").slideUp();\n                }\n            }\n        },\n        hasErrFields: function(form) {\n            var errFields = form.find(\".hghlght-err-fld\");\n            if (errFields.length) {\n                private.shakeBtn(form.find(\"input[type='submit']\"));\n                errFields[0].focus();\n                return true;\n            } else\n                return false;\n        },\n        redirectLoggedUser: function() {\n            var cookieUrl = Modules.Cookie.get(\"previousUrl\");\n            deleteCookie(\"previousUrl\");\n            if (url.getAQueryParam('close') == \"1\" && window.opener) {\n                    window.opener.postMessage(\"update_ui\",\"*\");\n            }\n            window.location = url.getAQueryParam('destUrl') || cookieUrl || \"/\";\n        }\n    };\n    var public = {\n        loginformValidator: function(e) {\n            var $thisForm = $(\"#inputbox__login-form\");\n\n            function checkValidations() {\n                var emailField = $('#login-form__email'),\n                    pwdField = $('#login-form__pwd');\n\n                // Form validation\n                var formData = [{\n                        \"type\": \"email\",\n                        \"inputField\": emailField,\n                        \"errorNode\": emailField.siblings(\".js-vldtn-err\").add(\".lgn__err\"),\n                        \"errorMsg\": \"Please enter a valid email address\"\n                    },\n                    {\n                        \"type\": \"required\",\n                        \"inputField\": pwdField,\n                        \"errorNode\": pwdField.siblings(\".js-vldtn-err\").add(\".lgn__err\"),\n                        \"errorMsg\": \"Please enter a valid password\"\n                    }\n                ];\n\n                MSP.utils.validate.form(formData).done(function() {\n                    var loginemail_value = emailField.val(),\n                        loginpassword_value = pwdField.val();\n\n                    $('.pop-up__cntnr .ldr__ovrly').show();\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: \"/users/login_common.php\", // \"/users/usermanage.php\"\n                        dataType: 'json',\n                        data: {\n                            process: 'login',\n                            email: encodeURIComponent(loginemail_value),\n                            password: loginpassword_value,\n                            source: 'desktop',\n                            login_type: 'login'\n                        },\n                        async: false\n                    }).done(function(msg) {\n                        if (msg === \"error\" || msg.auth.result.msg === \"Incorrect password\") {\n                            e.preventDefault();\n                            // If logged in from popup\n                            if ($('.pop-up__cntnr').length) {\n                                var $loginBox = $(\".usr-inputbox\"),\n                                    errBlock = $(\"div.usr-inputbox__error\");\n                                errBlock.length && errBlock.remove();\n                                $('.pop-up__cntnr').not('.hide').find(\".usr-inputbox__inr\").prepend(\"<div class='usr-inputbox__error usr-inputbox__error--in-popup'>The email and password you entered did not match our records. Please double-check and try again.</div>\").slideDown('slow');\n                            } else {\n                                // If logged in from login page (/users/login.php)\n                                var $pageErrorBox = $('.lgn__err');\n                                $pageErrorBox\n                                    .text(\"Email and password did not match.\")\n                                    .slideDown();\n                                    logLoginPageEvents(\"login-error\", \"Email and password did not match.\");\n                            }\n\n                            $(\"body\").animate({ \"scrollTop\": 0 }, 500);\n                            return false;\n                        } else if (msg.auth.result.msg === \"No account exists with this email_id\") {\n                            e.preventDefault();\n                            // If logged in from popup\n                            if ($('.pop-up__cntnr').length) {\n                                var $loginBox = $(\".usr-inputbox\"),\n                                    errBlock = $(\"div.usr-inputbox__error\");\n                                errBlock.length && errBlock.remove();\n                                $('.pop-up__cntnr').not('.hide').find(\".usr-inputbox__inr\").prepend(\"<div class='usr-inputbox__error usr-inputbox__error--in-popup'>There is no account with your email id. Please signup and try again. </div>\").slideDown('slow');\n                            } else {\n                                // If logged in from popup\n                                var $pageErrorBox = $('.lgn__err'),\n                                    signupURL = \"signup.php\"+location.search;\n                                $pageErrorBox\n                                    .html(\"Not Registered. Please <a href='\"+signupURL+\"'>Sign up</a>.\")\n                                    .slideDown();\n                                logLoginPageEvents(\"login-error\", \"Not Registered.\");\n                            }\n\n                            $(\"body\").animate({ \"scrollTop\": 0 }, 500);\n                            return false;\n                        } else { // Success clause: Login done!\n                            // If popup login:\n                            if ($('.pop-up__cntnr').length) { $('.usr-inputbox__error').slideUp('slow'); }\n                            if ($('.lgn__err').length) { $('.lgn__err').slideUp('slow'); }\n\n                            loginme(msg); // login and ui update\n\n                            if (!$('.pop-up__cntnr').length) {\n                                // Not popup\n                                logLoginPageEvents(\"login-success\", \"MSP Login.\");\n                                var rdrctUrl = url.getAQueryParam('destUrl') || Modules.Cookie.get(\"previousUrl\") || \"/\";\n                                rdrctUrl = (url.getAQueryParam('destUrl') && url.getAQueryParam('utm_source') && url.getAQueryParam('utm_source')!=\"bonusapp\") ? rdrctUrl + \"?utm_source=\" + url.getAQueryParam('utm_source') : rdrctUrl;\n                                window.location.href = rdrctUrl; // Both utm_source & destUrl must be set for redirect.\n                                deleteCookie(\"previousUrl\");\n                                return false;\n                            } else {\n                                closePopup_RUI();\n                                e.preventDefault();\n                                return false;\n                            }\n                        }\n                    });\n                }).fail(function() {\n                    e.preventDefault();\n                    if (!$('.pop-up__cntnr').length) {\n                        logLoginPageEvents(\"validation-error\", \"Invalid email/password format.\");\n                    }\n                    return false;\n                }).always(function() {\n                    $('.pop-up__cntnr .ldr__ovrly').hide();\n                });\n            }\n            if (private.hasErrFields($thisForm)) {\n                e.preventDefault();\n                return false;\n            } else {\n                checkValidations();\n            }\n        },\n        signupformValidator: function(e) {\n            var $thisForm = $(\"#inputbox__signup-form\");\n\n            function checkValidations() {\n                var emailField = $('#signup-form__email'),\n                    pwdField = $('#signup-form__pwd');\n\n                // Form validtion\n                var formData = [{ \"type\": \"email\", \"inputField\": emailField, \"errorNode\": emailField.siblings(\".js-vldtn-err\").add(\".lgn__err\"), \"errorMsg\": \"Please enter a valid email address\" },\n                    { \"type\": \"required\", \"inputField\": pwdField, \"errorNode\": pwdField.siblings(\".js-vldtn-err\").add(\".lgn__err\"), \"errorMsg\": \"Please enter a valid password\" }\n                ];\n\n                $('.pop-up__cntnr .ldr__ovrly').show();\n\n\n                MSP.utils.validate.form(formData).done(function() {\n                    var signupemail_value = emailField.val(),\n                        name_value = $('#signup-form__name').val(),\n                        signuppassword_value = pwdField.val(),\n                        signup_utm = Modules.Cookie.get(\"signup-utm\") || ((window.qS && url.getAQueryParam('fromEducationPopup')) ? \"education_popup\" : url.getAQueryParam('utm_source') || url.getAQueryParam('ref')),\n                        signup_token = url.getAQueryParam('utm_source') == \"chrome_extension_notif_nontrans_loyal\" ? url.getAQueryParam('signup_token') : \"\";\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: \"/users/login_common.php\", //\"/users/usermanage.php\",\n                        dataType: 'json',\n                        async: false,\n                        data: {\n                            process: 'signup',\n                            email: encodeURIComponent(signupemail_value),\n                            password: signuppassword_value,\n                            subscribed_status: 'subscribed',\n                            name: name_value,\n                            utm_source: signup_utm,\n                            source: 'desktop',\n                            login_type: 'signup',\n                            signup_token: signup_token\n                        },\n                        async: false\n                    }).done(function(msg) {\n\n                        if (typeof msg !== 'string' && msg.auth.result.msg === 'Account already exists with this email_id') {\n                            e.preventDefault();\n\n                            if ($('.pop-up__cntnr').length) {\n                                // If popup:\n                                var $loginBox = $(\".usr-inputbox\"),\n                                    errBlock = $(\"div.usr-inputbox__error\");\n                                errBlock.length && errBlock.remove();\n                                $('.pop-up__cntnr').not('.hide').find(\".usr-inputbox__inr\").prepend(\"<div class='usr-inputbox__error usr-inputbox__error--in-popup'>This email address is already registered.</div>\").slideDown('slow');\n                            } else {\n                                // If signed up from sign up page (/users/signup.php)\n                                var $pageErrorBox = $('.lgn__err'),\n                                    loginURL = \"login.php\"+location.search;\n\n                                $pageErrorBox\n                                    .html(\"Already Registered. <a href='\"+loginURL+\"'>Login</a> or <span class=\\\"text-link js-popup-trgt\\\" data-href=\\\"fp.htm\\\">Reset Your Password</span>.\")\n                                    .slideDown();\n                                logLoginPageEvents(\"signup-error\", \"Already Registered.\");\n                            }\n                            if (Modules.Cookie.get('u99rs1deal')) {\n                                alert('Unable to login. Please check credentials'); // Alert to bring back focus to current tab (Not GTS tab)\n                            }\n                            $(\"body\").animate({ \"scrollTop\": 0 }, 500);\n                            return false;\n                        } else if (msg === \"error\") {\n                            e.preventDefault();\n\n                            if ($('.pop-up__cntnr').length) {\n                                var $loginBox = $(\".usr-inputbox\"),\n                                    errBlock = $(\"div.usr-inputbox__error\");\n                                errBlock.length && errBlock.remove();\n                                $('.pop-up__cntnr').not('.hide').find(\".usr-inputbox__inr\").prepend(\"<div class='usr-inputbox__error usr-inputbox__error--in-popup'>There is some error in signup. Please try after sometime.</div>\").slideDown('slow');\n                            } else {\n                                // If signed up from sign up page (/users/signup.php)\n                                var $pageErrorBox = $('.lgn__err');\n                                $pageErrorBox\n                                    .text(\"Error occurred. Please try after sometime.\")\n                                    .slideDown();\n                                logLoginPageEvents(\"signup-error\", \"Error occurred. Please try after sometime.\");\n                            }\n\n                            $(\"body\").animate({ \"scrollTop\": 0 }, 500);\n                            return false;\n                        } else {\n                            if (msg.auth.result.msg == 'true') { // Success clause: signup done!\n                                // If popup login:\n                                if ($('.pop-up__cntnr').length) { $('.usr-inputbox__error').slideUp('slow'); }\n                                if ($('.lgn__err').length) { $('.lgn__err').slideUp('slow'); }\n\n                                loginme(msg); // login and ui update\n\n                                deleteCookie(\"signup-utm\");\n\n                                if (!$('.pop-up__cntnr').length) {\n                                    // Not popup\n                                    logLoginPageEvents(\"signup-success\", \"success\");\n                                    var rdrctUrl = url.getAQueryParam('destUrl') || Modules.Cookie.get(\"previousUrl\") || \"/\";\n                                    rdrctUrl = (url.getAQueryParam('destUrl') && url.getAQueryParam('utm_source') && url.getAQueryParam('utm_source')!=\"bonusapp\") ? rdrctUrl + \"?utm_source=\" + url.getAQueryParam('utm_source') : rdrctUrl;\n                                    window.location.href = rdrctUrl; // Both utm_source & destUrl must be set for redirect.\n                                    deleteCookie(\"previousUrl\");\n                                    return false;\n                                } else {\n                                    closePopup_RUI();\n                                    e.preventDefault();\n                                    return false;\n                                }\n                            } else {\n                                formData[0].errorNode.html(msg.auth.result.msg);\n                                formData[0].errorNode.show();\n                            }\n                        }\n                    });\n\n                }).fail(function() {\n                    e.preventDefault();\n                    if (!$('.pop-up__cntnr').length) {\n                        logLoginPageEvents(\"validation-error\", \"Invalid email/password format.\");\n                    }\n                    return false;\n                }).always(function() {\n                    $('.pop-up__cntnr .ldr__ovrly').hide();\n                    //closePopup_RUI();\n                });\n            }\n\n            if (private.hasErrFields($thisForm)) {\n                e.preventDefault();\n                return false;\n            } else {\n                checkValidations();\n            }\n        },\n        forgotformValidator: function(e) {\n            e.preventDefault();\n            var $thisForm = $(\"#inputbox__forgot-form\");\n\n            function checkValidations() {\n                var emailField = $('#forgot-form__email');\n\n                // Form validtion\n                var formData = [{ \"type\": \"email\", \"inputField\": emailField, \"errorNode\": emailField.siblings(\".js-vldtn-err\"), \"errorMsg\": \"Please enter a valid email address\" }];\n                MSP.utils.validate.form(formData).done(function() {\n                    var fpemail_value = emailField.val();\n                    $.ajax({\n                        type: \"POST\",\n                        dataType: 'json',\n                        url: \"/users/login_common.php\", //\"/users/usermanage.php\",\n                        data: {\n                            process: 'forgotpassword',\n                            email: encodeURIComponent(fpemail_value),\n                            login_type: 'forget_password'\n                        }\n                    }).done(function(msg) {\n                        $(\".usr-inputbox__inr\").children().remove().end().append('<div class=\"usr-inputbox__cnfrmtn\">The email for resetting the password has been sent to you. Please check your email.</div>');\n                    })\n                }).fail(function() {\n                    e.preventDefault();\n                    return false;\n                });\n            }\n            if (private.hasErrFields($thisForm)) {\n                e.preventDefault();\n                return false;\n            } else\n                checkValidations();\n        },\n        resetformValidator: function(e) {\n            e.preventDefault();\n            var $thisForm = $(\"#inputbox__resetpass-form\");\n\n            function checkValidations() {\n                var pwdField = $(\"#resetpass-form__pwd\"),\n                    cnfrmPwdField = $(\"#resetpass-form__pwd-cnfrm\");\n                // Form validtion\n                var formData = [{ \"type\": \"required\", \"inputField\": pwdField, \"errorNode\": pwdField.siblings(\".js-vldtn-err\"), \"errorMsg\": \"Please enter a valid password\" },\n                    { \"type\": \"required\", \"inputField\": cnfrmPwdField, \"errorNode\": cnfrmPwdField.siblings(\".js-vldtn-err\"), \"errorMsg\": \"Please enter a valid password\" }\n                ];\n                MSP.utils.validate.form(formData).done(function() {\n                    var resetpassword_value = pwdField.val();\n\n                    if (resetpassword_value === cnfrmPwdField.val()) {\n                        var qS = url.hashParams,\n                            resetemail_value = url.getAQueryParam('email'),\n                            userHash = url.getAQueryParam('user');\n\n                        $.ajax({\n                            type: \"POST\",\n                            url: \"/users/login_common.php\", //\"/users/usermanage.php\",\n                            dataType: \"json\",\n                            data: {\n                                process: 'resetpass',\n                                email: encodeURIComponent(resetemail_value),\n                                password: resetpassword_value,\n                                login_type: 'resetpass',\n                                source: 'desktop',\n                                user: userHash\n                            }\n                        }).done(function(msg) {\n                            if (msg == 'error')\n                                alert('error');\n                            else {\n                                loginme(msg); // 2 ajax get_msp_coins, \n                                $(\".usr-inputbox__form\").hide();\n                                $(\".usr-inputbox__inr\").append('<div class=\"usr-inputbox__cnfrmtn\">Your password has been changed, You will be redirected to home page in 3 seconds.</div>');\n                                setTimeout(function() { window.location = \"/loyalty/#tabOpen=how_it_works\" }, 3000);\n                            }\n                        });\n\n                    }\n\n                });\n\n            }\n            (!private.hasErrFields($thisForm) && checkValidations());\n            return false;\n        },\n        eventHandlers: function() {\n\n            /* specific to login page & signup page */\n            if ($(\".algn-wrpr--form-athntctn\").length) {\n                if (Modules.Cookie.get(\"msp_login\")) {\n                    var cookieUrl = Modules.Cookie.get(\"previousUrl\");\n                    deleteCookie(\"previousUrl\");\n                    if (url.getAQueryParam('close') == \"1\" && window.opener) {\n                        window.opener.postMessage(\"update_ui\",\"*\");\n                    }\n                    window.location = url.getAQueryParam('destUrl') || cookieUrl || \"/\";\n                }\n\n                $(\".algn-wrpr--form-athntctn .usr-inputbox__form input:eq(0)\").focus();\n                loginCallbackQueue.push(private.redirectLoggedUser);\n            }\n            $(\".login-form__email, .signup-form__email, .forgot-form__email\").on(\"change\", function() {\n                $(this).blur(function() {\n                    var field = $(this);\n                    isValid = Modules.Validator.email(field.val()),\n                        private.showFieldValidation(field, isValid, \"Please enter a valid email address\");\n                });\n            })\n            $(\".login-form__pwd\").on(\"change\", function() {\n                $(this).blur(function() {\n                    var field = $(this);\n                    isValid = Modules.Validator.required(field.val()),\n                        private.showFieldValidation(field, isValid, \"Please enter a valid password\");\n                });\n            })\n            $(\".signup-form__pwd,.resetpass-form__pwd\").on(\"change\", function() {\n                $(this).blur(function() {\n                    var field = $(this),\n                        errMsg = \"\",\n                        isValid = false,\n                        fieldVal = field.val();\n\n                    if (!(isValid = Modules.Validator.required(fieldVal))) {\n                        errMsg = \"Please enter a valid password\";\n                    } else if (!(isValid = Modules.Validator.required(fieldVal, { \"min\": 6 }))) {\n                        errMsg = \"Password should be minimum of 6 characters\";\n                    }\n                    private.showFieldValidation(field, isValid, errMsg);\n                });\n            })\n            $(\".resetpass-form__pwd-cnfrm\").on(\"change\", function() {\n                $(this).blur(function() {\n                    var field = $(this),\n                        isValid = field.val() === $(\".resetpass-form__pwd\").val();\n                    private.showFieldValidation(field, isValid, \"Passwords does not match\");\n                });\n            })\n\n            $(\".lgn__form\").on(\"submit\", function(e) {\n                var $form = $(this),\n                    $error = $(\".lgn__err\"),\n                    $email = $form.find(\".lgn__fld--eml .lgn__inpt\"),\n                    $password = $form.find(\".lgn__fld--pswd .lgn__inpt\");\n                if (!Modules.Validator.email($email.val())) {\n                    $error.text(\"Please enter a valid email address.\").slideDown();\n                } else if ($password.val().length < 6) {\n                    $error.text(\"Please enter a valid password.\").slideDown();\n                } else {\n                    // TODO\n                }\n                return false;\n            });\n            $(\".lgn__btn--eml\").on(\"click\", function() {\n                var $this = $(this);\n                $this.fadeOut(\"fast\", function () {\n                    $this.siblings(\".lgn__form\").fadeIn(\"fast\", function () {\n                        $(\".js-signup__email\").focus();\n                    });\n                });\n                logLoginPageEvents(\"email-button\", \"Clicked.\");\n            });\n            $(\".lgn__btn--ggl\").on(\"click\", function() {\n                MSP.login.gplus();\n            });\n            $(\".lgn__btn--fcbk\").on(\"click\", function() {\n                MSP.login.facebook();\n            });\n            $(\"#login-form__submit\").on(\"click\", function(e) {\n                userFormValidations.loginformValidator(e);\n            });\n            $(\"#signup-form__submit\").on(\"click\", function(e) {\n                userFormValidations.signupformValidator(e);\n            });\n            $(\"#forgot-form__submit\").on(\"click\", function(e) {\n                userFormValidations.forgotformValidator(e);\n            });\n            $(\"#resetpass-form__submit\").on(\"click\", function(e) {\n                userFormValidations.resetformValidator(e);\n            });\n        }\n    }\n    return public;\n})();\n\nMSP.login = {\n    fb_init: function() {\n        window.fbAsyncInit = function() {\n            FB.init({\n                //appId      : '516534571724606',//mspdvid:'327375840708379', // App ID\n                appId: '253242341485828',\n                channelUrl: '/users/fbchannel.html', // Channel File\n                status: true, // check login status\n                cookie: true, // enable cookies to allow the server to access the session\n                xfbml: true,\n                version: 'v2.9' // parse XFBML\n            });\n        };\n\n        // Load the SDK Asynchronously\n        (function(d) {\n            var js, id = 'facebook-jssdk',\n                ref = d.getElementsByTagName('script')[0];\n            if (d.getElementById(id)) {\n                return;\n            }\n            js = d.createElement('script');\n            js.id = id;\n            js.async = true;\n            js.src = \"//connect.facebook.net/en_US/all.js\";\n            ref.parentNode.insertBefore(js, ref);\n        }(document));\n\n    },\n    extensionWelcome: function() {\n        setCookie(\"chrome_extension_welcome\", \"1\", 1);\n        MSP.login.facebook();\n    },\n    showRedirectLoader: function() {\n        var loaderHTML = [\n            '<div class=\"sctn--ldng\">',\n            '<div class=\"ldr\"><div class=\"ldr__crcl\"></div><div class=\"ldr__text\" style=\"\">Redirecting...</div></div>',\n            '</div>'\n        ].join('');\n        $('.sctn--lgn').append(loaderHTML);\n    },\n    removeRedirectLoader: function() {\n        $('.sctn--ldng').length && $('.sctn--ldng').remove();\n    },\n    facebook: function() {\n        fb_login();\n\n\n        function check_fb_login() {\n            var email = '';\n            FB.getLoginStatus(function(response) {\n                if (response.status === 'connected') {\n                    update_f_data_login(response);\n                    $(\".userinfo img:first-child\").attr('src', 'http://graph.facebook.com/' + response.authResponse.userID + '/picture');\n                }\n            });\n        }\n\n        function fb_login() {\n            debugger\n            if (!FBloggedIn) {\n                var email = '';\n                $('.pop-up__cntnr .ldr__ovrly').show();\n                FB.login(function(response) {\n                    if (response.authResponse) {\n                        email = update_f_data_login(response);\n                    }\n                }, { scope: \"email, user_birthday, user_likes, user_location, publish_actions\" });\n            }\n        }\n\n        function update_f_data_login(info) {\n            var email = '';\n            FB.api('/me', 'GET', {\n                    \"fields\": \"id, name, email, first_name, last_name, picture\"\n                },\n                function(data) {\n                    MSP.login.showRedirectLoader();\n                    email = data.email;\n                    if (!data.first_name) {\n                        data.first_name = email.split('@')[0];\n                    }\n                    data['access_token'] = info.authResponse.accessToken;\n                    data.email = encodeURIComponent(data.email);\n                    if (!email) {\n                        $(\".pop-up__sgnp\").removeClass(\"hide\");\n                        $(\".pop-up__lgn\").addClass(\"hide\");\n                        $(\".pop-up__sgnp .usr-inputbox__msg\").show();\n                        $(\".pop-up__sgnp .usr-inputbox__orline\").hide();\n                        $(\".pop-up__sgnp .usr-inputbox__social\").hide();\n                        return false;\n                    }\n                    $.ajax({\n                        url: '/users/login_common.php',\n                        type: 'POST',\n                        dataType: 'json',\n                        data: {\n                            fb: data,\n                            login_type: 'facebook',\n                            source: 'desktop',\n                            email: encodeURIComponent(email)\n                        }\n                    }).done(function(response) {\n                        loginme_by_fb(response, data.picture.data.url, data.first_name);\n                        if ($('.pop-up__cntnr').length) {\n                            closePopup_RUI();\n                        } else if ($('.scl__qna-popup').length) {\n                            qnaSocialLogin();\n                            $('.js-sbmt-answr').trigger('click');\n                        } else {\n                            logLoginPageEvents(\"fb-success\", \"success\");\n                            closePopup();\n                        }\n                    }).fail(function() {\n                        logLoginPageEvents(\"fb-error\", \"error\");\n                        MSP.login.removeRedirectLoader();\n                    });\n                });\n            email && captureEmail(email);\n            return email;\n        }\n    },\n\n    gplus: function() {\n        var config = {\n            'client_id': '697312397493-f0hdl2qr52fqfphvm8ihg01e17f5tfcr.apps.googleusercontent.com',\n            'scope': 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email'\n        };\n        gapi.auth.authorize(config, function() {\n            fetch(gapi.auth.getToken());\n        });\n\n        function fetch(token) {\n            var profile = {};\n            $('.pop-up__cntnr .ldr__ovrly').show();\n            $.ajax({\n                url: \"https://www.googleapis.com/oauth2/v1/userinfo?access_token=\" + token.access_token + \"&alt=json\",\n            }).done(function(response) {\n                MSP.login.showRedirectLoader();\n                profile = response;\n                $.ajax({\n                    url: '/users/login_common.php', //'/users/gplus_submit.php',\n                    type: 'POST',\n                    dataType: 'json',\n                    data: { 'gplus': profile, login_type: 'gplus', source: 'desktop', email: profile.email, access_token: token.access_token }\n                }).done(function(response) {\n                    loginme_by_fb(response, profile.picture, profile.given_name);\n                    $('.pop-up__cntnr .ldr__ovrly').hide();\n                    if ($('.pop-up__cntnr').length) {\n                        closePopup_RUI();\n                    } else if ($('.scl__qna-popup').length) {\n                        qnaSocialLogin();\n                        $('.js-sbmt-answr').trigger('click');\n                    } else {\n                        logLoginPageEvents(\"ggl-success\", \"success\");\n                        closePopup();\n                    }\n                }).fail(function() {\n                    logLoginPageEvents(\"ggl-error\", \"error\");\n                    MSP.login.removeRedirectLoader();\n                });\n            });\n        }\n    }\n}\n\nfunction logLoginPageEvents(action, label) {\n    window.ga && ga('send', 'event', 'DesktopLoginPage', action, label);\n}\n\n//Event Hadler for Logout\nModules.$doc.on(\"click\", \".js-user-lgt\", function() {\n    logoutme();\n});\n// Login UI update on page load. Will be shifted to msp.js when login is unified with Fashion.\n// true indicates this is called on ready\nupdate_ui();\n\nif ($(\".sctn--lgn, .usr-inputbox\").length) {\n    userFormValidations.eventHandlers();\n}\n\nvar currentPage = window.location.href;\nif ((currentPage.indexOf(\"users/signup.php\") > -1 || currentPage.indexOf(\"users/login.php\")) && url.getAQueryParam('source') == \"refer\") {\n\n    //Contextual message for singup and login pages\n    var $_msg = '<div class=\"cntxt-info js-cntxt-info\">Signup is Required to access Referral Cashback</div>';\n\n    $(\".algn-wrpr--form-athntctn\").prepend($_msg);\n    $(\".algn-wrpr--form-athntctn\").css(\"margin-top\", \"30px\");\n}","var sdbrWlcmPage = {};\nif ($(\".sdbr-login\").length) {\n\n    sdbrWlcmPage = {\n        cnfrmtnMsg: \"<div class='sdbr-login__icon'></div><p>You are part of our Cashback Program</p>\",\n        showCnfrmtn: function() {\n            $(\".sdbr-login__dtls,.js-pwd-tgglbtn\").hide();\n            $(\".sdbr-login__cnfrmtn\").show();\n            $(\".sdbr-login__msg\").html(this.cnfrmtnMsg);\n            $(\"#lylty-signup__email,#sdbr-signup__password\").val(\"\");\n            $(\".sdbr-login div.error\").hide().html(\"\");\n        },\n\n        hideCnfrmtn: function() {\n            if ($(\".sdbr-login\").length) {\n                $(\".sdbr-login__dtls\").show();\n                $(\".sdbr-login__cnfrmtn\").hide();\n            }\n        },\n        signupLoyaltyformValidator: function() {\n            var $email = $('#sdbr-signup__email'),\n                $password = $('#sdbr-signup__password'),\n                $errorNode = $(\".sdbr-login div.error\");\n            MSP.utils.validate.form([{\n                \"type\": \"email\",\n                \"inputField\": $email,\n                \"errorNode\": $errorNode,\n                \"errorMsg\": \"Please enter a valid email\"\n            }, {\n                \"type\": \"required\",\n                \"inputField\": $password,\n                \"errorNode\": $errorNode,\n                \"options\": { \"min\": 6 },\n                \"errorMsg\": \"Please enter a valid password\"\n            }]).done(function() {\n                var loylaty_utm_source = url.getAQueryParam('utm_source') ? url.getAQueryParam('utm_source') : utmsource;\n                if ($(\".js-chrm-wlcm\").length || $(\".wlcm-hdr\").length) {\n                    loylaty_utm_source = \"chrome welcome\";\n                }\n\n                $.ajax({\n                    type: \"POST\",\n                    url: \"/users/login_common.php\", //\"/users/usermanage.php\"\n                    dataType: \"JSON\",\n                    async: false,\n                    data: {\n                        process: 'signup',\n                        email: encodeURIComponent($email.val()),\n                        password: $password.val(),\n                        subscribed_status: 'subscribed',\n                        source: 'desktop',\n                        login_type: 'signup_loyalty',\n                        number: \"\",\n                        utm_source: loylaty_utm_source\n                    }\n                }).done(function(msg) {\n                    if (msg == \"error\" || msg.auth.result.msg == 'error') {\n                        $errorNode.html(\"There is some error in signup. Please try after sometime\");\n                        if (Modules.Cookie.get('u99rs1deal')) {\n                            alert('Unable to login. Please check credentials'); // Alert to bring back focus to current tab (Not GTS tab)\n                        }\n                    } else {\n                        if (msg.auth.result.msg == 'true') {\n                            loginme(msg);\n                            closePopup();\n                        } else {\n                            $errorNode.html(msg.auth.result.msg + \". <a class='js-popup-trgt sdbr-login__link' data-href='/users/login.html'>Click here to login</a>\");\n                            $errorNode.show();\n                        }\n                    }\n                    return false;\n                });\n            });\n            return false;\n        },\n        eventHandlers: function() {\n            $(\".sdbr-signup__email\").change(function() {\n                $(\".sdbr-signup__email\").blur(function() {\n                    $this = $(this);\n                    if (Modules.Validator.email($this.val())) {\n                        $this.removeClass(\"hghlght-err-fld\");\n                        !$(\".sdbr-signup__form .hghlght-err-fld\").length && $(\".sdbr-signup__form div.error\").text(\"\");\n                    } else {\n                        $this.addClass(\"hghlght-err-fld\");\n                        $(\".sdbr-signup__form div.error\").text(\"Please enter a valid email\");\n                    }\n                });\n            });\n            $('.sdbr-signup__password').on('change', function() {\n                $('.sdbr-signup__password').on('blur', function() {\n                    $this = $(this);\n                    if (Modules.Validator.required($this.val())) {\n                        $this.removeClass(\"hghlght-err-fld\");\n                        !$(\".sdbr-signup__form .hghlght-err-fld\").length && $(\".sdbr-signup__form div.error\").text(\"\");\n                    } else {\n                        $this.addClass(\"hghlght-err-fld\");\n                        $(\".sdbr-signup__form div.error\").text(\"Please enter a password\");\n                    }\n                });\n            });\n            $('.sdbr-signup__submit').click(function(e) {\n                e.preventDefault();\n                sdbrWlcmPage.signupLoyaltyformValidator();\n            });\n            $(\".sdbr-signup__password\").on(\"keydown\", function() {\n                if ($(this).val().length > 1)\n                    $(\".js-pwd-tgglbtn\").show()\n                else\n                    $(\".js-pwd-tgglbtn\").hide()\n            });\n            $(\".js-pwd-tgglbtn\").on(\"click\", function() {\n                var $pwdField = $(\".sdbr-signup__password\"),\n                    pwdField = $pwdField[0];\n                if (pwdField.type === \"password\") {\n                    pwdField.type = \"text\";\n                    $(this).text(\"Hide\").attr(\"title\", \"Hide Password\");\n                } else {\n                    pwdField.type = \"password\";\n                    $(this).text(\"Show\").attr(\"title\", \"Show Password\");\n                }\n            });\n        },\n        stickLogin: function() {\n            var sdbrSignupTop = $(\".js-sdbr-login-wrpr\"),\n                sdbrSignup = $(\".js-sdbr-login\"),\n                sdbrSignupScrollPoint = sdbrSignupTop.offset().top + 5,\n                $mainheaderHt = $('.main-hdr-wrpr').outerHeight(),\n                $subheader = $('.sub-hdr'),\n\n                scrlAmnt = Modules.$win.scrollTop() + $mainheaderHt;\n\n\n\n\n            if (scrlAmnt >= sdbrSignupScrollPoint) {\n                !sdbrSignup.hasClass(\"sticky\") && sdbrSignup.addClass(\"sticky\");\n                $subheader.hide();\n                // debugger;\n                if (scrlAmnt + sdbrSignup.outerHeight() > $(\".ftr\").offset().top - 20) {\n                    sdbrSignup.addClass(\"scroll\");\n                    // $(\".sticky\").removeProp(\"position\").css(\"bottom\", $(\".ftr\").offset().top - 20);\n                } else if (scrlAmnt + sdbrSignup.outerHeight() > $(\".ftr\").offset().top - 150) {\n                    // $(\".sticky\").removeProp(\"position\").css(\"bottom\", $(\".ftr\").offset().top - 20);\n                    sdbrSignup.removeClass(\"scroll\");\n                }\n            } else {\n                sdbrSignup.removeClass(\"sticky\");\n                if (scrlAmnt < sdbrSignupScrollPoint - 40)\n                    $subheader.show();\n            }\n\n\n        },\n\n        init: function() {\n            this.eventHandlers();\n            Modules.$win.scroll(function() {\n                sdbrWlcmPage.stickLogin();\n            });\n        }\n    }\n}\n\n// Check again when single goes live\nModules.$doc.ready(function() {\n    $(\".sdbr-login\").length && sdbrWlcmPage.init();\n    $(\".demo-login\").length && extnsnWlcmPage.init();\n\n});","function loyaltyCounter() {\n    var count = Modules.numberWithoutCommas($(\".js-lylty-cnt\").html());\n    var newCount = count + 1;\n\n    var interval = setInterval(function() {\n\n        $(\".js-lylty-cnt\").html(Modules.numberWithCommas(newCount));\n        newCount++;\n\n        if (newCount > count + 10) {\n            clearInterval(interval);\n        }\n    }, 300);\n}\n\nvar loyalty_counter = false;\nif ($(\".ftr__lylty\").has(\".js-lylty-cnt\").length) {\n    $(window).scroll(function() {\n        var footer_offset = $(\".ftr__lylty\").offset().top,\n            footer_height = $(\".ftr__lylty\").outerHeight(),\n            window_height = $(window).height(),\n            scrolled = $(this).scrollTop();\n        if ($(\".js-lylty-cnt\").length > 0) {\n            if ((scrolled + window_height) > (footer_offset + footer_height) && !loyalty_counter) {\n                loyaltyCounter();\n                loyalty_counter = true;\n            }\n        }\n    });\n}",";\n(function updateHighlighters() {\n    if (localStorage.highlighterData) {\n        var highlighterData = JSON.parse(localStorage.highlighterData);\n        var currentDate = new Date();\n\n        for (var prop in highlighterData) {\n            var expiringDate = new Date(highlighterData[prop].lastUsed);\n\n            expiringDate.setDate(expiringDate.getDate() + parseInt(14));\n\n            if (expiringDate <= currentDate) {\n                highlighterData[prop].count = 0;\n            }\n\n            if (highlighterData[prop].count >= 2) {\n                $(\".js-hghlghtr-link[data-highlight-id=\" + prop + \"]\").find(\".hghlghtr-link\").removeClass(\"hghlghtr-link\");\n            }\n\n        }\n        localStorage.highlighterData = JSON.stringify(highlighterData);\n    }\n})();\n\nModules.$doc.on(\"click\", \".js-hghlghtr-link\", function() {\n    var highlighterID = $(this).data(\"highlight-id\"),\n        highlighterData = localStorage.highlighterData ? JSON.parse(localStorage.highlighterData) : {};\n    highlighterData[highlighterID] = highlighterData[highlighterID] ? highlighterData[highlighterID] : {};\n    highlighterData[highlighterID]['lastUsed'] = new Date();\n    highlighterData[highlighterID]['count'] = highlighterData[highlighterID]['count'] ? parseInt(highlighterData[highlighterID]['count']) + 1 : 1;\n\n    if (parseInt(highlighterData[highlighterID]['count']) >= 2) {\n        $(this).find(\".hghlghtr-link\").removeClass(\"hghlghtr-link\");\n    }\n    localStorage.highlighterData = JSON.stringify(highlighterData);\n});\n","; (function askQuestion() {\t\t\n   var subCat = $('.body-wrpr').data('category'),\n        $listAskQuestion;\t\t\n    $('body').append([\t\t\n        '<div class=\"js-list-ask-qstn list-ask-qstn popup-target\" data-href=\"/review/qna/popup/ask_a_question.php?source=desktop_list&subcategory=' + subCat + '\">',\t\t\n                '<span class=\"list-ask-qstn__icon\">',\n                    '<span class=\"list-ask-qstn__qstn-mrk\">&#63;</span>',\n                '</span> Ask a question',\t\t\n        '</div>'].join('')\t\t\n    );\n    $listAskQuestion = $('.js-list-ask-qstn');\n    setTimeout(function() {\n        $listAskQuestion.addClass('slide-up');\n    }, 2000);\n})();\n\n\n;(function() {\n    $.QueryString = (function(a) {\n        if (a === \"\") return {};\n        var b = {};\n        for (var i = 0; i < a.length; ++i) {\n            var p = a[i].split(\"=\");\n            if (p.length != 2) continue;\n            b[p[0]] = decodeURIComponent(p[1].replace(/\\+/g, \" \"));\n        }\n        return b;\n    })(window.location.search.substr(1).split(\"&\"));\n\n    // Add a cookie if utm_source is available\n    if ($.QueryString[\"utm_source\"]) {\n        setCookie(\"utm_source\", $.QueryString[\"utm_source\"], 2);\n    }\n}());\n\n;(function() {\n    if(!Modules.isInstalled('plugin_id')) {\n        if($('.body-wrpr[data-category=computer-pendrive]').length === 1) {\n            var _html = ['<div class=\"sctn chrme-acqstn\" style=\"background: #fff url(//assets.mspcdn.net/msp-ui/icons/chrome-ext.png) no-repeat 12px center/32px;\">',\n                            '<div class=\"sctn__inr\">',\n                                '<b style=\"padding-left: 20px;\">Chrome Exclusive</b>&nbsp; ',\n                                'Install MySmartPrice Chrome Extension &amp; get 25% cashback on any purchase ',\n                                '<button style=\"float: right;\" class=\"btn btn--s btn--blue js-extension-popup\">Get Offer</button>',\n                            '</div>',\n                        '</div>'].join('');\n            $(_html).insertAfter('.list-hdr');\n            \n            window.ga && ga('send', 'event', 'Deals', 'list-page-show', 'js-log-list-page', { nonInteraction: true });\n            \n            $(document).on('click', '.js-extension-popup', function() {\n                window.ga && ga('send', 'event', 'Deals', 'list-page-click', 'js-log-list-page', { nonInteraction: true });\n                openPopup('/deals/popup/add-chrome-overlay.html');\n            });\n        }\n    }\n}());\n","if (url.getAQueryParam && url.getAQueryParam('utm_source')) {\n    setCookie(\"utm_source\", url.getAQueryParam('utm_source'), 1);\n}\n\n(function prefillEmailInputs() {\n    var $emailInputs = $(\"input[name='email']\"),\n        userEmail = Modules.Cookie.get(\"msp_login_email\");\n    if ($emailInputs.length && userEmail) {\n        $emailInputs.val(userEmail);\n    }\n}());\n\n// Extension Rating Parameter (From mailer) handler:\n(function() {\n    var rating;\n    if (url.getAQueryParam('extensionrating')) {\n        rating = url.getAQueryParam('extensionrating').toString();\n        window.ga && ga('send', 'event', 'Extension', 'extension-nps-click', rating, { nonInteraction: true });\n        openPopup('/promotions/popups/extension_rating_popup.html');\n    }\n})();\n\n// Mobile number capture popup for users who land on single page\n// from price alert emailer and missed the drop in price\nif (url.getAQueryParam && url.getAQueryParam('utm_campaign') === \"PriceAlert\") {\n    var _hash = url.hashParams;\n    if (_hash.price) {\n        var $mspSingleTitle = $(\"#mspSingleTitle\");\n        if ($mspSingleTitle.length) {\n            var emailPrice = parseInt(_hash.price, 10),\n                bestPrice = parseInt($mspSingleTitle.data(\"bestprice\"), 10);\n            if (bestPrice > emailPrice) {\n                openPopup(\"/price_alert/paepopup.php?mspid=\" + $mspSingleTitle.data(\"mspid\"));\n            }\n        }\n    }\n}\n\nsetTimeout(function(){\n    if($(\".bottom-slideup\").is(\":visible\")){\n        $(\".qna-bbl\").css(\"bottom\",$(\".bottom-slideup\").height+\"px\");   \n    }\n}, 3000);","(function setChromeAutoPopup() {\n    var validUTMSources = ['pa-transact', 'ps-transact', 'browsing_pa_emailer', 'browsing_ps_emailer'];\n    if (url.getAQueryParam && validUTMSources.indexOf(url.getAQueryParam('utm_source') !== -1)) {\n        if (Modules.Browser.name === 'Chrome') {\n            if(!Modules.isInstalled('plugin_id')) {\n                window.ga && ga(\"send\", \"event\", \"autopopup\", \"pricedrop\", \"pdp-pageview\", { nonInteraction: true });\n                $('body').attr('data-autopopup', '/promotions/install-extn-auto-popup.php');\n            }\n        }\n    }\n}());\n\n// Make extension install compulsory if particular utm_source for the same is set:\n(function() {\n    if(!Modules.isInstalled('plugin_id')) {\n        var validFBTag = url.getAQueryParam('utm_source') === 'FB-DRT-MSP-25CB' || url.getAQueryParam('utm_source') === 'FB-DRT-MSP' || (url.getAQueryParam('utm_source') && url.getAQueryParam('utm_source').indexOf('acebook') !== -1);\n        if(validFBTag && Modules.Browser.name === 'Chrome') {\n            function checkInstallation() {\n                $('.popup-closebutton').addClass('not-vsbl');\n                $('.popup-overlay').addClass('noclose');\n                if (!Modules.Cookie.get('plugin_id')) { \n                    intervalCount++;\n                    if (intervalCount <= 180) {\n                        setTimeout(checkInstallation, 1000);\n                    }\n                }\n            }\n            var intervalCount = 0;\n            openPopup('/deals/popup/extension_install_overlay.php?pageSource=fbTaggedSinglePage'); \n            checkInstallation();\n        }\n    }\n})();\n\n(function() {\n    $('.page-nvgtn--PDP').on('click', '.page-nvgtn__item', function() {\n        window.ga && ga('send', 'event', 'Comparables', 'pdp-nav-click', $(this).data('href'));\n    });\n})();\n\n\n(function postInstallMailLink() {\n    if(url.getAQueryParam('utm_source') === 'mail_gtsinstall') {\n        popupDataObj = {\n            type: \"signup\"\n        };\n        openPopup('/users/login.html');\n    }\n})();\n\n// Moved from PDP source (findpricehelpers.php); remove if unused\n(function () {\n    $(\"#compare_button\").show();\n\n    $(\"body\").on(\"click\", \"#addtolistbutton\", function () {\n        var msp_login = Modules.Cookie.get(\"msp_login\");\n        if (msp_login == 1) {\n            $(\"#addedtolistbutton\").css(\"display\", \"inline-block\");\n            $(\"#addtolistbutton\").hide();\n            $.get(\"https://www.mysmartprice.com/users/add_to_list.php\", {\n                \"mspid\": PriceTable.dataPoints.mspid\n            });\n        }\n        else {\n            var checklogin = setInterval(function () {\n                var msp_login = Modules.Cookie.get(\"msp_login\");\n                if (msp_login == 1) {\n                    clearInterval(checklogin);\n                    $(\"#addtolistbutton\").click();\n                }\n            }, 500);\n            $(\".loginbutton\").click();\n        }\n        return false;\n    });\n\n    $(\"body\").on(\"click\", \".logoutbutton\", function () {\n        $(\"#addedtolistbutton\").hide();\n        $(\"#addtolistbutton\").css(\"display\", \"inline-block\");\n    });\n}());\n\n// Clicks outside message boxes should close the msg boxes that are open\nModules.$doc.on('click', 'body', function(event) {\n    var $msgBox = $('.msg-box'),\n        $exception;\n    // click NOT on msg box\n    if (!$(event.target).closest('.js-xtrs-msg-box-trgt').length &&\n        !$(event.target).closest('.js-msg-box-trgt').length) {\n        $msgBox.each(function(index, element) {\n            if ($(element).closest('.js-msg-box-trgt').length) {\n                $(element).removeClass('msg-box--show');\n            } else if ($(element).closest('.js-xtrs-msg-box-trgt').length) {\n                $exception = $(element).closest('.js-xtrs-msg-box-trgt');\n                if ($exception.hasClass('cashback') || $exception.hasClass('offline')) {\n                    $(element).removeClass('msg-box--show');\n                } else {\n                    $(element).remove();\n                }\n            }\n        });\n    }\n});","/**\n * jQuery mCycle v0.1\n * Carousel Plugin Script Begins Here\n */\n;\n(function($, window, document, undefined) {\n\n    \"use strict\";\n\n    // Defaults are below\n    var defaults = {\n        mCycleItem: 'img', // the item which will be slided\n        animTime: 200, // time taken in animation in milliseconds\n        waitTime: 10000, // time for a slide to wait in milliseconds\n        isAutoPlay: false, //  isAutoPlay can be false for manual control\n        direction: 'left', // direction can be 'left' of 'right'\n        slideBullets: true, //show the slide bullets\n        height: 'auto' //height of the mCycleCont (slide show container)\n    };\n\n    // The actual plugin constructor\n    function mCycle(element, options) {\n        this.element = element;\n\n        // extending defaults with user options\n        this.options = $.extend({}, defaults, options);\n\n        this._defaults = defaults;\n        this._name = \"mCycle\";\n        this._autoPlayQueued = false;\n        this._animating = false;\n        this.forcedNextSlide = -1;\n        this.init(true);\n\n    }\n\n    // Get the next slide for the animation in the given direction\n    function getNextSlide($currentSlide, direction) {\n        var $nextSlide;\n        switch (direction) {\n            case \"left\":\n                $nextSlide = $currentSlide.next('.mCycleItemWrapper');\n                break;\n            case \"right\":\n                $nextSlide = $currentSlide.prev('.mCycleItemWrapper');\n                break;\n        }\n\n        if ($nextSlide.length) return $nextSlide;\n\n        switch (direction) {\n            case \"left\":\n                $nextSlide = $currentSlide.parent().find('.mCycleItemWrapper').first();\n                break;\n            case \"right\":\n                $nextSlide = $currentSlide.parent().find('.mCycleItemWrapper').last();\n                break;\n        }\n\n        return $nextSlide;\n    }\n\n\n    mCycle.prototype = {\n\n        init: function(firstTime) {\n            if (!firstTime) return;\n\n            var $elem = $(this.element),\n                mCycleItemCount = $elem.find(this.options.mCycleItem).length,\n                elemHeight = 0;\n\n            $elem.addClass('mCycleCont').find(this.options.mCycleItem).each(function(index) {\n                var $mCycleItem = $(this);\n                $mCycleItem.addClass('show mCycleItemWrapper').attr(\"data-count\", index + 1);\n\n                elemHeight = Math.max($mCycleItem.height(), elemHeight);\n\n\n            });\n\n            $elem.show();\n\n            if (parseInt($elem.height(), 10) === 0 && this.options.height === 'auto') {\n                $elem.height(elemHeight);\n            } else if (this.options.height !== 'auto') {\n                $elem.height(this.options.height);\n            }\n\n\n            $elem.find('.mCycleItemWrapper').eq(0).addClass('mCycleItemCurrent');\n\n            if (this.options.slideBullets) {\n                $elem.append('<div class=\"mCycleSlideBullets\"></div>');\n                var mCycleSlideBulletCount = mCycleItemCount;\n                while (mCycleSlideBulletCount--) {\n                    $elem.find('.mCycleSlideBullets').append('<div class=\"mCycleSlideBullet\"></div>');\n                }\n                $elem.find('.mCycleSlideBullet').eq(0).addClass('active');\n            }\n\n            if (this.options.isAutoPlay && mCycleItemCount > 1) { // start sliding if it is autoplay \n                var that = this;\n\n                that._autoPlayQueued = true;\n\n                setTimeout((function() {\n                    that._autoPlayQueued = false;\n                    if (that.options.isAutoPlay) that.slide();\n                }), that.options.waitTime);\n\n            }\n        },\n\n        play: function() {\n            if (this.options.isAutoPlay) return;\n            this.options.isAutoPlay = true;\n            this.slide();\n        },\n\n        pause: function() {\n            this.options.isAutoPlay = false;\n        },\n\n        reverse: function() {\n            this.options.direction = (this.options.direction === 'left') ? 'right' : 'left';\n        },\n        slideLeft: function() {\n            this.slide('left');\n        },\n        slideRight: function() {\n            this.slide('right');\n        },\n        slideTo: function(index) {\n            var $slides = $(this.element),\n                currentIndex = $slides.index($(this.element).hasClass(\"mCycleItemCurrent\")),\n                direction = (index > currentIndex) ? 'left' : 'right',\n                isAutoPlay = this.options.isAutoPlay,\n                that = this;\n            this.pause();\n            this.forcedNextSlide = index;\n            $slides.eq(index).addClass(\"mCycleItemNext\");\n            setTimeout(function() {\n                that.slide(direction);\n                that.forcedNextSlide = -1;\n                setTimeout(function() {\n                    if (isAutoPlay) {\n                        that.play();\n                    }\n                }, that.options.animTime + that.options.waitTime + 10);\n            }, that.options.animTime + 10);\n        },\n        slide: function(direction) {\n\n            if (this.options.isAutoPlay && this._autoPlayQueued || this._animating) return; // to stop multiple instance of slide when on autoplay\n\n            direction = direction || this.options.direction;\n\n            var $currentSlide = $(this.element).find('.mCycleItemCurrent'),\n                $slides = $(this.element).find(\".mCycleItemWrapper\"),\n                isForcedSlide = (this.forcedNextSlide === -1),\n                $nextSlide = isForcedSlide ? getNextSlide($currentSlide, direction) : $slides.eq(this.forcedNextSlide),\n                prevSlideLeftOffset,\n                nextSlideClass;\n            switch (direction) {\n                case 'left':\n                    nextSlideClass = 'mCycleItemNext';\n                    prevSlideLeftOffset = '-100%';\n                    break;\n                case 'right':\n                    nextSlideClass = 'mCycleItemPrev';\n                    prevSlideLeftOffset = '100%';\n                    break;\n            }\n\n            if ($nextSlide.hasClass('mCycleItemCurrent')) return; // if current slide is same as next slide\n\n\n            $nextSlide.addClass(nextSlideClass);\n\n            var that = this;\n\n            this._animating = true;\n\n            var reflow = $(\"body\").offset().top;\n\n            // making current slide the prev slide\n            $currentSlide.css({\n                '-webkit-transition': 'transform' + (that.options.animTime) / 1000 + 's',\n                'transition': 'transform ' + (that.options.animTime) / 1000 + 's',\n                '-webkit-transform': 'translateX(' + prevSlideLeftOffset + ')',\n                '-ms-transform': 'translateX(' + prevSlideLeftOffset + ')',\n                'transform': 'translateX(' + prevSlideLeftOffset + ')'\n            });\n\n            // making next slide the current slide\n            $nextSlide.css({\n                '-webkit-transition': 'transform ' + (that.options.animTime) / 1000 + 's',\n                'transition': 'transform ' + (that.options.animTime) / 1000 + 's',\n                '-webkit-transform': 'translateX(0)',\n                '-ms-transform': 'translateX(0)',\n                'transform': 'translateX(0)'\n            });\n\n            //IE Fix\n            if (Modules.Browser.name === \"MSIE\" && Modules.Browser.version < 9) {\n                $currentSlide.css({\n                    'left': prevSlideLeftOffset\n                });\n                $nextSlide.css({\n                    'left': '0'\n                });\n            }\n\n            setTimeout(function() {\n                var $elem = $(that.element);\n\n                $currentSlide.removeClass('mCycleItemCurrent').removeAttr('style');\n                $nextSlide.toggleClass(nextSlideClass + ' mCycleItemCurrent').removeAttr('style');\n\n                //IE Fix\n                if (Modules.Browser.name === \"MSIE\" && Modules.Browser.version < 9) {\n                    $currentSlide.removeClass('mCycleItemCurrentIE').removeAttr('style');\n                    $nextSlide.toggleClass(nextSlideClass + ' mCycleItemCurrentIE').removeAttr('style');\n                }\n\n                if (that.options.slideBullets) {\n                    var count = $elem.find('.mCycleItemCurrent').data('count');\n\n                    $elem.find('.mCycleSlideBullet.active').removeClass('active');\n                    $elem.find('.mCycleSlideBullet').eq(count - 1).addClass('active');\n                }\n\n                that._animating = false;\n                if (that.options.isAutoPlay) {\n                    that._autoPlayQueued = true; // auto call for slide is queued if on autoplay\n                    setTimeout((function() {\n                        if (that.options.isAutoPlay && that._autoPlayQueued) {\n                            that._autoPlayQueued = false;\n                            that.slide();\n                        } else {\n                            that.options.isAutoPlay = false;\n                            that._autoPlayQueued = false;\n                        }\n                    }), that.options.waitTime);\n                }\n\n            }, that.options.animTime + 10); //adding 10ms to make sure animation is complete\n        }\n    };\n\n    $.fn[\"mCycle\"] = function(options) {\n        var params = Array.prototype.splice.call(arguments, 1, 1);\n        return this.each(function() {\n            if (!$.data(this, \"mCycle\")) {\n                // preventing against multiple instantiations\n                $.data(this, \"mCycle\", new mCycle(this, options));\n            } else {\n                var mCycleObj = $.data(this, \"mCycle\");\n                // checking if option is a valid function name\n                if (typeof options === \"string\" && mCycleObj[options]) {\n                    mCycleObj[options].apply(mCycleObj, params);\n                } else if (typeof options === \"object\") {\n                    // if the option is object extending it with initalized object\n                    mCycleObj.options = $.extend({}, mCycleObj.options, options);\n                }\n            }\n        });\n    };\n\n})(jQuery, window, document);\n\n// RUI:: added new carousel classes inside code\n    $(\".js-crsl-wdgt, .widget-carousel\").each(function() {\n        var slideTimeout,\n            $this = $(this);\n\n        if ($this.data(\"autoplay\"))\n            $this.mCycle({\n                mCycleItem: \".crsl__item\",\n                isAutoPlay: true\n            });\n        else\n            $this.mCycle({\n                mCycleItem: \".crsl__item\"\n            });\n        // Tracking impressions of carousels\n\n        var url = $this.data(\"impression-url\");\n        if (url) {\n            if (url.indexOf(\"[timestamp]\") >= 0) {\n                url = url.replace(\"[timestamp]\", $.now);\n            }\n            $.ajax({\n                \"url\": url\n            });\n        }\n\n        //Check with Arun once\n        //$.ajax({ url: 'https://d.adx.io/views?xb=35BWU1550&xd=7&xnw=xsync&xtg=Affiliate&xtm_source=MSP_HVS_Feb&xtm_campaign=HVS_Feb&xtm_content=smallBanner&rnd=' + jQuery.now() + '' });\n\n        $this.on(\"mousever\", \".crsl-wdgt__prvs-btn, .prev-button\", function() {\n            $this.mCycle(\"pause\").mCycle(\"slideRight\");\n            resetSlideTimeout();\n        });\n        $this.on(\"click\", \".crsl-wdgt__prvs-btn, .prev-button\", function() {\n            $this.mCycle(\"pause\").mCycle(\"slideRight\");\n            resetSlideTimeout();\n        });\n        $this.on(\"click\", \".crsl-wdgt__next-btn, .next-button\", function() {\n            $this.mCycle(\"pause\").mCycle(\"slideLeft\");\n            resetSlideTimeout();\n        });\n        $this.on(\"click\", \".mCycleSlideBullet\", function() {\n            $this.mCycle(\"slideTo\", $(this).index());\n        });\n\n        function resetSlideTimeout() {\n            clearTimeout(slideTimeout);\n            slideTimeout = setTimeout(function() {\n                $this.mCycle(\"play\");\n            }, 10000);\n        }\n    });","elementSlider = {\n    \"init\": function(slider) {\n        var slideItem = $(slider).data(\"slideitem\"),\n            slideItemWrapper = $(slider).data(\"slideitemwrapper\");\n\n        if (!slideItem || !slideItemWrapper) return;\n        if ($(slider).find(\".\" + slideItemWrapper).hasClass(\"js-sldr-item-wrpr1\")) return;\n\n        var $elements = $(slider).find(\".\" + slideItem),\n            countCurrItems = Math.floor($(slider).find(\".\" + slideItemWrapper).eq(0).width() / $elements.eq(0).outerWidth(true)),\n            elementWidth = $($(slider).find(\".\" + slideItem).get(0)).outerWidth(true),\n            wrapperWidth = elementWidth * $elements.length;\n\n        if ($elements.length > countCurrItems) {\n            $(slider).find(\".\" + slideItemWrapper).addClass(\"js-sldr-item-wrpr1\").wrapInner(\"<div class='js-sldr-item-wrpr'></div>\");\n            $(slider).find(\".\" + slideItem).eq(0).addClass(\"js-sldr-crnt\");\n            $(slider).find(\".js-sldr__prvs\").addClass(\"js-sldr__dsbl-btn\").show();\n            $(slider).find(\".js-sldr__next\").show();\n        }\n\n        $('.js-sldr-item-wrpr').css('width', wrapperWidth + 'px');\n    },\n\n    \"slide\": function(element, direction) {\n        var $slider = $(element).closest(\".js-sldr\"),\n            slideItemWrapper = $slider.data(\"slideitemwrapper\"),\n            $elementWrapper = $slider.find(\".js-sldr-item-wrpr\"),\n            slideItem = $slider.data(\"slideitem\"),\n            $elements = $elementWrapper.find(\".\" + slideItem),\n            $currentElement = $elements.filter(\".js-sldr-crnt\"),\n            $startElement = null,\n\n            countCurrItems = Math.floor($('.' + slideItemWrapper).width() / $elements.eq(0).outerWidth(true)),\n            countRightItems = $elements.length - $elements.index($currentElement) - countCurrItems,\n            countLeftItems = $elements.index($currentElement),\n            elementPos;\n\n        if ($(element).hasClass(\"js-sldr__dsbl-btn\") || $(element).hasClass(\"js-sldr__dsbl-btn\"))\n            return;\n\n        $(element).siblings(\".js-sldr__prvs\").removeClass(\"js-sldr__dsbl-btn\");\n        $(element).siblings(\".js-sldr__next\").removeClass(\"js-sldr__dsbl-btn\");\n\n        if (direction === 'right') {\n            if (countRightItems > countCurrItems) {\n                $startElement = $elements.eq($elements.index($currentElement) + countCurrItems);\n            } else {\n                $startElement = $elements.eq($elements.length - countCurrItems);\n                $(element).addClass(\"js-sldr__dsbl-btn\");\n            }\n        } else if (direction === 'left') {\n            if (countLeftItems > countCurrItems) {\n                $startElement = $elements.eq($elements.index($currentElement) - countCurrItems);\n            } else {\n                $startElement = $elements.eq(0);\n                $(element).addClass(\"js-sldr__dsbl-btn\");\n            }\n        }\n\n        $currentElement.removeClass(\"js-sldr-crnt\");\n        $startElement.addClass(\"js-sldr-crnt\");\n\n        //IE dones not support transitions.\n        elementPos = -$startElement.position().left;\n        if (Modules.Browser.name === \"MSIE\" && Modules.Browser.version < 9) {\n            $elementWrapper.css({\n                \"left\": elementPos\n            });\n        } else {\n            $elementWrapper.css({\n                'transform': 'translateX(' + elementPos + 'px)',\n                '-webkit-transform': 'translateX(' + elementPos + 'px)',\n                '-ms-transform': 'translateX(' + elementPos + 'px)'\n            });\n        }\n\n\n        return false;\n    }\n}\n\n/* RUI:: new component for horizonal scrollable sections - start */\n    $(\".js-sldr\").each(function(e) {\n        elementSlider.init(this);\n    });\n\n    // Select text inside node on clicking it.\n    Modules.$doc.on(\"click\", \".js-slct-trgr\", function() {\n        Modules.selectText($(this));\n    });\n\n    Modules.$doc.on(\"click\", \".js-sldr__prvs\", function() {\n        elementSlider.slide(this, \"left\");\n    });\n\n    Modules.$doc.on(\"click\", \".js-sldr__next\", function() {\n        elementSlider.slide(this, \"right\");\n    });\n    /* RUI:: new component for horizonal scrollable sections - end */","/*! TinySort 1.5.6\n * * Copyright (c) 2008-2013 Ron Valstar http://tinysort.sjeiti.com/\n * * License:\n * *     MIT: http://www.opensource.org/licenses/mit-license.php\n * *     GPL: http://www.gnu.org/licenses/gpl.html\n * */\n \n! function(a, b) {\n    \"use strict\";\n\n    function c(a) {\n        return a && a.toLowerCase ? a.toLowerCase() : a\n    }\n\n    function d(a, b) {\n        for (var c = 0, d = a.length; d > c; c++)\n            if (a[c] == b) return !e;\n        return e\n    }\n    var e = !1,\n        f = null,\n        g = parseFloat,\n        h = Math.min,\n        i = /(-?\\d+\\.?\\d*)$/g,\n        j = /(\\d+\\.?\\d*)$/g,\n        k = [],\n        l = [],\n        m = function(a) {\n            return \"string\" == typeof a\n        },\n        n = function(a, b) {\n            for (var c, d = a.length, e = d; e--;) c = d - e - 1, b(a[c], c)\n        },\n        o = Array.prototype.indexOf || function(a) {\n            var b = this.length,\n                c = Number(arguments[1]) || 0;\n            for (c = 0 > c ? Math.ceil(c) : Math.floor(c), 0 > c && (c += b); b > c; c++)\n                if (c in this && this[c] === a) return c;\n            return -1\n        };\n    a.tinysort = {\n        id: \"TinySort\",\n        version: \"1.5.6\",\n        copyright: \"Copyright (c) 2008-2013 Ron Valstar\",\n        uri: \"http://tinysort.sjeiti.com/\",\n        licensed: { MIT: \"http://www.opensource.org/licenses/mit-license.php\", GPL: \"http://www.gnu.org/licenses/gpl.html\" },\n        plugin: function() {\n            var a = function(a, b) { k.push(a), l.push(b) };\n            return a.indexOf = o, a\n        }(),\n        defaults: { order: \"asc\", attr: f, data: f, useVal: e, place: \"start\", returns: e, cases: e, forceStrings: e, ignoreDashes: e, sortFunction: f }\n    }, a.fn.extend({\n        tinysort: function() {\n            var p, q, r, s, t = this,\n                u = [],\n                v = [],\n                w = [],\n                x = [],\n                y = 0,\n                z = [],\n                A = [],\n                B = function(a) { n(k, function(b) { b.call(b, a) }) },\n                C = function(a, b) {\n                    return \"string\" == typeof b && (a.cases || (b = c(b)), b = b.replace(/^\\s*(.*?)\\s*$/i, \"$1\")), b\n                },\n                D = function(a, b) {\n                    var c = 0;\n                    for (0 !== y && (y = 0); 0 === c && s > y;) {\n                        var d = x[y],\n                            f = d.oSettings,\n                            h = f.ignoreDashes ? j : i;\n                        if (B(f), f.sortFunction) c = f.sortFunction(a, b);\n                        else if (\"rand\" == f.order) c = Math.random() < .5 ? 1 : -1;\n                        else {\n                            var k = e,\n                                o = C(f, a.s[y]),\n                                p = C(f, b.s[y]);\n                            if (!f.forceStrings) {\n                                var q = m(o) ? o && o.match(h) : e,\n                                    r = m(p) ? p && p.match(h) : e;\n                                if (q && r) {\n                                    var t = o.substr(0, o.length - q[0].length),\n                                        u = p.substr(0, p.length - r[0].length);\n                                    t == u && (k = !e, o = g(q[0]), p = g(r[0]))\n                                }\n                            }\n                            c = d.iAsc * (p > o ? -1 : o > p ? 1 : 0)\n                        }\n                        n(l, function(a) { c = a.call(a, k, o, p, c) }), 0 === c && y++\n                    }\n                    return c\n                };\n            for (p = 0, r = arguments.length; r > p; p++) {\n                var E = arguments[p];\n                m(E) ? z.push(E) - 1 > A.length && (A.length = z.length - 1) : A.push(E) > z.length && (z.length = A.length)\n            }\n            for (z.length > A.length && (A.length = z.length), s = z.length, 0 === s && (s = z.length = 1, A.push({})), p = 0, r = s; r > p; p++) {\n                var F = z[p],\n                    G = a.extend({}, a.tinysort.defaults, A[p]),\n                    H = !(!F || \"\" === F),\n                    I = H && \":\" === F[0];\n                x.push({ sFind: F, oSettings: G, bFind: H, bAttr: !(G.attr === f || \"\" === G.attr), bData: G.data !== f, bFilter: I, $Filter: I ? t.filter(F) : t, fnSort: G.sortFunction, iAsc: \"asc\" == G.order ? 1 : -1 })\n            }\n            return t.each(function(c, d) {\n                var e, f = a(d),\n                    g = f.parent().get(0),\n                    h = [];\n                for (q = 0; s > q; q++) {\n                    var i = x[q],\n                        j = i.bFind ? i.bFilter ? i.$Filter.filter(d) : f.find(i.sFind) : f;\n                    h.push(i.bData ? j.data(i.oSettings.data) : i.bAttr ? j.attr(i.oSettings.attr) : i.oSettings.useVal ? j.val() : j.text()), e === b && (e = j)\n                }\n                var k = o.call(w, g);\n                0 > k && (k = w.push(g) - 1, v[k] = { s: [], n: [] }), e.length > 0 ? v[k].s.push({ s: h, e: f, n: c }) : v[k].n.push({ e: f, n: c })\n            }), n(v, function(a) { a.s.sort(D) }), n(v, function(a) {\n                var b = a.s,\n                    c = a.n,\n                    f = b.length,\n                    g = c.length,\n                    i = f + g,\n                    j = [],\n                    k = i,\n                    l = [0, 0];\n                switch (G.place) {\n                    case \"first\":\n                        n(b, function(a) { k = h(k, a.n) });\n                        break;\n                    case \"org\":\n                        n(b, function(a) { j.push(a.n) });\n                        break;\n                    case \"end\":\n                        k = g;\n                        break;\n                    default:\n                        k = 0\n                }\n                for (p = 0; i > p; p++) {\n                    var m = d(j, p) ? !e : p >= k && k + f > p,\n                        o = m ? 0 : 1,\n                        q = (m ? b : c)[l[o]].e;\n                    q.parent().append(q), (m || !G.returns) && u.push(q.get(0)), l[o]++\n                }\n            }), t.length = 0, Array.prototype.push.apply(t, u), t\n        }\n    }), a.fn.TinySort = a.fn.Tinysort = a.fn.tsort = a.fn.tinysort\n}(jQuery);\n/*! TinySort 1.5.6 -- end */","(function lazyLoadPriceGraph() {\n    var $priceGraph = $(\"[data-id='price-history']\");\n    if ($priceGraph.length) {\n        var offsetTop = $priceGraph.offset().top;\n        Modules.$win.on(\"scroll.lazyGraph\", Modules.throttle(function () {\n            if (Modules.$win.scrollTop() + window.innerHeight > offsetTop) {\n                Modules.$win.off(\"scroll.lazyGraph\");\n                $.ajax({\n                    \"url\": \"/msp/processes/property/ui-factory/msp_generate_pricegraph.php\",\n                    \"data\": {\n                        \"mspid\": $(\".prdct-dtl__ttl\").data(\"mspid\")\n                    }\n                }).done(function(graphHtml) {\n                    $priceGraph.replaceWith(graphHtml);\n                });\n            }\n        }, 250));\n    }\n})();\n\nif ($(\".prc-grph\").length) {\n    Modules.lazyLoad.assign({\n        \"node\": $(\".prc-grph\"),\n        \"isStatic\": true,\n        \"callback\": {\n            \"definition\": function() {\n                if ($(\".prc-grph__not-sprtd\").length) {\n                    $(\".prc-grph__not-sprtd\").show();\n                    $(\".prc-grph__ldr\").hide();\n                    return;\n                }\n\n                $(\"head\").append('<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css\">');\n\n                $.getScript(\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js\", function() {\n                    $.getScript(\"https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js\", function() {\n                        $.getScript(\"assets/js/priceGraph.js\", function() {\n                            $(\".prc-grph__rght-chrt\").show();\n                            $(\".prc-grph__btn-wrpr\").show();\n                            $(\".prc-grph__ldr\").hide();\n                        });\n                    });\n                });\n            },\n            \"context\": window,\n            \"arguments\": []\n        }\n    }).run();\n}\n","// Instatab Extension installer: GTS\n$(document).on('click', '.js-instatab-popup', function(e) {\n    e.preventDefault();\n    var $this = $(this),\n        gtsURL = $this.data('url'),\n        isEmailSet = Modules.Cookie.get('msp_login_email'),\n        isInstatabInstalled = Modules.Cookie.get('instatab');\n\n    var popupCookieVal = Modules.Cookie.get('gtspopup') ? Modules.Cookie.get('gtspopup').split(';') : undefined,\n        cookieNumTimes = popupCookieVal ? popupCookieVal[0] : undefined,\n        cookieCurMessage = popupCookieVal ? popupCookieVal[1] : undefined,\n        isEmailCaptured = popupCookieVal ? popupCookieVal[2] : undefined;\n\n    if (popupCookieVal) {\n        if (cookieNumTimes < 4) {\n            if (cookieCurMessage === 'instatab') {\n                if (isInstatabInstalled) {\n                    if (!isEmailSet && !isEmailCaptured) {\n                        setCookie('gtspopup', (Number(cookieNumTimes) + 1) + ';email;', 30);\n                        openGTSPopup();\n                    } else {\n                        doGTS();\n                    }\n                } else {\n                    openGTSPopup();\n                }\n            } else {\n                if (isEmailSet || isEmailCaptured === 'email_done') {\n                    if (!isInstatabInstalled) {\n                        setCookie('gtspopup', '4;instatab;' + (isEmailCaptured || ''), 30);\n                        openGTSPopup();\n                    } else {\n                        doGTS();\n                    }\n                } else {\n                    openGTSPopup();\n                }\n            }\n        } else {\n            doGTS();\n        }\n    } else {\n        if (isInstatabInstalled) {\n            if (!isEmailSet) {\n                setCookie('gtspopup', '1;email;', 30);\n                openGTSPopup();\n            } else {\n                doGTS();\n            }\n        } else {\n            openGTSPopup();\n        }\n    }\n\n    return false;\n    /* *************** */\n    function openGTSPopup() {\n        gtsURL ? _gPopStoreUrl = gtsURL : _gPopStoreUrl = null; // set the store url (used by openPopup())\n        openPopup('https://www.mysmartprice.com/loyalty/popup/gts.php?gtsURL=' + encodeURIComponent(gtsURL), 'PromoB');\n    }\n\n    function doGTS() {\n        window.open(gtsURL, '_blank');\n    }\n});\n\n\nModules.$doc.ready(function() {\n    // Only email capture popup on GTS:\n    $(document).on('click', '.js-gts-only-email-popup', function(e) {\n        e.preventDefault();\n        e.stopImmediatePropagation();\n\n        var $this = $(this),\n            gtsURL = $this.data('url');\n        gtsURL ? _gPopStoreUrl = gtsURL : _gPopStoreUrl = null; // set the store url (used by openPopup())\n\n        $this.removeClass('js-instatab-popup js-prc-tbl__gts-btn');\n        openPopup('https://www.mysmartprice.com/loyalty/popup/gts-only-email.php?gtsURL=' + encodeURIComponent(gtsURL));\n\n        return false;\n    });\n});","/* Jquery MSP UI components */\n\n/** [START] Price table  openPopup_rd (price breakup popup and other instruction popup) **/\n\n$(\"body\").on(\"click\", \".openPopup_rd\", function handler(e) {\n    var $popupCont = $(this),\n        $popup, mspid, currentColour, storename, popupDetails;\n    handler.popupData = handler.popupData || {};\n    if ($(e.target).is($(\".openPopup_rd, .openPopup_rd *\").not(\".popup_rd, .popup_rd *\"))) {\n        $(\".popup_rd\").slideUp(\"fast\", function() {\n            if ($(this).closest(\".openPopup_rd\").is(\".offers:not(.cashback)\"))\n                $(this).remove();\n        });\n    }\n\n    if ($popupCont.data(\"popup-type\") === \"common\") {\n        $popup = $popupCont.siblings(\".popup_rd\");\n        if (!$popup.is(\":visible\")) {\n            if ($popup.length)\n                $popup.slideDown(\"fast\");\n            else {\n                $popupCont.after([\n                    '<div class=\"loyalty_expand popup_rd common\">',\n                    $(\"#common_popup_rd\").html(),\n                    '</div>'\n                ].join(\"\")).siblings(\".popup_rd\").slideDown(\"fast\");\n            }\n        }\n    } else if (!$popupCont.find(\".popup_rd\").is(\":visible\")) {\n        if ($popupCont.is(\".offers:not(.cashback)\")) {\n            mspid = $(\"#mspSingleTitle\").data(\"mspid\");\n            storename = $(this).closest(\".store_pricetable\").data(\"storename\");\n            currentColour = $(\".filter_colour\").length ? ($(\".filter_colour\").find(\".selected\").data(\"callout\") || \"default\") : \"default\";\n\n            if (handler.popupData.colour !== currentColour) {\n                $.ajax({\n                    \"url\": \"/msp/offertext_ajax.php\",\n                    \"dataType\": \"json\",\n                    \"data\": {\n                        \"mspid\": mspid,\n                        \"color\": (currentColour !== \"default\") ? currentColour : undefined\n                    }\n                }).done(function(response) {\n                    handler.popupData.content = response;\n                    popupDetails = response[storename];\n                    $popupCont.append(getPopupHtml(popupDetails));\n                    $popupCont.find(\".popup_rd\").slideDown(\"fast\");\n                });\n            } else {\n                popupDetails = handler.popupData.content[storename];\n                $popupCont.append(getPopupHtml(popupDetails));\n                $popupCont.find(\".popup_rd\").slideDown(\"fast\");\n            }\n        } else {\n            $popup = $popupCont.find(\".popup_rd\");\n            if ($popup.hasClass(\"coupon_expand\")) {\n                if (Modules.Cookie.get(\"msp_login\") == \"1\" && Modules.Cookie.get(\"msp_login_email\") && !$.trim($popup.find(\".coupon_value\").text())) {\n                    $popup.find(\".coupon_email\").val(Modules.Cookie.get(\"msp_login_email\"));\n                    $popup.find(\".coupon_form\").submit();\n                }\n            }\n            $popup.slideDown(\"fast\");\n        }\n    }\n\n    function getPopupHtml(popupDetails) {\n        return [\n            '<div class=\"offers_expand popup_rd\">',\n            '<div class=\"head\">',\n            '<div class=\"title\">Offer Details</div>',\n            '<div class=\"closebutton\">&times;</div>',\n            '<br clear=\"all\">',\n            '</div>',\n            '<div class=\"text\">',\n            popupDetails,\n            '</div>',\n            '</div>'\n        ].join(\"\");\n    }\n});\n\n$('body').on('click', '.closebutton', function(event) {\n    $(this).parents('.popup_rd').slideUp(\"fast\");\n    event.stopPropagation();\n});\n\nvar PriceTable = {\n    \"dataPoints\": {\n        \"category\": $(\".body-wrpr\").attr(\"category\"),\n        \"mspid\": $(\".prdct-dtl__ttl\").data(\"mspid\"),\n        \"defaultRows\": 6, // $(\".prc-tbl-row:visible\").length\n        \"previousCategory\": \"recommended\",\n        \"onload\": true,\n        \"colorChange\": false,\n        \"prevColor\": null,\n        \"variant\": {\n            \"model\": $(\".prdct-dtl__ttl-vrnt\").data(\"model\"),\n            \"size\": $(\".prdct-dtl__ttl-vrnt\").data(\"size\")\n        },\n        \"partialOnlineRows\": true,\n        \"price\": {\n            \"getMrp\": function() {\n                return $(\".prdct-dtl__slr-prc-mrp-prc\").data(\"value\")\n            },\n        },\n        \"productThumb\": $(\".prdct-dtl__thmbnl-img\").eq(0).attr(\"src\"),\n        \"cardLoading\": false,\n        \"getTitle\": function() {\n            return $(\".prdct-dtl__ttl\").text();\n        },\n        \"getSelectedColor\": function() {\n            return $(\".avlbl-clrs__inpt:checked\").val()\n        },\n        \"getAppliedSort\": function() {\n            return $(\".js-prc-tbl__sort\").val();\n        },\n        \"getAppliedFilters\": function() {\n            return $.map($(\".prc-tbl__fltrs-inpt:checked\"), function(node) {\n                return $(node).attr(\"value\");\n            });\n        },\n        \"getSelectedCategory\": function() {\n            return $(\".prc-tbl__ctgry-inpt:checked\").val();\n        },\n        \"getSelectedCategoryLabel\": function() {\n            return $(\".prc-tbl__ctgry-inpt:checked\").data(\"label\");\n        }\n    },\n    \"init\": function() {\n\n        //PriceTable.updateMoreStores();\n\n        var $pageTitle = $(\".prdct-dtl__ttl\");\n\n        // show/hide price card details\n        $(\"body\").on(\"click\", \".js-show-prc-card-dtls\", function(e) {\n            var $tooltip = $(this).siblings(\".prc-card__dtls-tltp\");\n            $(\".prc-card__dtls-tltp\").not($tooltip).slideUp();\n            $tooltip.stop(true, true).slideToggle();\n            e.stopPropagation();\n        }).on(\"click\", \".prc-card__dtls\", function(e) {\n            e.stopPropagation();\n        }).on(\"click\", function() {\n            $(\".prc-card__dtls-tltp\").slideUp();\n        });\n\n        /* Price Table handlers for new UI */\n\n\n        Modules.$doc.on(\"click\", \".js-expnd-grid\", function() {\n\n\n            if (PriceTable.dataPoints.cardLoading) {\n                return false;\n            }\n            var $textContainer = $(this).parents(\".prc-grid\").find(\".prc-grid__more-dtls\");\n            var showText = $textContainer.attr(\"data-show-txt\");\n            var hideText = $textContainer.attr(\"data-hide-txt\");\n            var toggleText = $textContainer.text().split(\"\")[0].trim() == showText ? hideText + \"<span class='prc-grid__arw-up'> </span>\" : showText + \"<span class='prc-grid__arw'> </span>\";\n\n            var $priceGrid = $(this).closest(\".prc-grid\");\n            var $detailCard = $priceGrid.children(\".prc-grid-expnd\");\n            var storeName = $priceGrid.data(\"storename\");\n            var mspid = PriceTable.dataPoints.mspid;\n\n\n            $textContainer.html(toggleText);\n\n            if ($detailCard.hasClass(\"js-has-data\")) {\n                //Remove the Data\n                $detailCard.children(\".prc-grid-expnd__data\").remove();\n                $detailCard.css(\"height\", \"0\");\n\n            } else {\n                //Get the Data and append it\n                PriceTable.dataPoints.cardLoading = true;\n                $loader = '<div class=\"prc-grid-expnd__data\"><div class=\"ldr ldr--sml\"><div class=\"ldr__crcl\"></div><div class=\"ldr__text\" style=\"\">Loading...</div> </div></div>'\n                $detailCard.append($loader);\n\n                matchChildHeight($detailCard, \".prc-grid-expnd__data\");\n\n                PriceTable.fetch.cardData(mspid).done(function(response) {\n                    $detailCard.empty();\n                    $detailCard.append(response[storeName]);\n\n                    matchChildHeight($detailCard, \".prc-grid-expnd__data\");\n                    PriceTable.dataPoints.cardLoading = false;\n                });\n\n            }\n\n            $detailCard.toggleClass(\"js-has-data\");\n        });\n\n        Modules.$doc.on(\"click\", \".js-expnd-offr\", function() {\n\n\n            if (PriceTable.dataPoints.cardLoading) {\n                return false;\n            }\n            var $textContainer = $(this).parents(\".prc-grid\").find(\".prc-grid__more-dtls\");\n            var showText = $textContainer.attr(\"data-show-txt\");\n            var hideText = $textContainer.attr(\"data-hide-txt\");\n            var toggleText = $textContainer.text().split(\"\")[0].trim() == showText ? hideText + \"<span class='prc-grid__arw-up'> </span>\" : showText + \"<span class='prc-grid__arw'> </span>\";\n\n            var $priceGrid = $(this).closest(\".prc-grid\");\n            var $detailCard = $priceGrid.children(\".prc-grid-expnd\");\n            var storeName = $priceGrid.data(\"storename\");\n            var mspid = PriceTable.dataPoints.mspid;\n\n\n            $textContainer.html(toggleText);\n\n            if ($detailCard.hasClass(\"js-has-data\")) {\n                $detailCard.children(\".prc-grid-expnd__data\").hide();\n                $detailCard.css(\"height\", \"0\");\n\n            } else {\n                $detailCard.children(\".prc-grid-expnd__data\").show();\n                matchChildHeight($detailCard, \".prc-grid-expnd__data\");\n\n            }\n\n            $detailCard.toggleClass(\"js-has-data\");\n        });\n\n        Modules.$doc.on(\"click\", \".js-cls-grid\", function() {\n            $(this).parent().css(\"height\", \"0px\");\n        });\n\n        function toggleCards($button) {\n            var moreText = $button.attr(\"data-more-txt\");\n            var fewText = $button.attr(\"data-few-txt\");\n\n            var toggleText = $button.text() == moreText ? fewText : moreText;\n\n\n            $button.text(toggleText);\n            var showAll = $button.attr(\"data-few-txt\") == $button.text();\n            alignPriceCards(showAll);\n        }\n\n        Modules.$doc.on(\"click\", \".js-more-strs\", function() {\n            $button = $(this);\n            PriceTable.update.allCards(PriceTable.dataPoints.prevColor).done(function(response) {\n                toggleCards($button);\n            });\n\n        });\n        /* End of Price table handlers for new UI*/\n\n        // select color and updatePage.\n        Modules.$doc.on(\"click\", \".avlbl-clrs__inpt\", (function() {\n            PriceTable.dataPoints.prevColor = PriceTable.dataPoints.getSelectedColor();\n\n            return function() {\n                var $this = $(this),\n                    $variant = $(\".prdct-dtl__ttl-vrnt\"),\n                    $clearColor = $this.closest(\".prdct-dtl__vrnt-clr\").find(\".prdct-dtl__vrnt-cler\"),\n                    model = $variant.data(\"model\"),\n                    size = $variant.data(\"size\"),\n                    colorValue = $this.val();\n\n                if (colorValue === PriceTable.dataPoints.prevColor) {\n                    PriceTable.dataPoints.colorChange = false;\n                    $variant.text((model || size) ? (\"(\" + (model ? (size ? model + \", \" : model) : \"\") + (size || \"\") + \")\") : \"\");\n\n                    $clearColor.hide();\n                    $this.prop(\"checked\", false);\n                } else {\n                    PriceTable.dataPoints.colorChange = true;\n                    $variant.text(\"(\" + (model ? model + \", \" : \"\") + colorValue + (size ? \", \" + size : \"\") + \")\");\n\n                    $clearColor.show();\n                    PriceTable.dataPoints.prevColor = colorValue;\n                    $this.prop(\"checked\", true);\n                }\n\n\n                PriceTable.update.allCards(colorValue).done(function(response) {\n                    $(\".js-more-strs\").text($(\".js-more-strs\").attr(\"data-more-txt\"));\n                    alignPriceCards();\n                });\n\n            }\n        })());\n\n        // clear selected color and updatePage.\n        Modules.$doc.on(\"click\", \".prdct-dtl__vrnt-clr .prdct-dtl__vrnt-cler\", function() {\n            var $variant = $(\".prdct-dtl__ttl-vrnt\"),\n                model = PriceTable.dataPoints.variant.model,\n                size = PriceTable.dataPoints.variant.size;\n\n            // set color change to true\n            PriceTable.dataPoints.colorChange = true;\n            PriceTable.dataPoints.prevColor = null;\n\n            $(\".avlbl-clrs__inpt\").prop(\"checked\", false);\n            $variant.text((model || size) ? (\"(\" + (model ? (size ? model + \", \" : model) : \"\") + (size || \"\") + \")\") : \"\");\n            $(this).hide();\n\n            $(\".prc-grid\").attr(\"data-show\", true);\n            PriceTable.update.allCards().done(function(response) {\n                $(\".js-more-strs\").text($(\".js-more-strs\").attr(\"data-more-txt\"));\n                alignPriceCards();\n            });\n\n        });\n\n        // load the variant page selected.\n        Modules.$doc.on(\"click\", \".avlbl-sizes__item\", function() {\n            var $this = $(this);\n            if (!$this.hasClass(\"avlbl-sizes__item--slctd\") && !$this.parents(\".avlbl-sizes\").hasClass(\"avlbl-sizes--no-slct\")) {\n                window.location.href = $this.data(\"href\");\n            }\n        });\n\n        // switch between recommended, online, offline pricetables.\n        Modules.$doc.on(\"click\", \".js-ctgry-inpt\", (function() {\n            return function() {\n                var $this = $(this),\n                    previousValue = PriceTable.dataPoints.previousCategory,\n                    currentValue = $this.attr(\"value\"),\n                    isSelected = currentValue === previousValue;\n\n                if (!isSelected) {\n                    $(\".js-ctgry-inpt\").prop(\"checked\", false);\n                    $this.prop(\"checked\", true);\n\n                    PriceTable.dataPoints.previousCategory = currentValue;\n                    PriceTable.update.byFilter(currentValue);\n                }\n            };\n        })());\n\n        // trigger offline area switcher\n        Modules.$doc.on(\"click\", \".prdct-dtl__slr-offln-area\", function() {\n            $(\".usr_location__wrpr\").trigger(\"click\");\n            return false;\n        });\n\n        // online and offline stores - user choice\n        Modules.$doc.on('click', '.js-offln-click', function() {\n            $('.js-ctgry-inpt[value=\"offline\"]').trigger('click');\n        });\n        Modules.$doc.on('click', '.js-onln-click', function() {\n            $('.js-ctgry-inpt[value=\"online\"]').trigger('click');\n        });\n\n        // apply filters to current pricetable.\n        Modules.$doc.on(\"click\", \".prc-tbl__fltrs-inpt\", function() {\n            PriceTable.update.byFilter(undefined, {\n                \"latitude\": window.localStorage.userLatitude,\n                \"longitude\": window.localStorage.userLongitude\n            });\n        });\n\n        // sort current pricetable.\n        ;\n        (function pricetableSortingHandlers() {\n            Modules.$doc.on(\"change\", \".js-prc-tbl__sort\", function() {\n                var newSortby = $(this).val(),\n                    category = newSortby.split(\":\")[0],\n                    $updatedColumn = $(\".prc-tbl-hdr__clm[data-sort-category='\" + category + \"']\");\n\n                // fetch fresh data if all stores are not loaded\n                if (PriceTable.dataPoints.partialOnlineRows) {\n                    PriceTable.update.byFilter(undefined, {\n                        \"latitude\": window.localStorage.userLatitude,\n                        \"longitude\": window.localStorage.userLongitude\n                    });\n                    return;\n                }\n\n                updatePriceTableColumns($updatedColumn, newSortby);\n\n                PriceTable.sort(newSortby);\n            });\n\n            Modules.$doc.on(\"click\", \".prc-tbl-hdr__clm[data-sort-value]\", function() {\n                var newSortby = $(this).data(\"sort-value\");\n\n                // change sort dropdown value to trigger pricetable update accordingly.\n                $(\".js-prc-tbl__sort\").val(newSortby).change();\n            });\n\n            function updatePriceTableColumns($updatedColumn, newSortby) {\n                var newSortby, nextSortby, category, newOrder, oldOrder, nextOrder;\n\n                if ($updatedColumn.length) {\n                    // get category and new order to be applied.\n                    category = newSortby.split(\":\")[0];\n                    newOrder = newSortby.split(\":\")[1];\n\n                    /**\n                     * MSP.utils.rotateValue => rotate values in a set,\n                     * used here to toggle between two values.\n                     */\n                    oldOrder = nextOrder = Modules.cycleShift([\"asc\", \"desc\"], newOrder);\n                    nextSortby = category + \":\" + nextOrder;\n\n                    // assign new sort value and class to the column\n                    $updatedColumn.data(\"sort-value\", nextSortby);\n                    $updatedColumn.find(\".prc-tbl-hdr__arw\").removeClass(\"prc-tbl-hdr__arw--\" + oldOrder).addClass(\"prc-tbl-hdr__arw--\" + newOrder);\n                    // reset all columns label to unsorted and apply sorting to current column.\n                    $(\".prc-tbl-hdr__clm[data-sort-category]\").removeClass(\"prc-tbl-hdr__clm--slctd\").find(\".prc-tbl-hdr__cptn\").text(\"Sort By\");\n                    $updatedColumn.addClass(\"prc-tbl-hdr__clm--slctd\").find(\".prc-tbl-hdr__cptn\").text(\"Sorted By\");\n                } else {\n                    // reset all columns to unsorted\n                    $(\".prc-tbl-hdr__clm[data-sort-category]\").removeClass(\"prc-tbl-hdr__clm--slctd\").find(\".prc-tbl-hdr__cptn\").text(\"Sort By\");\n                }\n            }\n        }());\n\n        // show more stores.\n        Modules.$doc.on('click', '.js-prc-tbl__show-more', function handler() {\n            var $this = $(this),\n                $inner = $this.find(\".prc-card__more-inr\"),\n                $priceLines = $(\".prc-card\").not($this),\n                isCollapsed = $this.data(\"collapsed\"),\n                defaultRows = PriceTable.dataPoints.defaultRows,\n                allRows = $priceLines.length;\n\n            // disable click during load by removing class\n            $this.removeClass('js-prc-tbl__show-more');\n\n            handler.innerHtml = handler.innerHtml || $inner.html();\n\n            // Check if more than 6 stores are visible:\n            if (isCollapsed && !($('.js-offln-avl').length) && !(allRows - defaultRows)) {\n                PriceTable.update.byFilter(); // no store type (online) and no location :: in case No offline stores\n                PriceTable.dataPoints.partialOnlineRows = false;\n\n                $this.addClass('js-prc-tbl__show-more'); // enable click and return\n                setTimeout(function() { $this.trigger('click'); }, 1500);\n                return;\n            }\n\n            $priceLines.slice(defaultRows).fadeToggle(400, function() {\n                var $moreCard = $(\".prc-card--more\");\n                $moreCard.css(\"margin-left\", ($moreCard.index(\".prc-card:visible\") % 3) ? \"14px\" : \"0\");\n            });\n\n            if (isCollapsed) {\n                $inner.text(\"See less stores\");\n                $(\"html, body\").animate({\n                    scrollTop: $priceLines.eq(defaultRows - 1).offset().top - $(\".hdr-size\").height()\n                });\n                $this.data(\"collapsed\", false);\n            } else {\n                $inner.html(handler.innerHtml);\n                $(\"html, body\").animate({\n                    scrollTop: $priceLines.eq(defaultRows).offset().top - $(window).height() + ($(\".hdr-size\").height() * 2)\n                });\n                $this.data(\"collapsed\", true);\n            }\n\n            // enable click\n            $this.addClass('js-prc-tbl__show-more');\n        });\n\n        /* more offers message box handlers - start */\n        Modules.$doc.on(\"click\", \".js-xtrs-msg-box-trgt\", function handler(e) {\n            var $popupCont = $(this),\n                $popup = $popupCont.find(\".prc-tbl__xtrs-clm-pop\"),\n                $row = $(this).closest(\".prc-tbl-row\"),\n                mspid, currentColour, storename, offerDetails, offersMsgBoxHtml, msgBox;\n\n            if ($popupCont.hasClass('cashback') || $popupCont.hasClass('offline')) {\n                msgBox = $popupCont.find('.msg-box');\n                msgBox.toggleClass('msg-box--show');\n                return;\n            }\n\n            if (!$(e.target).hasClass(\"js-xtrs-msg-box__cls\")) {\n                handler.popupData = handler.popupData || {};\n                if (!$popup.hasClass(\"msg-box--show\")) {\n                    mspid = PriceTable.dataPoints.mspid;\n                    storename = $row.data(\"storename\");\n                    currentColour = PriceTable.dataPoints.getSelectedColor() || false;\n\n                    if (handler.popupData.colour !== currentColour) {\n                        PriceTable.fetch.offersPopups(mspid, currentColour).done(function(response) {\n                            handler.popupData.content = response;\n                            offerDetails = response[storename];\n\n                            offersMsgBoxHtml = PriceTable.components.offersMsgBox(offerDetails);\n                            $popupCont.append(offersMsgBoxHtml);\n                            var reflow = $(\"body\").offset().top;\n                            $popupCont.find(\".msg-box\").addClass(\"msg-box--show\");\n                        });\n                    } else {\n                        offerDetails = handler.popupData.content[storename];\n                        offersMsgBoxHtml = PriceTable.components.offersMsgBox(offerDetails);\n\n                        $popupCont.append(offersMsgBoxHtml);\n                        $popupCont.find(\".msg-box\").addClass(\"msg-box--show\");\n                    }\n                }\n            }\n        });\n\n        Modules.$doc.on(\"click\", \".js-xtrs-msg-box__cls\", function() {\n            var $this = $(this),\n                $xtrasLink = $this.closest('.js-xtrs-msg-box-trgt');\n\n            if ($xtrasLink.hasClass('cashback') || $xtrasLink.hasClass('offline')) {\n                return;\n            }\n\n            $this.closest(\".msg-box\").remove();\n        });\n\n        // close all message boxes on pressing escape key\n        $('body').keydown(function(e) {\n            if (e.which == 27 && $('.msg-box').is(':visible')) {\n                $('.js-msg-box__cls, .js-xtrs-msg-box__cls').click();\n            }\n        });\n        /* more offers message box handlers - end */\n    },\n    \"update\": {\n        \"allCards\": function(_currentColour) {\n            var dfd = $.Deferred();\n            var _mspid = PriceTable.dataPoints.mspid;\n            $loader = \"<div class='prc-grid--ldr'><div class='ldr'><div class='ldr__crcl'></div></div></div>\";\n            $(\".prc-grid-wrpr\").append($loader);\n            PriceTable.fetch.allTableData(_mspid, _currentColour).done(function(response) {\n                $(\".prc-grid--ldr\").remove();\n                $(\".prc-grid-wrpr\").html(response);\n                PriceTable.update.miniPriceTable(response);\n                showCplWidget();\n                updateSidebarPriceTable();\n                dfd.resolve();\n            });\n            return dfd.promise();\n        },\n\n        \"miniPriceTable\": function(response) {\n            var $responseHolder = $('<div>' + response + '</div>'),\n                $priceGrids = $responseHolder.find('.prc-grid'),\n                lines = $priceGrids.length,\n                numMoreStores,\n                gridData = {},\n                gridTemplater = function(storeLogoUrl, price, shippingInfo, gtsUrl) {\n                    return [\n                        '<div class=\"prc-tbl__row-wrpr\">',\n                            '<div class=\"prc-tbl__row clearfix\">',\n                                '<div class=\"prc-tbl__logo\"><img class=\"prdct-dtl__str-icon\" src=\"' + storeLogoUrl + '\"></div>',\n                                '<div class=\"prc-tbl__info\">',\n                                    '<div class=\"prc-tbl__prc\">',\n                                        '&#8377;' + price,\n                                    '</div>',\n                                '</div>',\n                                '<div class=\"prc-tbl__btn\">',\n                                    '<div class=\"bttn bttn--gts prc-tbl__gts-btn js-prc-tbl__gts-btn\" data-cookiename=\"\" data-cookietimedays=\"\" data-href=\"\" data-url=\"' + gtsUrl + '\"></div>',\n                                '</div>',\n                            '</div>',\n                        '</div>'\n                    ].join('');\n                },\n                $miniPriceTable = $('.prc-tbl'),\n                miniPriceTableData = '';\n\n            lines = lines < 4 ? lines : 4;\n            numMoreStores = $priceGrids.length - lines;\n\n            for(var i = 0;i < lines; i++) {\n                var $priceGrid = $priceGrids.eq(i); // Fetch each individual grid\n                gridData.store = $priceGrid.data('storename').toLowerCase();\n                if(gridData.store === 'ebay_1') {\n                    gridData.store = 'ebay';\n                }\n                gridData.storeLogoUrl = 'https://assets.mspcdn.net/q_auto/logos/partners/' + gridData.store + '_store.png';\n                gridData.price = $priceGrid.find('.prc-grid__prc-val').text().replace(/[^0-9,]/g,'');\n                gridData.shippingInfo = $priceGrid.find('.prc-grid__shpng').text();\n                gridData.gtsUrl = $priceGrid.find('.js-prc-tbl__gts-btn').data('url');\n                miniPriceTableData += gridTemplater(gridData.storeLogoUrl, gridData.price, gridData.shippingInfo, gridData.gtsUrl);\n            }\n\n            if(numMoreStores > 0) {\n                miniPriceTableData += [\n                    '<div class=\"prc-tbl__more-info clearfix\">',\n                        '<div class=\"prc-tbl__more-strs text-link js-inpg-link\" data-href=\"price-table\">',\n                            numMoreStores + ' more stores ',\n                        '</div>',\n                    '</div>'\n                ].join('');\n            }\n\n            $miniPriceTable.html(miniPriceTableData);\n        },\n\n        \"byFilter\": function(storetype, location) { // pass storetype as 'undefined' for all data\n            var _loadingMaskHTML = PriceTable.components.loadingMask(),\n                _innerPriceTable = $(\".prc-grid-wrpr\"),\n                _sort = $('.sort-wrpr__ctgry-inpt:checked').attr('value'),\n                _type = storetype || $('.js-ctgry-inpt:checked').attr('value'),\n                _appliedFilters = PriceTable.dataPoints.getAppliedFilters(),\n                _colour = PriceTable.dataPoints.getSelectedColor();\n\n            _innerPriceTable.append(_loadingMaskHTML);\n\n            PriceTable.fetch.tableByFilter(_type, _sort, _appliedFilters, location, _colour).done(function(json) {\n                if (json) {\n                    // if pricetable data is available update price table with html received\n                    if (json.pricetable) {\n                        // check for no stores in response\n                        var _searchValue = \"prc-grid\",\n                            _responsePriceTable = json.pricetable,\n                            _index = _responsePriceTable.search(_searchValue);\n\n                        if (_index == -1) {\n                            _innerPriceTable.html('<div class=\"no-strs\">No stores available</div>');\n                        } else {\n                            _innerPriceTable.html(json.pricetable);\n\n                            var $allStores = $(\".prc-grid, .prc-grid--ofln\"),\n                                $moreCard = $(\".prc-grid--more\");\n\n                            if ($allStores.length > PriceTable.dataPoints.defaultRows) {\n                                $allStores.slice(PriceTable.dataPoints.defaultRows).hide();\n\n                                var $priorityStores = $(\".prc-grid[data-storename='amazon'], .prc-grid[data-storename='flipkart']\").not(\":visible\");\n                                if ($priorityStores.length) {\n                                    $priorityStores.insertAfter($(\".prc-grid\").eq(PriceTable.dataPoints.defaultRows - 1)).show();\n                                    PriceTable.dataPoints.defaultRows = $allStores.filter(\":visible\").length;\n\n                                    var hiddenStores = $allStores.not(\":visible\").length;\n                                    if (hiddenStores)\n                                        $(\".prc-grid__more-inr\").text(\"See \" + hiddenStores + \" more \" + (hiddenStores > 1 ? \"stores\" : \"store\"));\n                                    else\n                                        $moreCard.hide();\n                                }\n                            }\n\n                            $moreCard.css(\"margin-left\", ($moreCard.index(\".prc-card:visible\") % 3) ? \"14px\" : \"0\");\n\n                            //PriceTable.updateMoreStores();\n                        }\n                    }\n\n                    // color change affects online stores\n                    if (PriceTable.dataPoints.colorChange) {\n                        if (json.online_store_count) {\n                            $('.prdct-dtl__slr-onln .lghtr').html('Starting from');\n                            $('.prdct-dtl__slr-onln .prdct-dtl__slr-hghlght').html(' ' + json.online_best_price);\n                            $('.js-onln-click.btn.btn-strs').html('View ' + json.online_store_count + ' Online Stores &#187;');\n                        } else {\n                            $('.prdct-dtl__slr-onln .lghtr').html('No Online stores available');\n                            $('.prdct-dtl__slr-onln .prdct-dtl__slr-hghlght').html('');\n                            $('.js-onln-click.btn.btn-strs').html('No Online stores listed');\n                        }\n                        // lowest price will be online price if offline isn't available \n                        // (overwritten in offline check - next if)\n                        $('.prdct-dtl__slr-prc-rcmnd-val').text(json.online_best_price).data('value', json.online_best_price_raw);\n                    }\n\n                    // for only offline calculations\n                    // check if offline stores are returned (first check)\n                    if ($(\".prdct-dtl__ttl\").data(\"offlinedelivery\") == \"Y\" || $(\".prdct-dtl__ttl\").data(\"jdavailable\") == \"Y\") {\n                        // Display the brand auth seller widget to the right within product pane\n                        // Parse the location values from localstorage and cookie respectively\n\n                        // other offline calculations\n                        PriceTable.dataPoints.partialOnlineRows = false;\n                        if (PriceTable.dataPoints.onload || PriceTable.dataPoints.colorChange) {\n                            // set lowest price btw online and offline \n                            var _lowest = parseInt($('.prdct-dtl__slr-prc-rcmnd-val').data('value')) || 99999999;\n                            if (_lowest > json.offline_best_price_raw) {\n                                $('.prdct-dtl__slr-prc-rcmnd-val').text(json.offline_best_price).data('value', json.offline_best_price_raw);\n                            }\n\n                            $('.prc-tbl__ctrls').css('display', 'block');\n                            $('.prc-tbl-hdr').css('border-top', '1px solid #dfe1e8');\n                            $('.js-strs-offln-prc').html(' ' + json.offline_best_price);\n                            $('.js-strs-offln-cnt').html('View ' + json.offline_store_count + ' Nearby Stores &#187;');\n                            $('.prdct-dtl__slr').addClass('js-offln-avl');\n                            PriceTable.dataPoints.onload = false;\n                        }\n                    }\n\n                    alignPriceCards();\n\n                    // set colorChange to default\n                    PriceTable.dataPoints.colorChange = false;\n\n                } else {\n                    _innerPriceTable.html('<div class=\"no-strs\">No stores returned</div>');\n                }\n                // display online/offline store based on availability\n                if ($('.js-offln-avl').length) { // both offline and online are available\n                    var _allStores = $('.prdct-dtl__slr-strs'),\n                        _unavailableStores = $('.prdct-dtl__slr-strs-ntfy'),\n                        _onlineStores = $('.prdct-dtl__slr-onln');\n                    if (!_onlineStores.length) { // no online stores\n                        _unavailableStores.remove();\n                    } else { // online stores available\n                        _allStores.removeClass('prdct-dtl__slr-strs--l');\n                    }\n                }\n            }).fail(function() {\n                _innerPriceTable.find('.js-fltr-ldng-mask').remove();\n            });\n        }\n    },\n    \"sort\": function(sortby) {\n        var $priceTableContainer = $('.prc-tbl-inr'),\n            $priceTableRows = $('.prc-tbl-row'),\n            sortColumn = sortby.split(\":\")[0],\n            sortOrder = sortby.split(\":\")[1],\n            sortTypes,\n            $hideXtrscashback = $('.js-xtrs-msg-box-trgt.cashback').find('msg-box--show'),\n            $hideXtrsoffline = $('.js-xtrs-msg-box-trgt.offline').find('msg-box--show'),\n            $hideOffers = $('.js-xtrs-msg-box-trgt').not('.cashback');\n\n        // close all messageBoxes before sorting priceTable\n        $hideOffers.find('.js-msg-box__cls, .js-xtrs-msg-box__cls').click();\n        $hideXtrsoffline.removeClass('msg-box--show');\n        $hideXtrscashback.removeClass('msg-box--show');\n\n        sortTypes = {\n            \"popularity\": { \"attr\": \"data-relrank\" },\n            \"price\": { \"attr\": \"data-pricerank\" },\n            \"price\": { \"attr\": \"data-pricerank\" },\n            \"rating\": { \"attr\": \"data-rating\" },\n            \"rating\": { \"attr\": \"data-rating\" }\n        };\n\n        $priceTableContainer.css({\n            height: $priceTableContainer.height(),\n            display: 'block'\n        });\n\n        $priceTableRows.show();\n        $priceTableRows.each(function(i, el) {\n            var iY = $(el).position().top;\n            $.data(el, 'h', iY);\n        });\n\n        if (sortby === 'popularity') {\n            $('.prc-tbl-row--NA').attr(\"data-relrank\", \"9999\");\n        } else if (sortby === 'price:asc') {\n            $('.prc-tbl-row--NA').attr(\"data-pricerank\", \"9999999\");\n        } else if (sortby === 'price:desc') {\n            $('.prc-tbl-row--NA').attr(\"data-pricerank\", \"0\");\n        } else if (sortby === 'rating:asc') {\n            $('.prc-tbl-row--NA').attr(\"data-rating\", \"6\");\n            $('.prc-tbl-row--NA').find('.js-prc-tbl__str-rtng').attr(\"data-rating\", \"6\");\n        } else if (sortby === 'rating:desc') {\n            $('.prc-tbl-row--NA').attr(\"data-rating\", \"-1\");\n            $('.prc-tbl-row--NA').find('.js-prc-tbl__str-rtng').attr(\"data-rating\", \"-1\");\n        }\n\n        $('.prc-tbl-row').tsort({\n            \"attr\": sortTypes[sortColumn].attr,\n            \"order\": sortOrder\n        }).each(function(i, el) {\n            var $El = $(el);\n            var iFr = $.data(el, 'h');\n            var iTo = 0;\n            $El.prevAll('.prc-tbl-row:visible').each(function() {\n                iTo += $(this).outerHeight();\n            });\n            $El.css({\n                position: 'absolute',\n                top: iFr\n            }).stop().animate({\n                top: iTo\n            }, 500, function() {\n                $priceTableRows.css({\n                    position: 'relative',\n                    top: 'auto'\n                });\n                $priceTableContainer.css({\n                    height: 'auto',\n                    display: 'block'\n                });\n\n                if ($(\".js-prc-tbl__show-more\").data(\"collapsed\")) {\n                    $('.prc-tbl-row').slice(PriceTable.dataPoints.defaultRows).hide();\n                } else {\n                    $('.prc-tbl-row').slice(PriceTable.dataPoints.defaultRows).show();\n                }\n            });\n        });\n    },\n    \"components\": {\n        \"loadingMask\": function() {\n            return [\n                '<div class=\"js-fltr-ldng-mask\">',\n                '<div class=\"ldr\">',\n                '<div class=\"ldr__crcl\"></div>',\n                '<div class=\"ldr__text\" style=\"\">Loading...</div> ',\n                '</div>',\n                '</div>'\n            ].join(\"\");\n        },\n        \"offersMsgBox\": function(offerDetails) {\n            var offerCount = 1,\n                offerRows, msgBoxHtml,\n                _regex = /<li>/;\n\n            if (_regex.test(offerDetails)) {\n                offerCount = $(offerDetails).find(\"li\").length || 1,\n                    offerRows = (function() {\n                        var result = \"\";\n                        if (offerCount) {\n                            $(offerDetails).find(\"li\").each(function() {\n                                result += '<div class=\"msg-box__row\">' + $(this).html() + '</div>';\n                            });\n                        } else {\n                            result += '<div class=\"msg-box__row\">' + $(offerDetails).html() + '</div>';\n                        }\n                        return result;\n                    }());\n            } else {\n                offerRows = '<div class=\"msg-box__row\">' + offerDetails + '</div>';\n            }\n\n            msgBoxHtml = [\n                '<div class=\"msg-box prc-tbl__xtrs-clm-pop\">',\n                '<div class=\"msg-box__hdr clearfix\">',\n                offerCount + ' Offers',\n                '<span class=\"msg-box__cls js-xtrs-msg-box__cls\"></span>',\n                '</div>',\n                '<div class=\"msg-box__inr\">',\n                offerRows,\n                '</div>',\n                '</div>',\n            ].join(\"\");\n\n            return msgBoxHtml;\n        }\n    },\n    \"fetch\": {\n        \"allTableData\": Modules.memoize(function(mspID, color) {\n            var dfd = $.Deferred(),\n                query = {\n                    \"mspid\": mspID,\n                    \"data\": \"table\",\n                    \"color\": color\n                };\n\n            setServingLocation();\n\n            $.ajax({\n                \"url\": \"/mobile/ptrows_details.php\",\n                \"data\": query\n            }).done(function(response) {\n                dfd.resolve(response);\n            }).fail(function(response) {\n                dfd.reject(response);\n            });\n            return dfd.promise();\n        }, {\n            cacheLimit: 10\n        }),\n        \"cardData\": Modules.memoize(function(mspID) {\n            var dfd = $.Deferred(),\n                query = {\n                    \"mspid\": mspID,\n                    \"data\": \"store\"\n                };\n\n            $.ajax({\n                \"url\": \"/mobile/ptrows_details.php\",\n                \"dataType\": \"json\",\n                \"data\": query\n            }).done(function(response) {\n                dfd.resolve(response);\n            }).fail(function(response) {\n                dfd.reject(response);\n            });\n            return dfd.promise();\n        }, {\n            cacheLimit: 10\n        }),\n        \"tableByFilter\": Modules.memoize(function(type, sort, appliedFilters, location, selectedColor) {\n            var dfd = $.Deferred(),\n                query = {\n                    \"mspid\": PriceTable.dataPoints.mspid,\n                    \"mrp\": PriceTable.dataPoints.price.getMrp() || 0,\n                    \"sort\": PriceTable.dataPoints.getAppliedSort(),\n                    \"colour\": (PriceTable.dataPoints.getSelectedColor() || \"\").toLowerCase(),\n                    \"cod\": appliedFilters.indexOf(\"cod\") !== -1,\n                    \"emi\": appliedFilters.indexOf(\"emi\") !== -1,\n                    \"returnpolicy\": appliedFilters.indexOf(\"returnPolicy\") !== -1,\n                    \"offers\": appliedFilters.indexOf(\"offers\") !== -1,\n                    \"coupons\": appliedFilters.indexOf(\"coupons\") !== -1,\n                    \"storetype\": type || \"recommended\",\n                    \"sort\": sort || \"popularity\",\n                    \"latitude\": location && location.latitude,\n                    \"longitude\": location && location.longitude,\n                    \"colour\": selectedColor || false\n                };\n\n            $.ajax({\n                \"url\": \"/mobile/filter_response_new.php\",\n                \"dataType\": \"json\",\n                \"data\": query\n            }).done(function(response) {\n                dfd.resolve(response);\n            }).fail(function(response) {\n                dfd.reject(response);\n            });\n\n            return dfd.promise();\n        }, {\n            cacheLimit: 10\n        }),\n        \"offersPopups\": Modules.memoize(function(mspid, color) {\n            var dfd = $.Deferred();\n            $.ajax({\n                \"url\": \"/msp/offertext_ajax.php\",\n                \"type\": \"GET\",\n                \"dataType\": \"json\",\n                \"data\": {\n                    \"mspid\": mspid,\n                    \"color\": color\n                }\n            }).done(function(response) {\n                dfd.resolve(response);\n            });\n            return dfd.promise();\n        }, {\n            cacheLimit: 10\n        })\n    },\n    // Update top stores section\n    \"updateMoreStores\": function() {\n        var moreRowsCount = $(\".prc-grid\").length - 1;\n        if (moreRowsCount > 0) {\n            $(\".js-str-cnt\").html(moreRowsCount + \" More \" + (moreRowsCount === 1 ? \"Store\" : \"Stores\")).show();\n        } else {\n            $(\".js-str-cnt\").hide();\n        }\n    }\n};\nPriceTable.init();\n\n// To Notify user when product becomes available\n// Includes both cases - \"Coming soon\" as well as \"Out of Stock\"\nModules.$doc.on('submit', '.js-ntfy-frm', function() {\n    var $inputField = $(this).find(\".js-ntfy-eml\"),\n        $errorNode = $(this).find(\".js-ntfy-err\");\n    MSP.utils.validate.form([{\n        \"type\": \"email\",\n        \"inputField\": $inputField,\n        \"errorNode\": $errorNode\n    }]).done(function() {\n        $.ajax({\n            \"url\": \"/price_alert/capture_email.php\",\n            \"data\": {\n                \"email\": $inputField.val(),\n                \"mspid\": PriceTable.dataPoints.mspid,\n                \"capture_point\": \"outofstock\",\n                \"popupname\": \"pricealert\"\n            }\n        });\n        // hide form & show success message.\n        $(\".js-ntfy-eml\").hide();\n        $(\".js-ntfy-sbmt\").hide();\n        $(\".js-ntfy-sccss\").fadeIn();\n    });\n    return false;\n});\n\n// if GTS is not a popup target then open storeUrl in new tab.\nModules.$doc.on(\"click\", \".js-prc-tbl__gts-btn\", function() {\n    debugger\n    var $this = $(this),\n        storeUrl = $this.data(\"url\"),\n        hasPopup = $this.hasClass(\"js-popup-trgt\") || $this.hasClass(\"js-lylty-popup-trgt\") || $this.hasClass(\"js-instatab-popup\"),\n        isEnabled = !$this.hasClass(\"btn-GTS--dsbld\");\n\n    if (!hasPopup && isEnabled) {\n        window.open(storeUrl);\n    }\n\n    return false;\n});\n\nModules.$doc.on(\"click\", \".js-ntfy-sbmt\", function() {\n    var $form = $(this).closest(\".js-ntfy-frm\"),\n        $inputField = $form.find(\".js-ntfy-eml\"),\n        $errorNode = $form.find(\".js-ntfy-err\");\n    MSP.utils.validate.form([{\n        \"type\": \"email\",\n        \"inputField\": $inputField,\n        \"errorNode\": $errorNode\n    }]).done(function() {\n        $.ajax({\n            \"url\": \"/price_alert/capture_email.php\",\n            \"data\": {\n                \"email\": $inputField.val(),\n                \"mspid\": PriceTable.dataPoints.mspid,\n                \"capture_point\": \"outofstock\",\n                \"popupname\": \"pricealert\"\n            }\n        });\n        // hide form & show success message.\n        $form.hide();\n        $(\".js-ntfy-sccss\").fadeIn();\n    });\n    return false;\n});\n\n/* Load GA events for GTS Clicks */\nModules.$doc.on('click', '.prc-tbl__btn .js-prc-tbl__gts-btn', function(e) {\n        var $parent = $(this).closest('.prc-tbl');\n        if($parent.hasClass('cards')) {\n            if($parent.hasClass('full')) {\n                logGTSEvent('Top-Price-Table--FullCards');\n            } else {\n                logGTSEvent('Top-Price-Table--Cards');\n            }\n        } else {\n            logGTSEvent('Top-Price-Table');\n        }\n    }).on('click', '.prc-grid__clmn-4 .js-prc-tbl__gts-btn', function(e) {\n        logGTSEvent('Bottom-Price-Table');\n    }).on('click', '.js-gts-sidebar', function(e) {\n        logGTSEvent('Sidebar-Price-Table');\n    });\n\n(function backToStoreAndLowestPrice() {\n        var lowestPrice = $('.prdct-dtl__prc-val').text().replace(/\\D/g, '');\n        // find lowest price store grid:\n        $('.prc-grid[data-pricerank=' + lowestPrice + ']').addClass('prc-grid--lwst-price');\n        // find visited store grid:\n        if(url.getAQueryParam && url.getAQueryParam('utm_medium')) {\n            $('.prc-grid[data-storename=' + url.getAQueryParam('utm_medium') + ']').addClass('prc-grid--vstd-store');\n        }\n    }());\n\n    (function NCgaEvents() {\n        if ($(\".prc-grid__gts-btn--mdl--ncCompare\")[0]) {\n            $(\".prc-grid__gts-btn--mdl--ncCompare\").on(\"click\", function() {\n                if (window.ga) {\n                    ga('send', 'event', 'Non-Comparables', 'Click', 'price-table-gts');\n                }\n            });\n        }\n\n        if($(\".prdct-dtl__ttl\").data(\"page-type\")==\"nc\" && $(\".prc-grid\").length && window.ga){\n            ga('send', 'event', 'Non-Comparables', 'gtsLoad', 'price-table-gts', { nonInteraction: true });\n        }\n    }());\n\nfunction adjustGridStyle() {\n    $(\".prc-grid--no-brdr\").removeClass(\"prc-grid--no-brdr\");\n    $(\".prc-grid\").filter(\":visible:last\").addClass(\"prc-grid--no-brdr\");\n}\n\nfunction matchChildHeight($element, childSelector) {\n    var newHeight = $element.children(childSelector).outerHeight(true);\n    $element.css(\"height\", newHeight + \"px\");\n}\n\nfunction alignPriceCards(showAll) {\n    if (showAll) {\n        $(\".prc-grid\").show();\n    } else {\n        $(\".prc-grid:visible\").slice(6).hide();\n    }\n\n\n    if ($(\".prc-grid\").length >= 6) {\n        $(\".js-more-strs\").show();\n    } else {\n        $(\".js-more-strs\").hide();\n    }\n    adjustGridStyle();\n}\nalignPriceCards();\n\n/* A/B Testing; 20% users see cards in Price Table */\n(function() {\n    var mspUid = +Modules.Cookie.get('msp_uid');\n    if(mspUid % 10 < 2) { // 20% of users \n        $('.prc-tbl').addClass('cards'); \n        if(mspUid % 10 < 1) { // 10% of users see only cards\n            window.ga && ga('send', 'event', 'Comparables', 'GTS-Page-View', 'Top-Price-Table--Cards');\n        } else { // Rest 10% of users see full width cards\n            $('.prc-tbl').addClass('full'); \n            window.ga && ga('send', 'event', 'Comparables', 'GTS-Page-View', 'Top-Price-Table--FullCards');\n        }\n    } else { // Remaining 80% of users (Normal pricetable)\n        window.ga && ga('send', 'event', 'Comparables', 'GTS-Page-View', 'Top-Price-Table');\n    }\n})();\n\n$(document).on(\"click\", \".prc-grid__instl-extnsn-btn\", function(e) {\n\n    var $thisButton = $(this),\n        $form = $(this).closest(\".prc-grid__no-stck-form\");\n\n    if($thisButton.hasClass(\"btn--dsbld\"))\n        return false;\n\n    $thisButton.html(\"Checking ...\");\n    $thisButton.addClass(\"btn--dsbld\");\n    $thisButton.removeClass(\"btn--blue\");\n    window.open(\"https://chrome.google.com/webstore/detail/mysmartprice/bofbpdmkbmlancfihdncikcigpokmdda?hl=en\");\n\n    var totalTimeElapsed = 0,\n        checkExtensionInterval = setInterval(function(){ \n            totalTimeElapsed += 10;\n            console.log(\"here\");\n            if(totalTimeElapsed > 120)\n                clearInterval(checkExtensionInterval);\n\n            if(Modules.isInstalled('plugin_id')) {\n                $form.hide();\n                $form.siblings(\".prc-grid__no-stck-scs\").fadeIn();\n                $form.siblings(\".prc-grid__no-stck-sub\").hide();\n\n                clearInterval(checkExtensionInterval);\n            } else {\n                if(totalTimeElapsed > 120){\n                    $thisButton.html(\"Add Extension\");\n                    $thisButton.removeClass(\"btn--dsbld\");\n                    $thisButton.addClass(\"btn--blue\");   \n                }\n            }\n        }, 10000);\n});\n\n// populating users email in notify me widget\nvar msp_login_email = Modules.Cookie.get(\"msp_login_email\") || \"\"\n$(\".prc-grid__no-stck-inpt\").val(msp_login_email);\n","/* function to create pricetable on the fly:\n * should be called everytime top price table changes */\nfunction createSidebarPriceTable(storesInfo) {\n    \"use strict\";\n\n    var $inrSctn, $hdrSctn, $sctn,\n        storesHTML = '',\n        featuredHTML = '',\n        $featuredStores, \n        $topPTMoreStore = $('.prc-tbl__more-info'),\n        favIconTemplate = function favIconTemplate(strname) {\n            return 'https://assets.mspcdn.net/msp-ui/fav-icon/' + strname + '.png';\n        },\n        logoTemplate = function logoTemplate(strname) {\n            return 'https://assets.mspcdn.net/q_auto/logos/partners/' + strname + '_store.png';\n        },\n        createFeaturedStore = function createFeaturedStore(store) {\n            return ['<div class=\"cols1-prdcts__ftrd\" data-strname=\"' + store.storeName + '\">',\n                    '<div>',\n                        '<div class=\"cols1-prdcts__ftrd-stre\"><img src=\"' + logoTemplate(store.storeName) + '\"></div>',\n                        '<div class=\"cols1-prdcts__ftrd-prc\">' + store.price + '</div>',\n                    '</div>',\n                    '<a rel=\"nofollow\" target=\"_blank\" href=\"' + store.gtsURL + '\" class=\"cols1-prdcts__ftrd-gts js-gts-sidebar ' + store.storeName + ' ' + store.classes + '\" data-url=\"' + store.gtsURL + '\"></a>',\n                '</div>'].join('');\n        },\n        $viewAll = $('<div class=\"cols1-prdcts__view-all text-link js-inpg-link\" data-href=\"price-table\">View all stores &raquo;</div>');\n\n    if(storesInfo) {\n        storesInfo.stores.forEach(function(store, idx) {\n            if(store.storeName.toLowerCase() === 'amazon' || store.storeName.toLowerCase() === 'flipkart') {\n                featuredHTML += createFeaturedStore(store);\n            } else {\n                storesHTML += [\n                    '<div class=\"cols1-prdcts__str\">',\n                        '<div class=\"cols1-prdcts__str-name\" data-strname=\"' + store.storeName + '\">',\n                            '<img class=\"cols1-prdcts__str-icon\" src=\"' + favIconTemplate(store.storeName) + '\">',\n                            '<span>' + (store.storeName.charAt(0).toUpperCase() + store.storeName.slice(1)) + '</span>',\n                        '</div>',\n                        '<a rel=\"nofollow\" target=\"_blank\" href=\"' + store.gtsURL + '\" class=\"cols1-prdcts__gts-btn js-gts-sidebar ' + store.classes + '\" data-url=\"' + store.gtsURL + '\">',\n                            store.price + ' &#10141;',\n                        '</a>',\n                    '</div>'\n                ].join('');\n            }\n        });\n        // Sort amazon & flipkart featured stores (Amazon first):\n        $featuredStores = $(featuredHTML).sort(function(a, b) {\n            return $(a).data('strname') < $(b).data('strname') ? -1 : 1;\n        });\n        // inner section:\n        $inrSctn = $('<div class=\"sctn__inr clearfix\"></div>')\n                    .prepend($(storesHTML))\n                    .prepend($featuredStores);\n        // full section:\n        $sctn = $('<div class=\"sctn cols1-prdcts clearfix\"></div>')\n                .append($inrSctn);\n\n        // View all only if there are actually more stores: \n        if($topPTMoreStore.length) {\n            $sctn.append($viewAll);\n        }\n\n        return $sctn;\n    }\n}\n\nfunction fetchTopPriceTableData() {\n    if($('.prc-tbl').length) {\n        var $topPriceTable = $('.prc-tbl'),\n            $rows = $topPriceTable.find('.prc-tbl__row'),\n            storesData = [];\n\n        if($rows) {\n            $rows.each(pushTopStoresData);\n        }\n\n        return {\n            product: $('.prdct-dtl__ttl').text() + $('.prdct-dtl__ttl-vrnt').text(),\n            productImage: $('.prdct-dtl__img').attr('src'),\n            stores: storesData\n        }\n    }\n\n    // *************\n\n    function pushTopStoresData(idx, store) {\n        var _$store = $(store),\n            _gtsURL = _$store.find('.js-prc-tbl__gts-btn').attr('data-url'),\n            newUrlObj = new Modules.Url(_gtsURL);\n        storesData.push({\n            storeName: newUrlObj.getAQueryParam('store'),\n            price: _$store.find('.prc-tbl__prc').text().trim(), // saving price as text (rupee + commas)\n            gtsURL: _gtsURL,\n            classes: _$store.find('.js-prc-tbl__gts-btn').attr('class').match(/js[^\\s]*/g, '').join(' ')\n        });\n    }\n}\n\nfunction updateSidebarPriceTable() {\n    var $newSidebarSection = createSidebarPriceTable(fetchTopPriceTableData());\n    if($('.cols1-prdcts').length) {\n        $('.cols1-prdcts').remove();\n    }\n    $('.main-wrpr__cols1').prepend($newSidebarSection);\n}\n\n/*\n * Throttled sidebar scroller for pdp pages (holds pricetable info)\n */\n(function sidebarScrollerPDP() {\n    \"use strict\";\n\n    var $mainWrapper = $('.main-wrpr'),\n        mainTop = $mainWrapper.offset().top,\n        mainLeft = $mainWrapper.offset().left,\n        $sidebar = $('.js-pdp-sidebar'),\n        $mainCol3 = $('.main-wrpr__cols3'),\n        mainCol3Width = $mainCol3.width(),\n        $mainCol1 = $('.main-wrpr__cols1'),\n        $ftr = $('.ftr'),\n        storesInfo = fetchTopPriceTableData();\n\n    if(!storesInfo) {\n        return;\n    } else {\n        $mainCol1.prepend(createSidebarPriceTable(storesInfo));\n        $sidebar.css('left', (mainLeft + mainCol3Width) + 'px');\n        Modules.$win.scroll(Modules.throttle(sidebarScrollEvent, 100));\n    }\n\n    // ********************\n\n    function sidebarScrollEvent() {\n        var $win = $(this),\n            winTop = $win.scrollTop(),\n            winHeight = $win.height(),\n            padding = 100;\n        if(winTop - padding > mainTop) {\n            if(!(winTop + winHeight > $ftr.offset().top)) {\n                showSidebar();\n            } else {\n                hideSidebar();\n            }\n        } else {\n            hideSidebar();\n        }\n    }\n    function showSidebar() {\n        $sidebar.addClass('main-wrpr__cols1--fixed');\n        if(!$sidebar.is(\":visible\")) {\n            $sidebar.show();\n        }\n    }\n    function hideSidebar() {\n        $sidebar.removeClass('main-wrpr__cols1--fixed');\n        if($sidebar.is(\":visible\")) {\n            $sidebar.hide();   \n        }\n    }\n})(); // end sidebar pdp IIFE","function jsAppend(js_file) {\n    var js_script = document.createElement(\"script\");\n    js_script.type = \"text/javascript\";\n    js_script.src = \"https://www.mysmartprice.com/mobile/js/\" + js_file;\n    document.getElementsByTagName(\"head\")[0].appendChild(js_script);\n}\n\n// Alternate text for image\nfunction handleImageError(img) {\n    var $img = $(img);\n    if ($img.attr(\"alt\"))\n        $img.replaceWith(\"<div class='str-name'>\" + $img.attr(\"alt\") + \"</div>\");\n}\n\nfunction hideImage(img) {\n    $(img).hide();\n}\n\n//Collapse lengthy offers on top section for NC only\n(function() {\n    if ($(\".prdct-dtl__ttl\").data(\"page-type\") == \"nc\") {\n        if ($(\".prdct-dtl__str-offr li\").length > 2) {\n            $(\".prdct-dtl__str-offr li:nth-child(2)\").append(\"<span class='prdct-dtl__shw-ofr js-show-offer'>Show More</span>\")\n        };\n\n        Modules.$doc.on(\"click\", \".js-show-offer\", function() {\n            var linkText = $(this).text().trim(),\n                newText, index;\n            $(\".prdct-dtl__offr-sctn\").toggleClass(\"prdct-dtl__offr-sctn--expnd\");\n            if (linkText.toLowerCase() == \"show more\") {\n                newText = \"Show Less\";\n                index = $(\".prdct-dtl__str-offr li\").length;\n            } else {\n                newText = \"Show More\";\n                index = 2;\n            }\n            $(this).remove();\n            $(\".prdct-dtl__str-offr li:nth-child(\" + index + \")\").append(\"<span class='prdct-dtl__shw-ofr js-show-offer'>\" + newText + \"</span>\")\n        });\n    }\n})();\n\n\nModules.$doc.on(\"click\", \".prc-grid__no-stck-sbmt\", function() {\n    var $inputField = $(this).prev(\".prc-grid__no-stck-inpt\"),\n        $form = $(this).closest(\".prc-grid__no-stck-form\"),\n        $errorNode = $form.find(\".js-vldtn-err\"),\n        capturePoint = $(this).data(\"capture-point\");\n    MSP.utils.validate.form([{\n        \"type\": \"email\",\n        \"inputField\": $inputField,\n        \"errorNode\": $errorNode\n    }]).done(function() {\n        $.ajax({\n            \"url\": \"/price_alert/capture_email.php\",\n            \"data\": {\n                \"email\": $inputField.val(),\n                \"mspid\": PriceTable.dataPoints.mspid,\n                \"capture_point\": capturePoint,\n                \"popupname\": \"pricealert\"\n            }\n        });\n        $form.hide();\n        $form.siblings(\".prc-grid__no-stck-scs\").fadeIn();\n        $form.siblings(\".prc-grid__no-stck-sub\").hide();\n    });\n    return false;\n});\n\n// show more techspecs.\nif ($(\".prdct-dtl__spfctn-more-wrpr\").length) {\n    Modules.$doc.on(\"click\", \".js-prdct-dtl__spfctn-show-more, .js-prdct-dtl__spfctn-show-less\", function() {\n        var delay = $(this).hasClass(\"js-prdct-dtl__spfctn-show-less\") ? 400 : 0;\n        setTimeout(function() {\n            $(\".js-prdct-dtl__spfctn-show-more\").toggle();\n        }, delay);\n        $(\".prdct-dtl__spfctn-more-wrpr\").toggleClass(\"prdct-dtl__spfctn-more-wrpr--show\");\n    });\n}\n\nModules.$doc.on(\"click\", \".js-xpnd-prc-box-item\", function() {\n    var $this = $(this),\n        $thisItem = $this.closest(\".prdct-dtl__box-item\");\n    if (!$thisItem.hasClass(\"prdct-dtl__box-item--open\")) {\n        var $openItem = $(\".prdct-dtl__box-item--open\");\n        if ($openItem.length) {\n            $openItem.removeClass(\"prdct-dtl__box-item--open\").find(\".prdct-dtl__box-btm\").slideUp(\"fast\");\n        }\n        $this.siblings(\".prdct-dtl__box-btm\").slideDown(\"fast\");\n        $thisItem.addClass(\"prdct-dtl__box-item--open\");\n        if (window.ga && $thisItem.hasClass(\"prdct-dtl__box-item--ofln\")) {\n            ga(\"send\", \"event\", \"Offline\", \"CPL Clicks Tech 1\", PriceTable.dataPoints.mspid + \"\");\n        }\n    }\n});\n\n// Multiple Image Show on Top Section - Start\n$(\".prdct-dtl__thmbnl\").on(\"mouseenter\", function(e) {\n    var $thumbnailImage = $(this).find(\".prdct-dtl__thmbnl-img\"),\n        newSrc = $thumbnailImage.attr(\"src\"),\n        thumbId = $thumbnailImage.data(\"thumb-id\");\n\n    //Destination Image\n    $(\".prdct-dtl__img\").attr(\"src\", newSrc).data(\"thumb-id\", thumbId).data(\"media_position\",thumbId);\n    //$(\".prdct-dtl__img\").attr(\"src\", newSrc).data(\"thumb-id\", thumbId);\n    $(\".prdct-dtl__img-wrpr\").data(\"href\", $(this).data(\"href\"));\n\n    $(\".prdct-dtl__thmbnl\").removeClass(\"prdct-dtl__thmbnl--slctd\");\n    $(this).addClass(\"prdct-dtl__thmbnl--slctd\");\n});\n$(\".prdct-dtl__thmbnl-wrpr\").on(\"mouseleave\", function(e) {\n    var newSrc = $(\".prdct-dtl__img\").data(\"image\");\n    $(\".prdct-dtl__img\").attr(\"src\", newSrc);\n});\n$(\".prdct-dtl__img-wrpr, .prdct-dtl__thmbnl\").on(\"click\", function(e) {\n    \n    //Params to work with NC\n    var videoUrl = $(this).parent().data(\"video-id\") ? $(this).parent().data(\"video-id\").trim() : \"\";\n    var maxThumbs = videoUrl ? ($(\".prdct-dtl__thmbnl-wrpr .prdct-dtl__thmbnl\").length - 1) : ($(\".prdct-dtl__thmbnl-wrpr .prdct-dtl__thmbnl\").length);\n    //Params for Comp redesigned popup\n    var offset_media_key = $(this).find(\"img\").data(\"media_key\");\n    var offset_media_position = $(this).find(\"img\").data(\"media_position\");\n    var query = [\n        'mspid=' + $(\".prdct-dtl__ttl\").data(\"mspid\"),\n        'offset_media_key='+offset_media_key,\n        'offset_position=' + offset_media_position,\n        /*Params to work with old popup in NC*/\n        'primaryThumb=' + $(\".prdct-dtl__img\").data(\"image\"),\n        'maxThumbs=' + maxThumbs,\n        'thumbId=' + $(\".prdct-dtl__img\").data(\"thumb-id\"),\n        'videoUrl=' + videoUrl\n    ].join(\"&\");\n    var images_popup = $(\".prdct-dtl__thmbnl\").data(\"href\");\n    openPopup(\"/mobile/\"+images_popup+\"?\" + query);\n});\n// Multiple Image Show on Top Section - End\n\n// save to list button handlers - start \nModules.$doc.on('click', \".prdct-dtl__save\", function(e) {\n    loginCallback(function() {\n        $(\".prdct-dtl__save\").addClass(\"prdct-dtl__save--svd\");\n        $.get(\"/users/add_to_list.php\", {\n            mspid: PriceTable.dataPoints.mspid\n        }, function(data) {});\n    });\n    return false;\n});\n\nModules.$doc.on(\"click\", \".js-user-lgt\", function(e) {\n    $(\".prdct-dtl__save\").removeClass(\"prdct-dtl__save--svd\");\n});\n// save to list button handlers - end\n\n// Extension install cashback offer for products (incl. mobile category)\nif(Modules.isInstalled()) {\n    if (!$(\".prdct-dtl__offr-sctn li\").length) {\n        $(\".prdct-dtl__offr-sctn\").hide();\n    }\n\n    // if the extension is not installed\n    // and it is an upcoming mobile page\n    // show install extension link\n    // hide notify me widget\n    if($(\".prc-grid__upcmng-mbl\").length) {\n        $(\".prc-grid__upcmng-mbl\").removeClass(\"hide\");\n        $(\".prc-grid__instl-extnsn\").addClass(\"hide\");\n    }\n    } else {\n        if ($(\".prdct-dtl__ttl\").data(\"page-type\") == \"nc\") {\n            if(dataLayer[0]['min-price-store'] !== 'amazon') {\n                $(\".prdct-dtl__coin-wrpr\").after([\n                    \"<div>\",\n                    $(\".prdct-dtl__coin-wrpr\").length ? \"Extra <strong>upto 25% cashback</strong>\" : \"<strong>Upto 25% cashback</strong>\",\n                    \" on adding our Chrome extension\",\n                    \" <span class='help-icon js-tltp' data-tooltip='Maximum cashback of &#8377;100'>i</span>\",\n                    \" <span class='text-link js-add-chrome'><strong>Know more</strong></span>\",\n                    \"</div>\"\n                ].join(\"\"));\n                ga(\"send\", \"event\", \"NC\", \"nc_single_pv\", \"js-log-nc\", { nonInteraction: true });\n            }\n        } else {\n            if(dataLayer[0]['min-price-store'] === 'amazon') {\n                if($('.prdct-dtl__offr-sctn li').length === 0) {\n                    $('.prdct-dtl__offr-sctn').remove();\n                }\n            } else {\n                $(\".prdct-dtl__offr-sctn\").append([\n                    \"<ul><li>\",\n                    $(\".prdct-dtl__coin-wrpr\").length ? \"Extra <strong>upto 25% cashback</strong>\" : \"<strong>Upto 25% cashback</strong>\",\n                    \" on adding our Chrome extension\",\n                    \" <span class='help-icon js-tltp' data-tooltip='Maximum cashback of &#8377;100'>i</span>\",\n                    \" <span class='text-link js-add-chrome'><strong>Know more</strong></span>\",\n                    \"</li></ul>\"\n                ].join(\"\"));\n                window.ga && ga(\"send\", \"event\", \"Comparables\", \"comparables_single_pv\", \"js-log-comparables\", { nonInteraction: true });\n            }\n        }\n    }\n\n// Windows App popup event handlers:     \n$(document).on('click', '.js-windows-app', function(e) {\n    e.preventDefault();\n    initWindowsAppDownload($(this).data('url'));\n    $('.prdct-dtl__box-GTS:not(.js-inpg-link), .bttn--gts').addClass('js-prc-tbl__gts-btn').removeClass('js-windows-app');\n    return false;\n});","/* RUI:: save product item button - start */\nModules.$doc.on('mousedown', '.js-save-btn', function() {\n    var $this = $(this),\n        mspid = $this.closest(\".prdct-item\").data(\"mspid\") || $(\".prdct-dtl__ttl\").data(\"mspid\");\n\n    if (!mspid) {\n        return false;\n    }\n\n    if (!$this.hasClass(\"prdct-item__save-btn--svd\")) {\n        loginCallback(saveProduct, this, [mspid, $this]);\n    }\n\n    return false;\n});\n/* RUI:: save product item button - start */","if($('.list-main').length) {\n    var ListPage = {\n        \"settings\": {\n            \"filterLength\": 8\n        },\n        \"controller\": {\n            \"init\": function() {\n                var lp_changes = ListPage.model.params.changes,\n                    lp_defaults = ListPage.model.params.defaults,\n                    lp_current = ListPage.model.params.current,\n                    lp_page = ListPage.model.params.page,\n                    lp_clipboard = ListPage.model.clipboard;\n\n                // get page params and default values to get default filters to be applied.\n                ListPage.controller.getDefaults();\n\n                ListPage.controller.updatePage();\n\n\n                $(document).on('click', '.js-load-more', function() {\n                    lp_clipboard.scroll.isTrigger = true;\n                    lp_clipboard.scroll.isLoading = true;\n                    lp_clipboard.scroll.counter++;\n                    ListPage.controller.updatePage();\n                });\n\n                \n\n                // Add listeners to all inputs for applying or removing filters\n                ;(function addActionListeners() {\n                    var filterGroupQueue = [],\n                        listenerTypes = [\n                            \".fltr:not([data-groupname='price']) .js-fltr-val--mltpl input:not([disabled])\",\n                            \".fltr:not([data-groupname='price']) .js-fltr-val--sngl input:not([disabled])\",\n                            \".fltr[data-groupname='price'] .js-fltr-val--sngl input:not([disabled])\"\n                        ];\n\n\n                    // globalSearch is comes from from hash so no listener.\n\n                    // localSearch within the loaded product list\n                    $('.list-hdr-srch').on('submit', function() {\n                        var localSearch = $.trim($(this).find('.list-hdr-srch__fld').val());\n                        if (localSearch !== \"\") {\n                            lp_changes.add.ss = localSearch;\n                        } else if (lp_clipboard.prevLocalSearch) {\n                            lp_changes.remove.ss = lp_clipboard.prevLocalSearch;\n                        } else {\n                            return false;\n                        }\n\n                        lp_changes.inFilterBox = false;\n                        ListPage.controller.updatePage();\n                        return false;\n                    });\n\n                    $('.list-hdr-srch__btn').on(\"click\", function() {\n                        $('.list-hdr-srch').submit();\n                    });\n\n                    // onclick a non-price multi value filter.\n                    Modules.$doc.on(\"click\", \".fltr:not([data-groupname='price']) .js-fltr-val--mltpl input:not([disabled])\", function() {\n                        var groupName = $(this).closest(\".fltr\").data(\"groupname\");\n\n                        if (filterGroupQueue.length === 0) {\n                            $.merge(filterGroupQueue, $(this));\n                        }\n                        $(filterGroupQueue).each(function(i, item) {\n                            var context = (!lp_current.property || lp_current.property.indexOf($(item).attr(\"value\")) === -1) ? \"add\" : \"remove\",\n                                changes = lp_changes[context];\n\n                            changes.property = changes.property || [];\n                            changes.property.push($(item).attr(\"value\"));\n                        });\n                        filterGroupQueue = [];\n\n                        lp_changes.inFilterBox = true;\n                        ListPage.controller.updatePage();\n                        ListPage.controller.redirectPage();\n                    });\n\n                    // onclick a non-price single value filter.\n                    Modules.$doc.on(\"click\", \".fltr:not([data-groupname='price']) .js-fltr-val--sngl input:not([disabled])\", function() {\n                        var groupName = $(this).closest(\".fltr\").data(\"groupname\");\n                        if (filterGroupQueue.length === 0) {\n                            $.merge(filterGroupQueue, $(this).closest(\".fltr\").find(\".fltr-val__inpt:checked\"));\n                        }\n                        $(filterGroupQueue).each(function(i, item) {\n                            var context = lp_current[groupName] !== $(item).attr(\"value\") ? \"add\" : \"remove\",\n                                changes = lp_changes[context];\n                            //var groupName = \"\";\n                            changes[groupName] = $(item).attr(\"value\");\n                        });\n                        filterGroupQueue = [];\n\n                        lp_changes.inFilterBox = true;\n                        ListPage.controller.updatePage();\n                        ListPage.controller.redirectPage();\n                    });\n\n                    // onclick a price single value filter.\n                    Modules.$doc.on(\"click\", \".fltr[data-groupname='price'] .js-fltr-val--sngl input:not([disabled])\", function() {\n                        var filterVal = $(this).attr(\"value\"),\n                            values = filterVal.split(\";\"),\n                            minPrice = parseInt(values[0], 10),\n                            maxPrice = parseInt(values[1], 10),\n                            context = (lp_current.price !== $(this).attr(\"value\")) ? \"add\" : \"remove\",\n                            displayPrices = {};\n\n                        $.extend(lp_changes[context], {\n                            \"price\": minPrice + \";\" + maxPrice\n                        });\n\n                        lp_changes.inFilterBox = true;\n                        ListPage.controller.updatePage();\n                        ListPage.controller.redirectPage();\n                    });\n\n                    // clear all apllied filters in a filtergroup\n                    Modules.$doc.on(\"click\", \".fltr__cler\", function() {\n                        var $currentGroup = $(this).closest(\".fltr\"),\n                            groupname = $currentGroup.data(\"groupname\"),\n                            $activeFilters = $currentGroup.find(\".fltr-val__inpt:checked\");\n                        if (groupname === \"price\") {\n                            $.extend(lp_changes.remove, {\n                                \"price\": lp_clipboard.prevMinPrice + \";\" + lp_clipboard.prevMaxPrice\n                            });\n\n                            lp_changes.inFilterBox = true;\n                            ListPage.controller.updatePage();\n                        } else {\n                            $.merge(filterGroupQueue, $currentGroup.find(\"input:checked\"));\n                            $activeFilters.eq(0).click();\n                        }\n\n                        //Hide SEO Text\n                        $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").hide();\n\n                    });\n\n                    //Add event to window scroll (To load more pages)\n                    if (lp_clipboard.pageType === \"nc\") {\n                        $(window).on(\"scroll\", function(e) {\n                            var $docheight = $(document).height();\n                            var productCount = parseInt($(\".js-prdct-cnt__rng\").html().split(\"-\")[1]);\n                            var totalProducts = parseInt($(\".js-prdct-cnt__totl\").html());\n\n                            if ($docheight - $(e.target).scrollTop() < 1800) {\n                                if (lp_clipboard.scroll.isEnabled && !lp_clipboard.scroll.isLoading && lp_clipboard.scroll.counter < 3 && productCount<totalProducts) {\n                                    if (lp_clipboard.scroll.isAutoLoad) {\n                                        lp_clipboard.scroll.counter++;\n                                        lp_clipboard.scroll.isTrigger = true;\n                                        lp_clipboard.scroll.isLoading = true;\n                                        lp_clipboard.isOnLoad = false;\n                                        ListPage.controller.updatePage();\n                                    }\n                                }\n                            }\n                        });\n                    }\n\n                    // edit min and max price numbers in inputfiled\n                    Modules.$doc.on(\"change\", \".js-fltr-prc__inpt-min, .js-fltr-prc__inpt-max\", function() {\n                        $(\".fltr-val__inpt[name=price]\").prop('checked', false);\n                        var numRegEx = /^[0-9]+$/,\n                            $minPriceInpt = $(\".js-fltr-prc__inpt-min\"),\n                            $maxPriceInpt = $(\".js-fltr-prc__inpt-max\"),\n                            minPrice = $minPriceInpt.val(),\n                            maxPrice = $maxPriceInpt.val(),\n                            lp_clipboard = ListPage.model.clipboard;\n\n                        if (numRegEx.test(minPrice) && numRegEx.test(maxPrice)) {\n                            minPrice = parseInt(minPrice, 10);\n                            maxPrice = parseInt(maxPrice, 10);\n                            if (minPrice < maxPrice) {\n                                if (minPrice < lp_defaults.priceMin) {\n                                    minPrice = lp_defaults.priceMin;\n                                    $minPriceInpt.val(minPrice);\n                                }\n                                if (maxPrice > lp_defaults.priceMax) {\n                                    maxPrice = lp_defaults.priceMax;\n                                    $maxPriceInpt.val(maxPrice);\n                                }\n                                if (minPrice !== lp_defaults.priceMin || maxPrice !== lp_defaults.priceMax) {\n                                    // if new price range is subset of total range then apply filter\n                                    $.extend(lp_changes.add, {\n                                        \"price\": minPrice + \";\" + maxPrice\n                                    });\n                                } else {\n                                    // if new price range is total range then remove existing price filter.\n                                    $.extend(lp_changes.remove, {\n                                        \"price\": lp_clipboard.prevMinPrice + \";\" + lp_clipboard.prevMaxPrice\n                                    });\n                                }\n\n                                lp_changes.inFilterBox = true;\n                                ListPage.controller.updatePage();\n                                return;\n                            }\n                        }\n                        $minPriceInpt.val(lp_clipboard.prevMinPrice);\n                        $maxPriceInpt.val(lp_clipboard.prevMaxPrice);\n                    });\n\n                    ;(function AppliedFilterHandler() {\n                        var remfilterQueue = [];\n\n                        function removeAppliedFilters() {\n                            var filterVal, $filterItem, minPrice, maxPrice;\n\n                            // batch changes(DOM write operatations ie. to uncheck filters/remove tags) to trigger only one render operation.\n                            $.each(remfilterQueue, function(i, filter) {\n                                if ($(filter).closest(\".js-fltrs-apld\").data(\"groupname\") === \"searchTerm\") {\n                                    lp_changes.remove.s = $(filter).data(\"value\");\n                                } else if ($(filter).closest(\".js-fltrs-apld\").data(\"groupname\") === \"localSearch\") {\n                                    lp_changes.remove.ss = $(filter).data(\"value\");\n                                } else if ($(filter).closest(\".js-fltrs-apld\").data(\"groupname\") === \"price\") {\n                                    lp_changes.remove.price = $(filter).data(\"value\");\n                                } else if ($(filter).closest(\".js-fltrs-apld\").data(\"groupname\") === \"discount\") {\n                                    lp_changes.remove.discount = $(filter).data(\"value\");\n                                } else {\n                                    filterVal = $(filter).data(\"value\");\n                                    $filterItem = $('.fltr-val__inpt[value=\"' + filterVal + '\"]').closest(\".fltr-val\");\n\n                                    lp_changes.remove.property = lp_changes.remove.property || [];\n                                    lp_changes.remove.property.push($filterItem.find(\"input\").attr(\"value\")?$filterItem.find(\"input\").attr(\"value\"):filterVal);\n                                }\n                            });\n                            remfilterQueue = [];\n\n                            lp_changes.inFilterBox = false;\n                            ListPage.controller.updatePage();\n                        }\n\n                        // remove applied filter by clicking tags shown above product list.\n                        $(\".js-fltrs-apld-wrpr1\").on(\"click\", \".js-fltrs-apld__item\", function removeTag() {\n                            $.merge(remfilterQueue, $(this));\n                            removeAppliedFilters();\n                        });\n\n                        // remove applied filter by clicking tags shown above product list.\n                        $(\".js-fltrs-apld-wrpr1\").on(\"click\", \".js-fltrs-apld__lbl\", function removeGroup() {\n                            $.merge(remfilterQueue, $(this).closest(\".js-fltrs-apld\").find(\".js-fltrs-apld__item\"));\n                            removeAppliedFilters();\n                        });\n\n                        $(\".js-fltrs-apld-wrpr1\").on(\"mouseover\", \".js-fltrs-apld__lbl\", function() {\n                            $(this).closest(\".js-fltrs-apld\").addClass(\"js-fltrs-apld--strk\");\n                        }).on(\"mouseout\", \".js-fltrs-apld__lbl\", function() {\n                            $(this).closest(\".js-fltrs-apld\").removeClass(\"js-fltrs-apld--strk\");\n                        });\n\n                        $(\".js-fltrs-apld-wrpr1\").on(\"click\", \".js-fltrs-apld-cler\", function removeAll() {\n                            $(\".js-fltrs-apld__item\").each(function() {\n                                $.merge(remfilterQueue, $(this));\n                            });\n                            removeAppliedFilters();\n                        });\n                    }());\n\n                    // sorting options.\n                    Modules.$doc.on(\"change\", \".js-list-sort\", function() {\n                        var sortVal = $(this).val();\n                        lp_changes.add.sort = sortVal;\n\n                        lp_changes.inFilterBox = false;\n                        ListPage.controller.updatePage();\n                    });\n\n                    // pagination.\n                    Modules.$doc.on(\"click\", \".js-pgntn__item\", function() {\n                        if (!$(this).hasClass(\"pgntn__item--crnt\")) {\n                            var pgno = $(this).data(\"pgno\");\n                            lp_changes.add.page = pgno;\n\n                            lp_changes.inFilterBox = false;\n                            ListPage.controller.updatePage();\n                        }\n                        return false;\n                    });\n                }());\n            },\n            \"getDefaults\": function() {\n                var lp_defaults = ListPage.model.params.defaults,\n                    lp_clipboard = ListPage.model.clipboard,\n                    pageParams = (function() {\n                        var $bodyWrapper = $(\".body-wrpr\"),\n                            params = {},\n                            startInr, endInr;\n\n                        if ($bodyWrapper.data(\"refurb\")) {\n                            params.refurb = $bodyWrapper.data(\"refurb\");\n                        }\n                        if ($bodyWrapper.data(\"category\") && $bodyWrapper.data(\"page-type\") != \"nc\") {\n                            params.subcategory = $bodyWrapper.data(\"category\");\n                        }\n                        if ($bodyWrapper.data(\"start_price\") || $bodyWrapper.data(\"end_price\")) {\n                            startInr = parseInt($bodyWrapper.data(\"start_price\") || $(\".js-fltr-prc__inpt-min\").attr(\"val\"), 10);\n                            endInr = parseInt($bodyWrapper.data(\"end_price\") || $(\".js-fltr-prc__inpt-max\").attr(\"val\"), 10);\n                            params.price = startInr + \";\" + endInr;\n                        }\n                        if ($bodyWrapper.data(\"brand\")) {\n                            params.property = params.property || \"\";\n                            params.property += $(\".fltr-val__inpt[dispname='\" + $bodyWrapper.data(\"brand\") + \"']\").attr(\"value\") + \"|\";\n                        }\n                        if ($bodyWrapper.data(\"property\")) {\n                            params.property = params.property || \"\";\n                            params.property += $bodyWrapper.data(\"property\") + \"|\";\n                        }\n                        if ($bodyWrapper.data(\"properties\")) {\n                            params.property = params.property || \"\";\n                            params.property += $bodyWrapper.data(\"properties\");\n                        }\n                        if ($bodyWrapper.data(\"discount\")) {\n                            params.discount = $bodyWrapper.data(\"discount\");\n                        }\n                        if (params.property) {\n                            params.property = $.grep(params.property.split(\"|\").sort(), function(e, i) {\n                                return (e !== \"\");\n                            });\n                        }\n\n                        return params;\n                    }());\n\n                $.extend(ListPage.model.params.page, pageParams);\n\n                // get supported values of min and max price values by the slider.\n                $.extend(lp_defaults, {\n                    \"priceMin\": parseInt($(\".fltr-prc__sldr\").attr(\"value\").split(\";\")[0], 10),\n                    \"priceMax\": parseInt($(\".fltr-prc__sldr\").attr(\"value\").split(\";\")[1], 10)\n                });\n\n                // store inital values as previous values when values change.\n                $.extend(lp_clipboard, {\n                    \"prevMinPrice\": lp_defaults.priceMin,\n                    \"prevMaxPrice\": lp_defaults.priceMax,\n                    \"pageType\": $(\".body-wrpr\").data(\"page-type\"),\n                    \"pageName\": $(\".body-wrpr\").data('page-name')\n                });\n            },\n            \"redirectPage\": function(){\n                \n                if(ListPage.model.clipboard.pageType ===\"nc-filter\"){\n                    window.location.href = \"//mysmartprice.com\"+\"/\"+dataLayer[0].category+\"/\"+dataLayer[0].subcategory+ListPage.model.URLParams+\"&ref=config_page\";\n                }\n            },\n            // once changes are update the page state before rendering the view.\n            \"updatePage\": function() {\n                var lp_current = ListPage.model.params.current,\n                    lp_changes = ListPage.model.params.changes,\n                    lp_defaults = ListPage.model.params.defaults,\n                    lp_page = ListPage.model.params.page,\n                    lp_clipboard = ListPage.model.clipboard,\n                    lp_services = ListPage.services,\n                    initHash, prop_strings;\n\n                lp_clipboard.isOnLoad = $.isEmptyObject(lp_current);\n                \n                // Clear list page deals countdown timer\n                clearInterval(timerInterval);\n\n                if (!lp_clipboard.isOnLoad) {\n                    if (lp_clipboard.pageType === \"nc\" && !lp_current.subcategory) {\n                        lp_changes.add.subcategory = $(\".body-wrpr\").data(\"category\");\n                    }\n                    //apply additions in current state params\n                    $.each(lp_changes.add, function(key) {\n                        if (key === \"property\") {\n                            if ($.isArray(lp_changes.add.property)) {\n                                lp_current.property = $.isArray(lp_current.property) ? lp_current.property : [];\n                                $.merge(lp_current.property, lp_changes.add.property);\n                            }\n                        } else {\n                            lp_current[key] = lp_changes.add[key];\n                        }\n                    });\n                    //apply deletions in current state params\n                    $.each(lp_changes.remove, function(key) {\n                        var index;\n                        if (key === \"property\") {\n                            $.each(lp_changes.remove.property, function(i, removedProperty) {\n                                index = lp_current.property.indexOf(removedProperty);\n                                lp_current.property.splice(index, 1);\n                            });\n                            if (lp_current.property.length === 0) {\n                                delete lp_current.property;\n                            }\n                        } else {\n                            delete lp_current[key];\n                        }\n                    });\n                } else {\n                    // if isOnLoad get current params from url hash.\n\n                    var urlQuery = \"\";\n\n                    if (lp_clipboard.pageType === \"nc\") {\n                        urlQuery = window.location.href.split(\"?\")[1];\n                    } else {\n                        urlQuery = window.location.hash.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n                    }\n\n                    $.extend(lp_current, lp_services.filterURL.toParams(urlQuery));\n\n                    ;(function() {\n                        var currentLength = 0;\n                        $.each(lp_current, function() {\n                            currentLength++;\n                        });\n\n                        // if no hash or if its a quicklink page inherit page params.\n                        if (currentLength === 0 || lp_current.ql === \"1\") {\n                            $.each(lp_page, function(param, pageParamValue) {\n                                if ($.isArray(pageParamValue)) {\n\n                                    lp_current[param] = $.isArray(lp_current[param]) ? lp_current[param] : [];\n\n                                    $.each(pageParamValue, function(i, prop) {\n                                        if (lp_current[param].indexOf(prop) === -1) {\n                                            lp_current[param].push(prop);\n                                        }\n                                    });\n                                } else {\n                                    lp_current[param] = pageParamValue;\n                                }\n                            });\n                            delete lp_current.ql;\n                        }\n\n                        // since every registered params on current is new add them to changes also.\n                        $.each(lp_current, function(key) {\n                            lp_changes.add[key] = lp_current[key];\n                        });\n                    }());\n\n                    lp_current.subcategory = lp_current.subcategory || lp_page.subcategory;\n                    lp_clipboard.isLoadParamsEqualtoPageParams = (ListPage.services.filterURL.fromParams(lp_current) === ListPage.services.filterURL.fromParams(lp_page));\n\n                    // nc filter not working if there isn't any query with url\n                    if(lp_clipboard.pageType === \"nc\" && ListPage.services.filterURL.fromParams(lp_current) === \"\")\n                        lp_clipboard.isLoadParamsEqualtoPageParams = false;\n\n                    ListPage.view.init();\n                }\n\n                //generate new hash, and start view rendering.\n                ListPage.model.URLParams = ListPage.services.filterURL.fromParams(lp_current);\n                if(lp_clipboard.pageType!==\"nc-filter\"){\n                    ListPage.view.render();\n                }\n            }\n        },\n        \"model\": {\n            \"URLParams\": \"\",\n            \"params\": {\n                \"current\": {},\n                /* {\n                    \"s\" : \"\", //globalSearch\n                    \"ss\" : \"\", //localSearch\n                    \"subcategory\" : \"\",\n                    \"price\" : startInr + \";\" + endInr,\n                    \"property\" : [],\n                    \"sort\" : \"\",\n                    \"page\" : \"\" //pagination no\n                } */\n                \"changes\": {\n                    \"add\": {},\n                    \"remove\": {},\n                },\n                \"page\": {},\n                \"defaults\": {}\n            },\n            // mode of tranferring valued from one component(M, V, C) to another.\n            \"clipboard\": {\n                \"prevMinPrice\": \"\",\n                \"prevMaxPrice\": \"\",\n                \"slider\": {},\n                \"prevLocalSearch\": \"\",\n                \"pageType\": \"\",\n                \"pageName\" : \"\",\n                \"scroll\": {\n                    \"isAutoLoad\": true,\n                    \"isEnabled\": true,\n                    \"counter\": 0,\n                    \"isLoading\": false,\n                    \"isTrigger\": false\n                }\n            }\n        },\n        \"services\": {\n            \"filterURL\": {\n                \"toParams\": function(filterURL) {\n\n                    var separator = ListPage.model.pageType == \"nc\" ? \"?\" : \"#\";\n\n                    var params = {},\n                        prop_strings = decodeURIComponent(filterURL).replace(separator, \"\").split(\"&\");\n\n                    if (prop_strings[0] !== \"\") {\n                        $.each(prop_strings, function(i, prop_string) {\n                            params[prop_string.split(\"=\")[0]] = prop_string.split(\"=\")[1];\n                        });\n\n                        if (\"property\" in params) {\n                            params.property = $.grep(params.property.split(\"|\").sort(), function(e, i) {\n                                return (e !== \"\");\n                            });\n                        }\n\n                        if (params.startinr !== params.priceMin || params.endinr !== params.priceMax) {\n                            params.price = parseInt(params.startinr, 10) + \";\" + parseInt(params.endinr, 10);\n                        }\n\n                        delete params.startinr;\n                        delete params.endinr;\n                    }\n\n                    return params;\n                },\n                \"fromParams\": function(params) {\n                    var pageType = $(\".body-wrpr\").data(\"page-type\"),\n                        separator = (pageType == \"nc\" || pageType == \"nc-filter\") ? \"?\" : \"#\",\n                        URLParams = [],\n                        filterURL;\n\n                    $.each(params, function(key) {\n                        var value;\n                        if (params[key]) {\n                            if (pageType == \"nc\" && key === \"subcategory\") {\n                                URLParams.unshift(key + \"=\" + params[key]); // 'subcategory' should always be the first param in NC\n                            }\n                            else if (key === \"price\") {\n                                URLParams.push(\"startinr=\" + params[key].split(\";\")[0]);\n                                URLParams.push(\"endinr=\" + params[key].split(\";\")[1]);\n                            }\n                            else if (key === \"property\") {\n                                URLParams.push(key + \"=\" + params[key].join(\"|\"));\n                            }\n                            else {\n                                URLParams.push(key + \"=\" + params[key]);\n                            }\n                        }\n                    });\n\n                    filterURL = URLParams.length > 0 ? separator + URLParams.join(\"&\") : \"\";\n\n                    return filterURL;\n                }\n            },\n            \"fetch\": {\n                // generate query from all the new page state params\n                \"apiQuery\": function(params) {\n                    var subCategory = ListPage.model.clipboard.pageType === \"nc\"? (subCategory = $(\".body-wrpr\").data(\"category\")):params.subcategory;\n\n                    return [\n                        \"subcategory=\" + subCategory,\n                        params.category ? (\"&category=\" + params.category) : \"\",\n                        params.refurb ? (\"&refurb=\" +params.refurb) : \"\",\n                        params.s ? (\"&s=\" + params.s) : \"\",\n                        params.property ? (\"&property=\" + params.property.join(\"|\")) : \"\",\n                        params.price ? (\"&startinr=\" + params.price.split(\";\")[0]) : \"\",\n                        params.price ? (\"&endinr=\" + params.price.split(\";\")[1]) : \"\",\n                        params.sort ? (\"&sort=\" + params.sort) : \"\",\n                        params.ss ? (\"&ss=\" + params.ss) : \"\",\n                        params.page ? (\"&page=\" + params.page) : \"\",\n                        params.start ? (\"&start=\" + params.start) : \"\",\n                        params.rows ? (\"&rows=\" + params.rows) : \"\",\n                        params.discount ? (\"&discount=\" + params.discount) : \"\",\n                        params.pageName ? (\"&pageName=\" + params.pageName) : \"\",\n                        params.source ? (\"&source=\" + url.getAQueryParam('source')) : \"\"\n                    ].join(\"\");\n                },\n                \"productList\": Modules.memoize(function(currentParams) {\n                    var dfd = $.Deferred(),\n                        query = this.apiQuery(currentParams),\n                        _productList = ListPage.services.fetch.productList;\n\n                    if (_productList.XHR) _productList.XHR.abort();\n\n\n                    var service_url = \"\";\n\n                    if (ListPage.model.clipboard.pageType === \"nc\") {\n                        service_url = \"/fashion/filters/filter_get_redesign?\" + query;\n                if(window.location.href.indexOf(\"bestsellers\") > -1){\n                 service_url = \"/fashion/bestsellers_filters/filter_get_redesign?\" + query; \n                }\n                    } else {\n                        service_url = ($('.list-main').length ? '/msp/processes/property/api/msp_get_html_for_property_new.php?' : '/msp/search/msp_search_new.php?') + query;\n                        log_data('property_info',{'subcategory':currentParams.subcategory,'property':query}, service_url);\n                    }\n\n                    //For Refurbished products\n                    if(currentParams.refurb==1) {\n                        service_url = ($('.list-main').length ? '/msp/processes/property/api/msp_get_html_for_property_refurb.php?' : '/msp/search/msp_search_new.php?') + query;\n                    }\n                    _productList.XHR = $.ajax({\n                        url: service_url,\n                    }).done(function(response) {\n                        dfd.resolve(response);\n                    }).fail(function(error) {\n                        dfd.reject(error);\n                    });\n\n                    return dfd.promise();\n                }, {\n                    \"cacheLimit\": 15\n                }),\n                // hourly deals ajax loading\n                \"hourlyDeals\": Modules.memoize(function(currentParams) {\n                    var dfd = $.Deferred(),\n                        query = this.apiQuery(currentParams),\n                        _hourlyDeals = ListPage.services.fetch.hourlyDeals;\n\n                    if (_hourlyDeals.XHR) _hourlyDeals.XHR.abort();\n\n                    _hourlyDeals.XHR = $.ajax({\n                        \"url\": \"/msp/autodeals/hourly_deals.php?\" + query\n                    }).done(function(response) {\n                        dfd.resolve(response);\n                    }).fail(function(error) {\n                        dfd.reject(error);\n                    });\n\n                    return dfd.promise();\n                }, {\n                    \"cacheLimit\": 15\n                })\n            }\n        },\n        \"view\": {\n            \"init\": function() {\n                var lp_current = ListPage.model.params.current,\n                    lp_defaults = ListPage.model.params.defaults;\n\n                ListPage.view.filterPlugins.init({\n                    \"priceSlider\": {\n                        \"min\": lp_current.price ? lp_current.price.split(\";\")[0] : lp_defaults.priceMin,\n                        \"max\": lp_current.price ? lp_current.price.split(\";\")[1] : lp_defaults.priceMax\n                    }\n                });\n            },\n            \"render\": function() {\n                var lp_current = ListPage.model.params.current,\n                    lp_changes = ListPage.model.params.changes,\n                    lp_defaults = ListPage.model.params.defaults,\n                    lp_page = ListPage.model.params.page,\n                    lp_clipboard = ListPage.model.clipboard,\n                    lp_filterPlugins = ListPage.view.filterPlugins,\n                    pushStateValue = ListPage.model.URLParams,\n                    filterControls;\n\n\n                if (lp_clipboard.pageType === \"nc\") {\n                    if(pushStateValue === \"\")\n                        pushStateValue = window.location.pathname;\n                    window.history.pushState(\"\", \"Filters\", pushStateValue);\n                } else if(lp_clipboard.pageType === \"nc-filter\"){\n                    // TODO: Skip for now. Add any hash changes required on Configured Filter Page\n                } else {\n                    window.location.hash = ListPage.model.URLParams;\n                }\n\n                if (lp_clipboard.isOnLoad) {\n                    $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").show();\n                }\n                if (ListPage.services.filterURL.fromParams(lp_current) !== ListPage.services.filterURL.fromParams(lp_page)) {\n                    $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").hide();\n                    $(\".js-list-ttl\").html($(\".list-info__ttl\").html());\n                }\n\n                if (lp_clipboard.pageType === \"nc\") {\n                    if ($(\".body-wrpr\").data(\"indexed\")) {\n                        $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").show();\n                    } else {\n                        $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").hide();\n                    }\n                }\n\n                ;(function updateProductListAndOtherWidgets() {\n                    var lp_changes = $.extend({}, ListPage.model.params.changes),\n                        lp_current = $.extend({}, ListPage.model.params.current),\n                        loadingMaskHtml = ListPage.view.components.loadingMask(),\n                        loadingMaskSmall = ListPage.view.components.loadingMaskSmall(),\n                        loadingStart = +new Date();\n\n                    if (lp_clipboard.pageType === \"nc\") {\n                        if (!lp_clipboard.scroll.isLoading) {\n                            lp_clipboard.scroll.counter = 0;\n                        }\n\n                        $.extend(lp_current, {\n                            \"start\": lp_clipboard.scroll.counter * 24,\n                            \"rows\": 24,\n                            \"pageName\": lp_clipboard.pageName\n                        });\n\n                    }\n\n                    // get new product list and filters based on updated current params\n                    if (lp_clipboard.pageType === \"nc\" && lp_clipboard.isOnLoad){\n                        //no rerender needed here \n                    }\n                    // get new product list and filters based on updated current params\n                    else if ($(\".body-wrpr\").length !== 0) {\n\n                        if (!(lp_clipboard.isOnLoad && lp_clipboard.isLoadParamsEqualtoPageParams)) {\n\n                            // if($(\".js-fltr-ldng-mask\").length !== 0)\n                            if(lp_clipboard.scroll.isLoading || lp_clipboard.pageType == \"search\"){\n                                $(\".js-prdct-grid-wrpr\").append(loadingMaskSmall);\n                            }\n                            else{\n                                $(\".js-prdct-grid-wrpr\").append(loadingMaskHtml);    \n                            }\n\n                            $(\".js-load-more\").hide();\n                            ListPage.services.fetch.productList(lp_current).done(function(response) {\n                                var freshData = response.split(\"//&//#\"),\n                                    lp_filterPlugins = ListPage.view.filterPlugins;\n\n                                //Remove No Data DOM\n                                $(\".prdct-grid__no-data\").remove();\n                                ListPage.model.params.current.page = undefined;\n\n                                if (lp_changes.inFilterBox) {\n                                    // manipulate loaded filter html\n                                    var $newFilterBox = $(freshData[0]),\n                                        $groupsToReplace,\n                                        replacedGroups = [];\n\n                                    $groupsToReplace = (function() {\n                                        var affectedGroups = (function() {\n                                            var result = [];\n                                            $.each([\"add\", \"remove\"], function(i, context) {\n                                                if (\"price\" in lp_changes[context]) {\n                                                    result.push(\"price\");\n                                                }\n                                                if (\"property\" in lp_changes[context]) {\n                                                    $.each(lp_changes[context].property, function(i, propValue) {\n                                                        var groupname = $(\".fltr-val[value='\" + propValue + \"']\").closest(\".fltr\").data(\"groupname\");\n                                                        result.push(groupname);\n                                                    });\n                                                }\n                                            });\n                                            return result;\n                                        }());\n\n                                        return $newFilterBox.find(\".fltr\").filter(function() {\n                                            return affectedGroups.indexOf($(this).data(\"groupname\")) === -1;\n                                        });\n                                    }());\n\n                                    $groupsToReplace.each(function() {\n                                        var $newFilterBlock = $(this),\n                                            groupname = $newFilterBlock.data(\"groupname\"),\n                                            $exisingFilterBlock = $(\".fltr[data-groupname='\" + groupname + \"']\");\n                                        replacedGroups.push(groupname);\n                                        $exisingFilterBlock.replaceWith($newFilterBlock);\n                                    });\n\n                                    lp_filterPlugins.init({\n                                        \"priceSlider\": {\n                                            \"min\": lp_clipboard.slider.priceMin,\n                                            \"max\": lp_clipboard.slider.priceMax\n                                        }\n                                    }, replacedGroups);\n                                } else {\n                                    // load new filters\n                                    $(\".fltr-wrpr1\").html(freshData[0]);\n                                    lp_filterPlugins.init({\n                                        \"priceSlider\": {\n                                            \"min\": lp_clipboard.slider.priceMin,\n                                            \"max\": lp_clipboard.slider.priceMax\n                                        }\n                                    });\n                                }\n\n                                if (!lp_clipboard.isLoadParamsEqualtoPageParams || lp_clipboard.scroll.isLoading) {\n\n                                    if (lp_clipboard.pageType === \"nc\") {\n                                        $(\".js-pgntn-cnt-ajax, .js-prdct-cnt-ajax\").remove();\n\n                                        if (lp_clipboard.scroll.isLoading) {\n                                            $(\".js-prdct-grid-wrpr\").append(freshData[1]);\n                                        } else {\n                                            $(\".js-prdct-grid-wrpr\").html(freshData[1]);\n                                        }\n\n                                        //Update bottom pagination counter\n                                        $(\".js-pgntn-cnt__crnt\").text($(\".js-pgntn-cnt-ajax\").data('current'));\n                                        $(\".js-pgntn-cnt__totl\").text($(\".js-pgntn-cnt-ajax\").data('total'));\n\n                                    } else {\n                                        $(\".js-prdct-grid-wrpr\").html(freshData[1]);\n                                    }\n\n                                    //Update top left product counter\n                                    var productCount = $(\".js-prdct-cnt-ajax\").data('count');\n                                    var totalProducts = $(\".js-prdct-cnt-ajax\").data('total');\n\n                                    if (productCount && productCount.split(\"-\")[1] >= totalProducts) {\n                                        $(\".js-load-more\").hide();\n                                    }\n                                    else {\n                                        $(\".js-load-more\").show();   \n                                    }\n\n\n                                    $(\".js-prdct-cnt__rng\").text(productCount);\n                                    $(\".js-prdct-cnt__totl\").text(totalProducts);\n                                } else {\n                                    lp_clipboard.isLoadParamsEqualtoPageParams = false;\n                                }\n\n                               if(ListPage.model.clipboard.pageType === \"search\"){\n                                     $('.srch-fdbck').show();\n                                }\n\n                                lazyLoadImages();\n                                lazyLoadBgImages();\n                                attachFilterScroll();\n                            }).always(function() {\n                                var loadingTime = +new Date() - loadingStart,\n                                    loadingMaskDelay = (loadingTime < 250) ? (250 - loadingTime) : 0;\n                                ProductList.initGrid();\n\n                                setTimeout(function() {\n                                    $(\".ldng-mask-wrpr\").remove();\n                                    $(\".js-fltr-ldng-mask\").remove();\n                                }, loadingMaskDelay);\n\n                                lp_clipboard.scroll.isLoading = false;\n                            });\n                        } else {\n                            lp_clipboard.scroll.isLoading = false;\n                            $(\".js-fltr-ldng-mask\").remove();\n                            lp_clipboard.isLoadParamsEqualtoPageParams = false;\n                        }\n                    }\n\n                    // get new hourly deals based on updated current params\n                    if ($(\".js-hrly-deals-grid\").length) {\n                        ;(function _getHourlyDeals() {\n                            var $hourlyDealsWidget = $(\".js-hrly-deals-grid\");\n\n                            ListPage.services.fetch.hourlyDeals(lp_current).done(function(html) {\n                                var $timer, dataMinutes, dataSeconds, timerStart, clockStart,\n                                    timerHtml = html.split(\"//&//#\")[0],\n                                    productsHtml = html.split(\"//&//#\")[1];\n\n                                function parseTime(value) {\n                                    value = parseInt(value, 10);\n                                    return (isNaN(value) || value < 0 || value > 59) ? 59 : value;\n                                }\n\n                                $hourlyDealsWidget.find(\".sctn__inr\").html(productsHtml);\n                                $hourlyDealsWidget.find(\".js-hrly-deals__cntdwn-wrpr\").html(timerHtml);\n\n                                if ($(productsHtml).filter(\".prdct-item-with-bdg\").length > 2) {\n                                    $hourlyDealsWidget.find(\".sctn__view-all-link\").show();\n                                } else {\n                                    $hourlyDealsWidget.find(\".sctn__view-all-link\").hide();\n                                }\n\n                                $timer = $hourlyDealsWidget.find(\".cntdwn\");\n                                if ($timer.length) {\n                                    dataMinutes = parseTime($timer.find(\".cntdwn__mins\").data(\"minutes\"));\n                                    dataSeconds = parseTime($timer.find(\".cntdwn__scnds\").data(\"seconds\"));\n                                    timerStart = dataMinutes * 60 + dataSeconds;\n                                    clockStart = parseInt(+new Date() / 1000, 10);\n\n                                    if (!(dataMinutes === 0 && dataSeconds === 0)) {\n                                        timerInterval = setInterval((function timer() {\n                                            var elapsedTime = (Math.floor(+new Date() / 1000) - clockStart),\n                                                minutes = Math.floor((timerStart - elapsedTime) / 60),\n                                                seconds = (timerStart - elapsedTime) % 60;\n\n                                            if (seconds <= 0) {\n                                                seconds = 59;\n                                                if (minutes <= 0) {\n                                                    clearInterval(timerInterval);\n                                                    _getHourlyDeals();\n                                                    return;\n                                                }\n                                            }\n                                            $timer.find(\".cntdwn__mins\").text(minutes < 10 ? \"0\" + minutes : minutes);\n                                            $timer.find(\".cntdwn__scnds\").text(seconds < 10 ? \"0\" + seconds : seconds);\n                                            return timer;\n                                        }()), 1000);\n                                    } else {\n                                        $timer.hide();\n                                        $hourlyDealsWidget.find(\".hrly-deals-expry-lbl\").hide();\n                                    }\n                                }\n                            }).fail(function() {\n                                $hourlyDealsWidget.find(\".cntdwn\").hide();\n                                $hourlyDealsWidget.find(\".hrly-deals-expry-lbl\").hide();\n                            });\n                        }());\n                    }\n                }());\n\n                // operations to be done to add/remove filters.\n                filterControls = {\n                    \"add\": function() {\n                        var $filterGroupOptions,\n                            appliedFilterComponents = ListPage.view.components.appliedFilter;\n\n                        // initialize all filtergroups, cleargroups as inactive and activate based on current params\n                        $(\".fltr__cler\").removeClass(\"fltr__cler--show\");\n                        //$('.fltr__val').removeClass('active');\n\n                        // apply all filters registered on filterControls.add.queue\n                        $.each(filterControls.add.queue, function(i, filterItem) {\n                            // batch html of all the filters to append all filter tags in one go.\n                            if (\"unitValue\" in filterItem) {\n                                $filterGroupOptions = $(\".fltr[data-groupname='\" + filterItem.groupName + \"'] .fltr-val__inpt\");\n                                if ($filterGroupOptions.closest(\".fltr-val\").hasClass(\"js-fltr-val--sngl\") || filterItem.groupName == \"localSearch\" || filterItem.groupName == \"price\") {\n                                    $(\".js-fltrs-apld[data-groupname='\" + filterItem.groupName + \"']\").remove();\n                                }\n                                $filterGroupOptions.filter(\"[value='\" + filterItem.unitValue + \"']\").prop(\"checked\", true);\n                                setTimeout(function() {\n                                    $(\".fltr[data-groupname='\" + filterItem.groupName + \"']\").find(\".fltr__cler\").addClass(\"fltr__cler--show\");\n                                }, 0);\n                            }\n                            if (filterItem.groupName == \"price\") {\n                                // update priceSlider range points\n                                $(\".fltr-prc__sldr\").slider(\"values\", [\n                                    lp_filterPlugins.priceSlider.priceToRange(filterItem.unitValue.split(\";\")[0]),\n                                    lp_filterPlugins.priceSlider.priceToRange(filterItem.unitValue.split(\";\")[1])\n                                ]);\n                                $(\".js-fltr-prc__inpt-min\").val(filterItem.unitValue.split(\";\")[0]);\n                                $(\".js-fltr-prc__inpt-max\").val(filterItem.unitValue.split(\";\")[1]);\n                            }\n                            // batch html of all the filters to append all filter tags in one go.\n                            if ($(\".js-fltrs-apld[data-groupname='\" + filterItem.groupName + \"']\").length !== 0) {\n                                $(\".js-fltrs-apld[data-groupname='\" + filterItem.groupName + \"']\").append(appliedFilterComponents.unit(filterItem));\n                            } else {\n                                $(\".js-fltrs-apld-wrpr\").append(appliedFilterComponents.group(filterItem));\n                            }\n                        });\n\n                        if (filterControls.add.queue.length !== 0) {\n                            $(\".js-fltrs-apld-wrpr1\").show();\n\n                            ;(function showFollowThisSearchButton() {\n\n                                if (lp_clipboard.pageType !== \"nc\") {\n\n                                    var subcatName = $('.body-wrpr').data('listname'),\n                                        subcatCode = $('.body-wrpr').data('listcode'),\n                                        URLParams = encodeURIComponent(window.location.hash);\n\n                                    var hrefVal = \"../../promotions/savesearchpopup.php?subcatname=\" + encodeURIComponent(subcatName) + \"&subcatcode=\" + encodeURIComponent(subcatCode) + \"&filterhash=\" + URLParams;\n                                    $(\".list-hdr__save\").data(\"href\", hrefVal).show();\n                                }\n\n                            }());\n                        }\n                    },\n                    \"remove\": function() {\n                        // remove all filters registered on filterControls.remove.queue\n                        $.each(filterControls.remove.queue, function(i, filterItem) {\n                            var $remfilterGrp = $(\".js-fltrs-apld[data-groupname='\" + filterItem.groupName + \"']\"),\n                                $remfilterUnit = $remfilterGrp.find(\".js-fltrs-apld__item[data-value='\" + filterItem.unitValue + \"']\"),\n                                $filterOption = $(\".fltr-val__inpt[value='\" + filterItem.unitValue + \"']\");\n\n                            if ($remfilterGrp.find(\".js-fltrs-apld__item\").length === 1) {\n                                $remfilterGrp.remove();\n                            } else {\n                                $remfilterUnit.remove();\n                            }\n\n                            // FIXME:: on clearing --multi filter block first item remains selected\n                            // -> setTimeout is a temporary fix to do unchecking after handler is executed.\n                            setTimeout(function() {\n                                $filterOption.prop(\"checked\", false);\n\n                                if ($filterOption.closest(\".fltr\").find(\".fltr-val__inpt:checked\").length === 0) {\n                                    $filterOption.closest(\".fltr\").find(\".fltr__cler\").removeClass(\"fltr__cler--show\");\n                                }\n                            }, 0);\n\n                            if (filterItem.groupName === \"price\") {\n                                // update priceSlider range points\n                                $(\".fltr-prc__sldr\").slider(\"values\", [0, 200]);\n                                $(\".js-fltr-prc__inpt-min\").val(lp_defaults.priceMin);\n                                $(\".js-fltr-prc__inpt-max\").val(lp_defaults.priceMax);\n                            }\n                        });\n\n                        // if all filter tags removed remove \"clear all\" filter tag also\n                        if ($(\".js-fltrs-apld\").length === 0) {\n                            $(\".js-fltrs-apld-wrpr1\").hide();\n                            $(\".list-hdr__save\").hide();\n                        }\n                    }\n                };\n\n                // after all filters added/removed reinitialize queue to empty.\n                filterControls.add.queue = [];\n                filterControls.remove.queue = [];\n\n                // register all filter changes to filterControls queue to batch applying and removing operations.\n                $.each([\"add\", \"remove\"], function(i, action) {\n                    if (\"s\" in lp_changes[action]) {\n                        $(\".js-hdr-srch\").val(lp_changes[action].s);\n                        filterControls[action].queue.push({\n                            \"unitValue\": lp_changes[action].s,\n                            \"unitLabel\": lp_changes[action].s,\n                            \"groupName\": \"searchTerm\",\n                            \"groupLabel\": \"Search\"\n                        });\n                    }\n                    if (\"sort\" in lp_changes[action]) {\n                        $('.js-list-sort option[value=\"' + lp_changes[action].sort + '\"]').attr(\"selected\", \"selected\");\n                    }\n\n                    if (\"ss\" in lp_changes[action]) {\n                        $(\".list-hdr-srch__fld\").val(lp_current.ss);\n                        filterControls[action].queue.push({\n                            \"unitValue\": lp_changes[action].ss,\n                            \"unitLabel\": lp_changes[action].ss,\n                            \"groupName\": \"localSearch\",\n                            \"groupLabel\": \"List Search\"\n                        });\n                    }\n                    if (\"price\" in lp_changes[action]) {\n                        ;(function() {\n                            var startInr = lp_changes[action].price.split(\";\")[0],\n                                endInr = lp_changes[action].price.split(\";\")[1],\n                                unitValue = lp_changes[action].price,\n                                unitLabel = startInr.toLocaleString() + \"-\" + endInr.toLocaleString(),\n                                minSlider, maxSlider;\n\n                            filterControls[action].queue.push({\n                                \"unitValue\": unitValue,\n                                \"unitLabel\": unitLabel,\n                                \"groupName\": 'price',\n                                \"groupLabel\": 'price'\n                            });\n\n                            // if price filter is to be added update slider values to new values\n                            if (action === \"add\") {\n                                lp_clipboard.slider.priceMin = startInr;\n                                lp_clipboard.slider.priceMax = endInr;\n                                // if price filter is to be removed update slider values to min and max values.\n                            } else {\n                                lp_clipboard.slider.priceMin = lp_defaults.priceMin;\n                                lp_clipboard.slider.priceMax = lp_defaults.priceMax;\n                            }\n                        }());\n                    }\n                    if (\"property\" in lp_changes[action]) {\n                        $.each(lp_changes[action].property, function(i, value) {\n                            var $filterItem = $('.fltr-val__inpt[value=\"' + value + '\"]'),\n                                $topFilter = $('.js-fltrs-apld__item[data-value=\"' + value + '\"]'),\n                                unitValue = value,\n                                unitLabel = $filterItem.attr(\"dispname\"),\n                                groupName = $filterItem.closest(\".fltr\").data(\"groupname\")?$filterItem.closest(\".fltr\").data(\"groupname\"):$topFilter.closest(\".js-fltrs-apld\").data(\"groupname\"),\n                                groupLabel = $.trim($filterItem.closest(\".fltr\").find(\".fltr__ttl\").text());\n\n                            filterControls[action].queue.push({\n                                \"unitValue\": unitValue,\n                                \"unitLabel\": unitLabel,\n                                \"groupName\": groupName,\n                                \"groupLabel\": groupLabel\n                            });\n                        });\n                    }\n                    if (\"discount\" in lp_changes[action]) {\n                        var unitValue = lp_changes[action].discount,\n                            unitLabel = lp_changes[action].discount.split(\";\")[0] + \"% - \" + lp_changes[action].discount.split(\";\")[1] + \"%\";\n                        filterControls[action].queue.push({\n                            \"unitValue\": unitValue,\n                            \"unitLabel\": unitLabel,\n                            \"groupName\": 'discount',\n                            \"groupLabel\": 'discount'\n                        });\n                    }\n                });\n\n                $.each([\"add\", \"remove\"], function(i, action) {\n                    if (filterControls[action].queue.length) {\n                        filterControls[action]();\n                    }\n                });\n\n                $.extend(lp_clipboard, {\n                    \"prevMinPrice\": lp_current.price ? lp_current.price.split(\";\")[0] : lp_defaults.minPrice,\n                    \"prevMaxPrice\": lp_current.price ? lp_current.price.split(\";\")[1] : lp_defaults.maxPrice,\n                    \"prevLocalSearch\": lp_current.ss || \"\"\n                });\n\n                // after all changes reflected in the view re-initialize changes to empty.\n                $.extend(lp_changes, {\n                    \"add\": {},\n                    \"remove\": {}\n                });\n            },\n            \"filterPlugins\": {\n                \"init\": function(settings, replacedGroups) {\n                    ListPage.view.filterPlugins.nanoScrollbarInit(replacedGroups);\n                    ListPage.view.filterPlugins.priceSlider.init(settings.priceSlider, replacedGroups);\n                },\n                \"priceSlider\": {\n                    \"init\": function(settings, replacedGroups) {\n                        var minPrice = settings.min,\n                            maxPrice = settings.max,\n                            minSlider = minPrice ? this.priceToRange(minPrice) : 0,\n                            maxSlider = maxPrice ? this.priceToRange(maxPrice) : 200,\n                            lp_changes = ListPage.model.params.changes,\n                            lp_filterPlugins = ListPage.view.filterPlugins;\n\n                        if ($.isArray(replacedGroups) && replacedGroups.indexOf(\"price\") === -1) {\n                            return;\n                        }\n\n                        $(\".fltr-prc__sldr\").slider({\n                            \"range\": true,\n                            \"min\": 0,\n                            \"max\": 200,\n                            \"values\": [minSlider || 0, maxSlider || 200],\n                            \"step\": 1,\n                            \"animate\": true,\n                            \"slide\": lp_filterPlugins.priceSlider.callback,\n                            \"stop\": function(a, b) {\n                                var startInr, endInr;\n\n                                if (b.values[0] === 0 && b.values[1] === 200) {\n                                    startInr = ListPage.model.clipboard.prevMinPrice;\n                                    endInr = ListPage.model.clipboard.prevMaxPrice;\n\n                                    // if range is equal to total range then remove price filter\n                                    lp_changes.remove.price = startInr + \";\" + endInr;\n                                } else {\n                                    startInr = lp_filterPlugins.priceSlider.rangeToPrice(b.values[0]);\n                                    endInr = lp_filterPlugins.priceSlider.rangeToPrice(b.values[1]);\n\n                                    // if range is not equal to total range then add new price filter\n                                    lp_changes.add.price = startInr + \";\" + endInr;\n                                }\n\n                                lp_changes.inFilterBox = true;\n                                ListPage.controller.updatePage();\n                                $(\".fltr-val__inpt:checked\").prop(\"checked\", false);\n                                $(\".fltr-prc__sldr\").slider(\"values\", [b.values[0], b.values[1]]);\n                            }\n                        });\n\n                        if (minPrice || maxPrice) {\n                            $(\".js-fltr-prc__inpt-min\").val(minPrice || ListPage.model.params.defaults.price.split(\";\")[0]);\n                            $(\".js-fltr-prc__inpt-max\").val(maxPrice || ListPage.model.params.defaults.price.split(\";\")[1]);\n                        }\n                    },\n                    // get price value from slider range value\n                    \"rangeToPrice\": function(a) {\n                        var priceMin = ListPage.model.params.defaults.priceMin,\n                            priceMax = ListPage.model.params.defaults.priceMax,\n                            b = Math.exp(Math.log(priceMax / priceMin) / 200),\n                            priceValue = priceMin * Math.pow(b, a),\n                            roundOff = Math.pow(10, Math.floor(Math.log(priceValue - (priceValue / b)) / Math.log(10)));\n\n                        priceValue = Math.ceil(priceValue / roundOff) * roundOff;\n                        if (a === 0 || priceValue < priceMin) return priceMin;\n                        else if (a == 200 || priceValue > priceMax) return priceMax;\n                        else return priceValue;\n                    },\n                    // get slider range from price value\n                    \"priceToRange\": function(price) {\n                        var result = (function binarySearch(a, fn, min, max) {\n                            binarySearch.old = binarySearch.current;\n                            binarySearch.current = Math.floor((min + max) / 2);\n                            if (binarySearch.old === binarySearch.current) {\n                                return binarySearch.current;\n                            }\n                            if (a > fn(binarySearch.current)) {\n                                min = binarySearch.current;\n                            } else if (a < fn(binarySearch.current)) {\n                                max = binarySearch.current;\n                            } else {\n                                return binarySearch.current;\n                            }\n                            return binarySearch(a, fn, min, max);\n                        }(price, ListPage.view.filterPlugins.priceSlider.rangeToPrice, 0, 200));\n                        return result;\n                    },\n                    // run this function while sliding the price slider.\n                    \"callback\": function(a, b) {\n                        var minPrice, maxPrice;\n                        if ((b.values[0] + 1) >= b.values[1]) {\n                            return false;\n                        }\n                        minPrice = ListPage.view.filterPlugins.priceSlider.rangeToPrice(b.values[0]);\n                        maxPrice = ListPage.view.filterPlugins.priceSlider.rangeToPrice(b.values[1]);\n                        $(\".js-fltr-prc__inpt-min\").val(minPrice);\n                        $(\".js-fltr-prc__inpt-max\").val(maxPrice);\n                    },\n                },\n                // init nanoscrollbar plugin to get overflow scroll to filterGroups\n                \"nanoScrollbarInit\": function(filterGroups) {\n                    var $nanoElements;\n\n                    if (filterGroups) {\n                        $nanoElements = $(\".fltr-val-wrpr.nano\").filter(function() {\n                            return filterGroups.indexOf($(this).closest(\".fltr\").data(\"groupname\")) !== -1;\n                        });\n                    } else {\n                        $nanoElements = $(\".fltr-val-wrpr.nano\");\n                    }\n\n                    $nanoElements.each(function() {\n                        var totalHeight;\n                        $filteritem = $(\".fltr-val\", $(this));\n                        if ($filteritem.length <= ListPage.settings.filterLength) {\n                            totalHeight = 0;\n                            $filteritem.each(function() {\n                                totalHeight += $(this).outerHeight(true);\n                            });\n                            if (totalHeight < 224) $(this).css(\"height\", totalHeight + 'px');\n                        }\n                    });\n                    $nanoElements.nanoScroller({\n                        \"alwaysVisible\": true\n                    });\n                },\n            },\n            \"components\": {\n                \"appliedFilter\": {\n                    \"group\": function(filterItem) {\n                        return [\n                            '<div class=\"js-fltrs-apld\" data-groupname=\"' + filterItem.groupName + '\">',\n                            '<div class=\"js-fltrs-apld__lbl\">' + filterItem.groupLabel + ':</div>',\n                            this.unit(filterItem),\n                            '</div>'\n                        ].join(\"\");\n                    },\n                    \"unit\": function(filterItem) {\n                        return [\n                            '<div class=\"js-fltrs-apld__item\" data-value=\"' + filterItem.unitValue + '\">',\n                            '<span class=\"js-fltrs-apld__item-label\">' + filterItem.unitLabel + '</span>',\n                            '<img class=\"js-fltrs-apld__item-cler\" src=\"https://assets.mspcdn.net/msp-ui/icons/cross-grey-small.png\"/>',\n                            '</div>'\n                        ].join(\"\");\n                    }\n                },\n                \"loadingMask\": function() {\n                    return [\n                        '<div class=\"js-fltr-ldng-mask\">',\n                        '<div class=\"ldr\">',\n                        '<div class=\"ldr__crcl\"></div>',\n                        '<div class=\"ldr__text\" style=\"\">Loading...</div> ',\n                        '</div>',\n                        '</div>'\n                    ].join(\"\");\n                },\n                \"loadingMaskSmall\": function() {\n                  return [\n                        '<div class=\"ldng-mask-wrpr\">',\n                        '<div class=\"js-fltr-ldng-mask\">',\n                        '<div class=\"ldr ldr--sml\">',\n                        '<div class=\"ldr__crcl\"></div>',\n                        '<div class=\"ldr__text\" style=\"\">Loading...</div> ',\n                        '</div>',\n                        '</div>',\n                        '</div>'\n                    ].join(\"\");  \n                }\n            }\n        }\n    };\n\n    // if category is mobile then first show mobile list and then show applied filters list.\n    if ($(\"#mobilefilterwrapper\").length) {\n        $.ajax({\n            url: \"/msp/prop_filters/mobile-new.html\"\n        }).done(function(response) {\n            var data = response.split(\"//&//#\");\n            $(\"#mobilefilterwrapper\").html(data[0]);\n            ListPage.controller.init();\n        });\n    } else {\n        ListPage.controller.init();\n    }\n\n    var ProductList = {\n        \"initGrid\": function() {\n            if(ListPage.model.clipboard.pageType===\"nc-filter\"){\n                return;\n            }\n            if (localStorage.getItem(\"gridType\") === \"large\") {\n                this.setGridType(\"large\");\n            } else if (localStorage.getItem(\"gridType\") === \"small\") {\n                this.setGridType(\"small\");\n            }\n            Modules.$doc.on(\"click\", \".js-list-hdr-view\", function() {\n                if ($(this).hasClass(\"list-hdr-view__prdct-l\")) {\n                    ProductList.setGridType(\"large\");\n                } else {\n                    ProductList.setGridType(\"small\");\n                }\n            });\n        },\n        \"setGridType\": function(type) {\n            $(\".list-hdr-view__prdct-l\").removeClass(\"list-hdr-view__prdct-l--slctd\");\n            $(\".list-hdr-view__prdct-s\").removeClass(\"list-hdr-view__prdct-s--slctd\");\n\n            if (type === \"large\") {\n                $(\".prdct-grid\").addClass(\"prdct-grid--prdct-l\");\n                $(\".prdct-grid\").removeClass(\"prdct-grid--prdct-s\");\n                $(\".list-hdr-view__prdct-l\").addClass(\"list-hdr-view__prdct-l--slctd\");\n                localStorage.setItem(\"gridType\", \"large\");\n            } else {\n                $(\".prdct-grid\").addClass(\"prdct-grid--prdct-s\");\n                $(\".prdct-grid\").removeClass(\"prdct-grid--prdct-l\");\n                $(\".list-hdr-view__prdct-s\").addClass(\"list-hdr-view__prdct-s--slctd\");\n                localStorage.setItem(\"gridType\", \"small\");\n            }\n        }\n    };\n\n    ProductList.initGrid();\n\n    $(document).on('change', '.fltr-val__inpt', function() {\n      var group = $(this).parents('.fltr').data('groupname');\n      var label = $(this).next('.fltr-val__text').children('.fltr-val__lbl').text().trim();\n      \n      if(window.ga) {\n          ga('send', 'event', 'listpage_filters', group, label);\n      }\n\n      //Hide SEO Text\n      $(\".list-main__ttl, .list-info__dscrptn, .list-info__link-wrpr\").hide();\n    });\n\n    // search in filter groups.\n    $(\".fltr-wrpr1\").on(\"keyup\", \".fltr-srch__fld\", function() {\n        var filterSearchQuery = $.trim($(this).val()),\n            $filterGroup = $(this).closest(\".fltr\");\n        if (filterSearchQuery === \"\") {\n            $filterGroup.find(\".fltr-val\").show();\n            $filterGroup.find(\".fltr-srch__icon--srch\").removeClass(\"fltr-srch__icon--hide\");\n            $filterGroup.find(\".fltr-srch__icon--cler\").addClass(\"fltr-srch__icon--hide\");\n            $filterGroup.find(\".nano\").nanoScroller();\n        } else {\n            $filterGroup.find(\".fltr-val\").hide();\n            $filterGroup.find(\".fltr-srch__icon--srch\").addClass(\"fltr-srch__icon--hide\");\n            $filterGroup.find(\".fltr-srch__icon--cler\").removeClass(\"fltr-srch__icon--hide\");\n            $filterGroup.find(\".fltr-val\").filter(function() {\n                var itemText = $.trim($(this).text()).toLowerCase(),\n                    index = itemText.indexOf(filterSearchQuery),\n                    result = false;\n                if (index === 0) {\n                    result = true;\n                } else if (index > 0) {\n                    if (itemText.toLowerCase().charAt(index - 1) === \" \") {\n                        result = true;\n                    }\n                }\n                return result;\n            }).show();\n            $filterGroup.find(\".nano\").nanoScroller();\n        }\n    });\n\n    // clear search in filterGroups\n    $(\".fltr-wrpr1\").on(\"click\", \".js-fltr-srch__cler\", function() {\n        var $filterGroup = $(this).closest(\".fltr\");\n        $filterGroup.find(\".fltr-srch__fld\").val(\"\");\n        $filterGroup.find(\".fltr-srch__icon\").toggleClass(\"fltr-srch__icon--hide\");\n        $filterGroup.find(\".fltr-val\").show();\n        $filterGroup.find(\".nano\").nanoScroller();\n    });\n\n    ;(function goToFilterOnScroll() {\n        var $listMain = $('.list-main'),\n            $filter = $('.fltr-wrpr1');\n        if($listMain.length) {\n            $listMain.append([\n                '<span class=\"btn btn--s show-fltr js-show-fltr js-inpg-link\" data-href=\"list-filter\">',\n                    'Show Filters',\n                '</span>'].join(''));\n            $filter.attr('data-id', 'list-filter');\n\n            window.onscroll = function(e) {\n                var $showFilter = $('.js-show-fltr'),\n                    filterBottom = $filter.offset().top + $filter.outerHeight(),\n                    additionalSpace = Modules.$win.height();\n                    scrolledBottom = Modules.$win.scrollTop() + Modules.$win.height(),\n                    listMainBottom = $listMain.offset().top + $listMain.outerHeight();\n\n                if (scrolledBottom <= filterBottom + additionalSpace) {\n                    if($showFilter.filter(':visible').length) {\n                        $showFilter.hide(0);\n                    }\n                } else {\n                    $showFilter.show(0);\n                    if (scrolledBottom > listMainBottom) {\n                        $showFilter\n                            .removeClass('fixed')\n                                .addClass('abslt');\n                    } else {\n                        $showFilter\n                            .removeClass('abslt')\n                                .addClass('fixed')\n                                    .css('left', $filter.offset().left + 'px');\n                    }\n                }\n            };\n        }\n    })();\n}","if (location.pathname === \"/\") {\n    Modules.$doc.on(\"click\", \".mCycleItemWrapper:first-child\", function() {\n        window.ga && ga(\"send\", \"event\", \"HomePage\", \"promo-bnr-click\", \"first-bnr\");\n    });\n}\n","/* Search scoring functionality [Start] */\n\nvar QnASearch = {\n    settings: {\n        mspId: function() {\n            if (dataLayer[0].pagetype === 'single') {\n                return dataLayer[0].mspid && dataLayer[0].mspid;\n            } else if ($('.js-prdct-ttl').data('mspid') || dataLayer[0].pagetype === 'qna_single') {\n                return dataLayer[0].mspid && dataLayer[0].mspid;\n            } else if (dataLayer[0].pagetype === 'qna_list') {\n                return dataLayer[0].mspid && dataLayer[0].mspid;\n            }\n        },\n        qnaApi: function() {\n            return '/review/qna/search/?mspid=' + QnASearch.settings.mspId();\n        },\n        inputSelector: function() {\n            if (dataLayer[0].pagetype === 'single') {\n                return '.js-qstn-txt';\n            } else if (dataLayer[0].pagetype === 'qna_single') {\n                return '.js-qstn-txt';\n            } else if (dataLayer[0].pagetype === 'qna_list') {\n                return '.js-qstn-txt';\n\n            }\n        },\n        questionCount: 5, // number of questions in search result\n        answerCount: 3, // number of answers in respective question search result if keyword found\n        weightage: {\n            fullMatch: 2,\n            partialMatch: 1,\n            uniqueMatch: 3,\n            repeatMatch: 2,\n            sequence: 1.5,\n            caseMatch: 2,\n            minRelevance: .6\n        },\n        stopWords: ['i', 'the', 'is', 'a', 'all', 'am', 'an', 'and', 'are', 'as', 'at', 'be', 'by', 'in', 'into', 'it', 'its', 'my', 'no', 'nor', 'not', 'of', 'on', 'or', 'that', 'then', 'this', 'to', 'was', 'were', 'does', 'has', 'have', 'had', 'when', 'where', 'which', 'what', 'how', 'do', 'why', 'who', 'whose', 'if', 'both', 'we', 'will', 'with', 'without']\n    },\n    data: {\n        searchWordsArr: [],\n        sDataJson: {},\n        sequence: [],\n        qnaJson: '',\n\n    },\n    buildFunction: {\n        init: function(url) {\n            return QnASearch.data.searchWordsArr = QnASearch.buildFunction.getJson(url).done(function(response) {\n                //var jsonData = sDataJson = response;\n                QnASearch.data.qnaJson = response;\n                QnASearch.data.sDataJson = response;\n                return QnASearch.buildFunction.splittingInWordsArray(QnASearch.data.qnaJson);\n            });\n        },\n        getJson: function(url) {\n            var dfd = $.Deferred();\n            $.ajax({\n                url: url,\n                dataType: 'json'\n            }).done(function(response) {\n                mData = response;\n                return dfd.resolve(response);\n            });\n            return dfd.promise();\n        },\n        keywordArrayToJson: function(questionId, searchArr, wordArr, valueFactor, arrayType, answerWordIndex) {\n            for (var i = 0; i < wordArr.length; i++) {\n                if (wordArr[i] == '') {\n                    break;\n                }\n                searchArr.push({\n                    'word': wordArr[i],\n                    'questionId': questionId,\n                    'answerWordIndex': answerWordIndex,\n                    'valueFactor': valueFactor,\n                    'sentenceIndex': i,\n                    'searchArrayIndex': searchArr.length\n                });\n            }\n            return searchArr;\n        },\n        splittingInWordsArray: function(mData) {\n            var tempObj = {},\n                searchArr = [],\n                answerWordIndex;\n            for (id in mData) {\n                var wordArr = (mData[id].question).replace(/[^a-zA-Z0-9' ]/g, '').split(' ').filter(function() {\n                    return true;\n                });\n                answerWordIndex = id + '-' + '0';\n                searchArr = QnASearch.buildFunction.keywordArrayToJson(id, searchArr, wordArr, 0.2, \"question\", answerWordIndex);\n                for (var j = 0; j < mData[id].answer.length; j++) {\n                    var answerWords = mData[id].answer[j].replace(/[^a-zA-Z0-9' ]/g, '').split(' ').filter(function() {\n                        return true;\n                    });\n                    answerWordIndex = id + '-' + j;\n                    searchArr = QnASearch.buildFunction.keywordArrayToJson(id, searchArr, answerWords, 0.2, 'answer', answerWordIndex);\n                    QnASearch.generalFunction.wipeAnArray(answerWords);\n                    answerWords = [];\n                }\n                wordArr = [];\n            };\n            searchArr = QnASearch.generalFunction.sortedByWord(searchArr);\n            QnASearch.data.builtData = searchArr;\n            return searchArr;\n        }\n\n    },\n    domObject: {\n        $loader: '<div class=\"ldr__ovrly\" style=\"height:50px;position: relative; overflow: hidden;\">\\\n                    <div class=\"ldr ldr--s\">\\\n                        <div class=\"ldr__crcl\"></div>\\\n                    </div>\\\n                </div>',\n    },\n    generalFunction: {\n        sortedByWord: function(searchArray) {\n            searchArray.sort(function(a, b) {\n                var alc = a.word.toLowerCase().toString(),\n                    blc = b.word.toLowerCase().toString();\n                return alc > blc ? 1 : alc < blc ? -1 : 0;\n            });\n            return searchArray;\n        },\n        sortQuestionsAns: function(resultArr) {\n            resultArr.sort(function(a, b) {\n                return b.matchScore - a.matchScore\n            });\n            return resultArr;\n        },\n        wipeAnArray: function(array) {\n            return array = [];\n        },\n        highlightText: function(selectorObj, searchItems) {\n            for (var i = 0; i < searchItems.length; i++) {\n                selectorObj.highlight(searchItems[i]);\n            }\n        },\n        keywordCleaner: function(term) {\n            if (!term) {\n                return false;\n            }\n            var stopWords = QnASearch.settings.stopWords;\n            return term.replace(/[.\\,\\/#!$%\\^&\\*;:{}=\\-_`~()?]/g, ' ').replace(\n                /[\\s]+/g, ' ').split(' ').reduce(function(a, v) {\n                if (v.length > 0 || (v === v.toUpperCase() && v.length > 1)) {\n                    if (stopWords.indexOf(v.toLowerCase()) == -1) {\n                        a.push(v);\n                    }\n                }\n                return a;\n            }, []);\n        }\n    },\n    binarySearch: function(searchArray, searchElement, caseInsensitive) {\n        if (typeof searchArray === 'undefined' || searchArray.length <= 0 || typeof searchElement === 'undefined' ||\n            searchElement === '') {\n            return -1;\n        }\n        var array = searchArray,\n            key = searchElement,\n            keyArr = [],\n            len = array.length,\n            ub = (len - 1),\n            p = 0,\n            mid = 0,\n            lb = p;\n\n        key = caseInsensitive && key && typeof key == 'string' ? key.toLowerCase() : key;\n\n        function isCaseInsensitive(caseInsensitive, element) {\n            return caseInsensitive && element.word && typeof element.word == 'string' ? (element.word).toLowerCase() :\n                element.word;\n        }\n        while (lb <= ub) {\n            mid = parseInt(lb + (ub - lb) / 2, 10);\n\n            if (isCaseInsensitive(caseInsensitive, array[mid]).indexOf(key) > -1) {\n                keyArr.push(mid);\n                if (keyArr.length > len) {\n                    return keyArr;\n                } else if (array[mid + 1] && isCaseInsensitive(caseInsensitive, array[mid + 1]).indexOf(key) > -1) {\n                    for (var i = 1; i < len; i++) {\n                        if (array[mid + 1] && isCaseInsensitive(caseInsensitive, array[mid + i]).indexOf(key) == -1) {\n                            break;\n                        } else {\n                            keyArr.push(mid + i);\n\n                        }\n                    }\n                }\n                if (keyArr.length > len) {\n                    return keyArr;\n                } else if (array[mid - 1] && isCaseInsensitive(caseInsensitive, array[mid - 1]).indexOf(key) > -1) {\n                    for (var i = 1; i < len; i++) {\n\n                        if (isCaseInsensitive(caseInsensitive, array[mid - i]).indexOf(key) == -1) {\n                            break;\n                        } else {\n                            keyArr.push(mid - i);\n                        }\n                    }\n                }\n                return keyArr;\n            } else if (key > isCaseInsensitive(caseInsensitive, array[mid])) {\n                lb = mid + 1;\n            } else {\n                ub = mid - 1;\n            }\n        }\n        return -1;\n\n    },\n    getSearchResult: function(searchKeywordsArr, builtData) {\n        var builtData = builtData,\n            termArr = searchKeywordsArr,\n            resultArr = [],\n            tempObj = [],\n            wordOccurrence;\n        if (termArr.length > 0) {\n            for (var i = 0, iLen = termArr.length; i < iLen; i++) {\n                termArrIndex = QnASearch.binarySearch(builtData, termArr[i], true, 'multiple');\n                if (termArrIndex !== -1 && termArrIndex.length >= 1) {\n                    $.each(termArrIndex, function(indx, vlu) { // if results are comming in array ie. multiple occurrence of a word;\n                        var questionId = builtData[vlu].questionId; // Every pair of answer and question contains a unique id.\n                        var answerWordIndex = builtData[vlu].answerWordIndex; // If it is answer keyword it contains word index in that sentence\n\n                        //Pass only array of object of highest matchScore question and answer;\n\n                        if (!QnASearch.data.sDataJson[questionId].wordOccurrence) {\n                            QnASearch.data.sDataJson[questionId].wordOccurrence = [];\n                            QnASearch.data.sDataJson[questionId].wordOccurrence.push(builtData[vlu].word);\n                            wordOccurrence = 1;\n                        } else if (QnASearch.data.sDataJson[questionId].wordOccurrence.indexOf(builtData[vlu].word) > -1) {\n                            QnASearch.data.sDataJson[questionId].wordOccurrence.push(builtData[vlu].word);\n                            wordOccurrence = 2;\n                        } else {\n                            QnASearch.data.sDataJson[questionId].wordOccurrence.push(builtData[vlu].word);\n                            wordOccurrence = 1;\n                        }\n\n                        //squnc_id\n                        var matchScore = 0;\n\n                        if (wordOccurrence > 1) {\n                            //Repeat Word [Tested]\n                            matchScore += parseInt(QnASearch.settings.weightage.repeatMatch);\n                        } else if (wordOccurrence === 1) {\n                            //Unique Word [Tested]\n                            matchScore += parseInt(QnASearch.settings.weightage.uniqueMatch);\n                        }\n\n                        if (termArr[i].toLowerCase() === builtData[vlu].word.toLowerCase()) {\n                            //Full Search [Tested]\n                            matchScore *= QnASearch.settings.weightage.fullMatch;\n                        } else {\n                            //Partial Search [Tested]\n                            matchScore *= QnASearch.settings.weightage.partialMatch;\n                        }\n\n                        if (termArr[i] === builtData[vlu].word) {\n                            //Case Sensitive [Tested]\n                            matchScore *= QnASearch.settings.weightage.caseMatch;\n                        } else {\n                            //Case Insensitive\n                            //Do Nothing as of now\n                        }\n\n                        // sequence search matchscore\n                        /* At first iteration saving the keyword's original index position(searchArrayIndex) in keywords array with\n                        sequence id(searchArrayIndex). Onwords iterations, Checking if the sequence id exist in sequence array\n                        if not push again in sequence array if current word's previous id (searchArrayIndex-1) contains in sequence array,\n                        we are alloting match score. */\n                        if (QnASearch.data.sequence.length === 0 && termArr[i].toLowerCase() === builtData[vlu].word.toLowerCase()) {\n                            QnASearch.data.sequence.push(builtData[vlu].searchArrayIndex);\n                        } else {\n                            if ((QnASearch.data.sequence.indexOf((builtData[vlu].searchArrayIndex - 1)) > -1)) { // On every input \n                                matchScore *= QnASearch.settings.weightage.sequence;\n                            } else {\n                                QnASearch.data.sequence.push(builtData[vlu].searchArrayIndex);\n                            }\n                        }\n\n                        if (tempObj.length < 1) {\n                            tempObj.push({\n                                questionId: questionId,\n                                answerWordIndex: answerWordIndex,\n                                matchScore: matchScore\n                            });\n                        } else {\n                            var flag = false;\n                            for (var p = 0, pLen = tempObj.length; p < pLen; p++) {\n                                if (tempObj[p].questionId === questionId) {\n                                    tempObj[p].matchScore += parseInt(matchScore);\n                                    tempObj[p].answerWordIndex += ((tempObj[p].answerWordIndex).indexOf(answerWordIndex) > -1) ? '' : '|' +\n                                        answerWordIndex;\n                                    flag = true;\n                                }\n                            }\n                            if (!flag) {\n                                tempObj.push({\n                                    questionId: questionId,\n                                    answerWordIndex: answerWordIndex,\n                                    matchScore: matchScore\n                                });\n                            }\n\n                        }\n                    });\n\n                }\n            }\n        }\n        for (var d = 0, dlen = tempObj.length; d < dlen; d++) {\n            delete QnASearch.data.sDataJson[tempObj[d].questionId].wordOccurrence\n        }\n        QnASearch.data.sequence = QnASearch.generalFunction.wipeAnArray(QnASearch.data.sequence)\n        return tempObj;\n    },\n    processSearch: function(searchKeywords) {\n        var searchResultArr,\n            sortedSearchResult,\n            status,\n            builtData = QnASearch.data.builtData;\n\n        if (searchKeywords.length < 1) {\n            return false;\n        }\n\n        searchResultArr = QnASearch.getSearchResult(searchKeywords, builtData);\n\n        sortedSearchResult = searchResultArr.length && QnASearch.generalFunction.sortQuestionsAns(searchResultArr); //resultArr; \n\n        var searchResultJson = sortedSearchResult.length && QnASearch.searchResultJson(sortedSearchResult);\n        var dom = searchResultJson && QnASearch.domFunction.createHtml(searchResultJson);\n        isAppend = QnASearch.domFunction.appendDom(dom, searchKeywords);\n        QnASearch.domFunction.removeDom(isAppend, searchKeywords);\n        return dom;\n    },\n    domFunction: {\n        rsltStateMsg: function(msg) {\n            var askQstn = '\\<div class=\"\" style=\"display:block;text-align:center; margin-top: 30px; margin-bottom: 30px;\"> \\\n                <span class=\"rslt__state\" style=\"line-height: 20px; font-size:18px; margin-right: 15px;\"> ' + msg + '</span>\\\n                <div style=\"padding: 8px 36px\" class=\"bttn bttn--blue ask-qstn--wdgt js-ask-qstn--wdgt js-popup-trgt\" href=\"/review/qna/popup/ask_a_question.php?source=desktop_q_list&amp;mspid=' + $('.prdct-dtl__ttl').data('mspid') + '\">Ask a Question</div>\\\n            </div>';\n            return askQstn;\n        },\n        createHtml: function(jsonObj) {\n            var dom = '',\n                questionId,\n                questionIdNumeric,\n                answer = '',\n                answerCount;\n            for (id in jsonObj) {\n                questionId = jsonObj[id].q_id;\n                questionIdNumeric = (questionId).replace(/[^0-9]/g, ''),\n                    answerCount = jsonObj[id].answer.length\n                answer += ' <div class=\"qna__answr-wrpr\">';\n                if (answerCount > 0) {\n                    for (var i = 0; i < jsonObj[id].answer.length; i++) {\n                        answer += '<div class=\"qna__answr clearfix\" style=\"display:block\">' + jsonObj[id].answer[i] + '</div>';\n                    }\n                } else {\n                    //answer += '<div class=\"qna__answr clearfix\" style=\"display:block; opacity: 0.3;\">' + 'This question has no answer yet ' + '</div>';\n                    answer += '<div class=\"qna__answr clearfix\">' + '<span  style=\"opacity: 0.3;\">' + 'This question has no answer yet ' + '</span>' + '<span class=\"js-qna__rqst-answr qstn-answr__flw\" data-qid=\"' + questionIdNumeric + '\"><span class=\"flw__lbl js-flw__lbl\">Request Answer </span></span>' + '</div>';\n                }\n                answer += '</div>';\n                var tempDom = '<div class=\"qna__item js-qna__item clearfix\" data-qid=\"' + questionId + '\" data-ans-count=\"' + answerCount + '\">\\\n                   <a class=\"qna__item--href js-qna__item--href\" target=\"_blank\" href=\"/review/qna/redesign/single.php?ref=qna-search&q_id=' + questionIdNumeric + '\"> <div class=\"qna__qstn\">' + jsonObj[id].question + '</div>\\\n                       ' + answer + '\\\n                   </a></div>';\n\n                dom += tempDom;\n                answer = question = tempDom = '';\n            }\n            return dom;\n        },\n        removeDom: function(status, searchKeyword) {\n            var notFndText = QnASearch.domFunction.rsltStateMsg(\"No results found.\");\n            var pageType = [\"single\", \"qna_single\", \"qna_list\"];\n            if ((pageType.indexOf(dataLayer[0].pagetype)) >= 0) {\n                if (!status && searchKeyword) {\n                    $('.ldr__ovrly').remove();\n                    $('.qna__body--search').html(notFndText);\n                    $(\".qna > .js-open-link\").hide();\n                } else if (!status && !searchKeyword) {\n                    $('.ldr__ovrly, .js-ldr--stts').remove();\n                    $('.qna__body--search').html('');\n                    $('.qna__body').css('display', 'block');\n                    $(\".qna > .js-open-link\").show();\n                    $(\".js-qna__srch-kywrds\").show();\n\n\n                }\n                return true;\n            }\n            return false;\n        },\n        appendDom: function(dom, filteredSearchKeywords) {\n            var $qnaDiv;\n            var pageType = [\"single\", \"qna_single\", \"qna_list\"];\n            var firstResult = QnASearch.domFunction.rsltStateMsg(\"Didn't find what you're looking for? \");\n            if (dom) {\n                if ((pageType.indexOf(dataLayer[0].pagetype)) >= 0) {\n                    $qnaDiv = $('.qna__body--search');\n                    $('.ldr__ovrly, .qna__body').css('display', 'none');\n\n\n                }\n                $qnaDiv.append(dom);\n                QnASearch.generalFunction.highlightText($qnaDiv, filteredSearchKeywords);\n                $qnaDiv.prepend(firstResult);\n            } else {\n                return false;\n            }\n            return true;\n        },\n        loaderHandler: function() {\n            var pageType = [\"single\", \"qna_single\", \"qna_list\"];\n            if ((pageType.indexOf(dataLayer[0].pagetype)) >= 0) {\n\n                $('.qna__body').css('display', 'none'); // existing qna container\n                $('.qna__body--search').html(''); // wiping search result container for new results \n                $('.qna__body--search').append(QnASearch.domObject.$loader); // appending loader in search container untill processing\n                $('.ldr__ovrly').css({ // made loader visible\n                    'display': 'block',\n                });\n            }\n        }\n    },\n    searchResultJson: function(sortedSearchedInfo) {\n        var len = sortedSearchedInfo.length > QnASearch.settings.questionCount ? QnASearch.settings.questionCount : sortedSearchedInfo.length,\n            searchResultObj = {},\n            question,\n            matchScore,\n            questionId,\n            questionIdNumeric,\n            answer = [],\n            ansId;\n        for (var p = 0; p < len; p++) {\n            questionId = sortedSearchedInfo[p].questionId;\n            matchScore = sortedSearchedInfo[p].matchScore;\n            questionIdNumeric = (questionId).replace(/[^0-9]/g, '');\n            question = QnASearch.data.sDataJson[questionId].question;\n            var ansGroup = sortedSearchedInfo[p].answerWordIndex ? (sortedSearchedInfo[p].answerWordIndex).split('|') : 0;\n\n            ansGroupLength = ansGroup.length > QnASearch.settings.answerCount ? QnASearch.settings.answerCount : ansGroup.length;\n            for (var i = 0; i < ansGroupLength; i++) {\n                ansId = ansGroup[i] ? ansGroup[i].split('-') : '';\n                answer.push(QnASearch.data.sDataJson[questionId].answer[ansId[1]]);\n            }\n\n            searchResultObj[p] = {};\n            searchResultObj[p].question = question;\n            searchResultObj[p].answer = answer[0] === undefined ? [] : answer;\n            searchResultObj[p].q_id = questionId;\n            searchResultObj[p].matchScore = matchScore;\n            answer = []; // resetting the answer array for new object\n        }\n        return searchResultObj;\n    },\n    eventFunction: {\n        searchInput: function($this) {\n            var searchKeyword = $this.val().trim(),\n                filteredSearchKeywords;\n            filteredSearchKeywords = QnASearch.generalFunction.keywordCleaner(searchKeyword);\n            dom = QnASearch.processSearch(filteredSearchKeywords);\n\n        }\n    }\n};\n\n// QnA Search code\nvar timeout,\n    searchTrigger;\n$(document).on('input', QnASearch.settings.inputSelector(), function($jsonUrl) {\n    if (!QnASearch.settings.inputSelector()) {\n        return;\n    }\n    var $this = $(this);\n    if (QnASearch.data.searchWordsArr.length < 1) {\n        QnASearch.data.searchWordsArr = QnASearch.buildFunction.init(QnASearch.settings.qnaApi());\n    } else {\n        QnASearch.domFunction.loaderHandler();\n        clearTimeout(timeout);\n        timeout = setTimeout(function() {\n            QnASearch.eventFunction.searchInput($this);\n        }, 200);\n    }\n    if (window.ga && !searchTrigger) {\n        ga('send', 'event', 'QNA', 'search', QnASearch.settings.inputSelector());\n        searchTrigger = true;\n    }\n});\n\njQuery.fn.highlight = function(pat) {\n    function innerHighlight(node, pat) {\n        var skip = 0;\n        if (node.nodeType == 3) {\n            var pos = node.data.toUpperCase().indexOf(pat);\n            pos -= (node.data.substr(0, pos).toUpperCase().length - node.data.substr(0, pos).length);\n            if (pos >= 0) {\n                var spannode = document.createElement('span');\n                spannode.className = 'word__hglght--ylw';\n                var middlebit = node.splitText(pos);\n                var endbit = middlebit.splitText(pat.length);\n                var middleclone = middlebit.cloneNode(true);\n                spannode.appendChild(middleclone);\n                middlebit.parentNode.replaceChild(spannode, middlebit);\n                skip = 1;\n            }\n        } else if (node.nodeType == 1 && node.childNodes && !/(script|style)/i.test(node.tagName)) {\n            for (var i = 0; i < node.childNodes.length; ++i) {\n                i += innerHighlight(node.childNodes[i], pat);\n            }\n        }\n        return skip;\n    }\n    return this.length && pat && pat.length ? this.each(function() {\n        innerHighlight(this, pat.toUpperCase());\n    }) : this;\n};","var qnaScrolled = false,\n    recommScrolled = false,\n    visited;\n\nvar QnA = {\n    data: {\n        mspId: $('.js-prdct-ttl').data('mspid'),\n        leastAnsweredQuestionsList: [],\n        answeringSingleQuestion: false // Excludes reading of a single question (ONLY answering)\n    },\n    generalFunctions: {\n        randomInt: function(min, max) {\n            return Math.floor(Math.random() * (max - min + 1)) + min;\n        }\n\n    },\n\n    ajaxFunctions: {\n        submitQuestion: function(emailInput, quesInput, $successDiv) {\n            $.ajax({\n                url: \"/review/qna/submit_qna.php\",\n                data: {\n                    email: emailInput,\n                    question: quesInput,\n                    mspid: QnA.data.mspId,\n                    capture_point: document.referrer\n                }\n            }).done(function() {\n                $successDiv.slideDown();\n            });\n        },\n        submitAnswer: function(emailInput, ansInput, questionId) {\n            $.ajax({\n                url: \"/review/qna/submit_qna.php\",\n                data: {\n                    email: emailInput,\n                    answer: ansInput,\n                    mspid: QnA.data.mspId,\n                    questionId: questionId,\n                    capture_point: document.referrer\n                }\n            }).done(function() {\n                var $successDiv = $this.closest('.wrt-answr-form').find('.wrt-answr-form__sccss');\n                $successDiv.slideDown();\n\n                // Automatically go to the next question:\n                if (QnA.data.answeringSingleQuestion) {\n                    $successDiv.append(' | Loading Next Question ... ');\n                    setTimeout(function() {\n                        QnA.eventFunctions.gotoNextQuestion();\n                    }, 2000);\n                }\n            });\n        },\n\n        followQuestion: function($this) {\n            $.ajax({\n                url: \"/review/qna/submit_user_action.php\",\n                data: {\n                    entity_type: \"q\",\n                    email_id: Modules.Cookie.get('msp_login_email'),\n                    entity_id: questionId,\n                    action: type,\n                    source: \"desktop_\" + dataLayer[0].pagetype\n                }\n            }).done(function(response) {\n                $this.each(function(i, v) {\n                    $this = $(this);\n                    if ($this.closest('.js-qstn-answr').data(\"question-id\") == questionId) {\n                        var followCount = parseInt($this.find($(\".js-qstn-answr__flw__count\")).html());\n                        $this.data(\"followstate\", \"unfollow\");\n                        $this.find($(\".js-qstn-answr__flw__count\")).html(followCount + 1);\n\n                        $this.find($(\".js-flw__lbl\")).html(\"Answer Requested\");\n                        window.ga && ga('send', 'event', \"QNA\", \"click\", \"follow\");\n                        closePopup();\n                        return false;\n                    }\n                });\n            });\n\n        },\n        voteQuestion: function(questionId, type, $this) {\n            $.ajax({\n                url: \"/review/qna/submit_user_action.php\",\n                data: {\n                    entity_id: questionId,\n                    entity_type: 'q',\n                    email_id: Modules.Cookie.get('msp_login_email'),\n                    action: type,\n                    source: \"desktop_\" + dataLayer[0].pagetype\n                }\n            }).done(function(response) {\n                var $count = $this.closest('.qstn-vote').find('.vte-cnt');\n                if (response.count) {\n                    if (response.count > 0) {\n                        $count.removeClass('ngtv').addClass('pstv').text('+' + response.count);\n                    } else {\n                        $count.removeClass('pstv').addClass('ngtv').text('-' + response.count);\n                    }\n                } else {\n                    $count.removeClass('pstv ngtv').text(response.count);\n                }\n            });\n        },\n        voteAnswer: function(answerId, type, $this) {\n            //console.log(answerId);\n            $.ajax({\n                url: \"/review/qna/submit_user_action.php\",\n                data: {\n                    entity_id: answerId,\n                    entity_type: 'a',\n                    email_id: Modules.Cookie.get('msp_login_email'),\n                    action: type,\n                    source: \"desktop_\" + dataLayer[0].pagetype\n                }\n            }).done(function(response) {\n                if (type === 'upvote') {\n                    $this.text(response.likes);\n                } else {\n                    $this.text(response.dislikes);\n                }\n            });\n        }\n    },\n    eventFunctions: {\n        showQuestionForm: function($this) {\n            $this.closest('.ask-qstn').removeClass('collapse');\n        },\n        showAnswerForm: function($this) {\n            $this.slideUp();\n            $this.closest('.wrt-answr').find('.wrt-answr-form').slideDown();\n        },\n        upvoteQuestion: function($this) {\n            if ($this.hasClass('js-is-active-vote')) {\n                return;\n            }\n            var questionId = $this.closest('.qstn-answr').data('question-id') || $this.closest('.qna__item').data('question-id'),\n                upvoteCount = parseInt($this.find(\".vte-cnt\").html());\n            $this.addClass('clckd-vte js-is-active-vote').find(\".vte-cnt\").html(upvoteCount + 1);\n\n            QnA.ajaxFunctions.voteQuestion(questionId, 'upvote', $this);\n        },\n        downvoteQuestion: function($this) {\n            if ($this.hasClass('js-is-active-vote')) {\n                return;\n            }\n            var questionId = $this.closest('.qstn-answr').data('question-id');\n            $this.addClass('clckd-vte js-is-active-vote')\n                .closest('.qstn-vote')\n                .find('.upvt')\n                .removeClass('clckd-vte js-is-active-vote');\n            QnA.ajaxFunctions.voteQuestion(questionId, 'downvote', $this);\n        },\n\n        followQuestion: function($this) {\n            var $this = $this;\n            var followCount = parseInt($this.find($(\".js-qstn-answr__flw__count\")).html());\n            var questionId = $this.closest(\".js-qstn-answr\").data('question-id');\n            if ($this.data(\"followstate\") == \"unfollow\") {\n                return;\n            }\n            if ($this.data(\"followstate\") == \"follow\") {\n\n                openPopup('/review/qna/popup/request_answer.php?source=desktop_q_list&q_id=' + questionId);\n            } else {\n                $this.data(\"followstate\", \"follow\");\n                $this.find($(\".js-qstn-answr__flw__count\")).html(followCount - 1);\n\n                $this.find($(\".js-flw__lbl\")).html(\"Request Answer\");\n                window.ga && ga('send', 'event', \"QNA\", \"click\", \"unfollow\");\n                QnA.ajaxFunctions.followQuestion(questionId, \"unfollow\", $this);\n            }\n        },\n        upvoteAnswer: function($this) {\n            if ($this.hasClass('js-is-active-vote')) {\n                return;\n            }\n            var answerId = $this.closest('.qna__answr').data('answerid') || $this.closest('.user-answrs__answr').data('answerid');\n            $this.addClass('clckd-vte js-is-active-vote')\n                .closest('.answr-vote')\n                .find('.dwnvt')\n                .removeClass('clckd-vte js-is-active-vote');\n            $this.closest(\".answr-vote\").removeClass(\"answr-vote\");\n            $this.html(\"Marked Helpful (\" + (parseInt($this.find(\".upvt-cnt\").html()) + 1) + \")\"); // Increasing the count when user clicks\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"upVote\");\n            QnA.ajaxFunctions.voteAnswer(answerId, 'upvote', $this);\n        },\n        downvoteAnswer: function($this) {\n            if ($this.hasClass('js-is-active-vote')) {\n                return;\n            }\n            var answerId = $this.closest('.user-answrs__answr').data('answerid');\n            console.log(answerId);\n            $this.addClass('clckd-vte js-is-active-vote')\n                .closest('.answr-vote')\n                .find('.upvt')\n                .removeClass('clckd-vte js-is-active-vote');\n            $this.html(parseInt($this.find(\".upvt-cnt\").html()) + 1); // decreasing the count when user clicks\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"downVote\");\n            // QnA.ajaxFunctions.voteAnswer(answerId, 'dislike', $this); \n        },\n        viewAllAnswers: function($this) {\n            var questionId = $this.closest('.qstn-answr').data('question-id');\n            window.location.hash = 'ans-qstn-' + questionId;\n        },\n        gotoNextQuestion: function($this) { // `$this` is an optional parameter (NOT applicable when next question is AUTOMATICALLY loaded)\n            if (!QnA.data.leastAnsweredQuestionsList[0]) {\n                if ($this) {\n                    $this.closest('.answr-next-qstn').text('No more questions');\n                }\n                return;\n            }\n            var questionId = QnA.data.leastAnsweredQuestionsList[0].questionId,\n                hash = window.location.hash;\n            if (/hide-ans/.test(hash)) {\n                window.location.hash = 'ans-qstn-hide-ans-' + questionId;\n            } else {\n                window.location.hash = 'ans-qstn-' + questionId;\n            }\n            QnA.data.leastAnsweredQuestionsList.shift();\n        }\n    },\n    inputHandler: {\n        email: function(emailInput, $emailError) {\n            var regex = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n            if (!regex.test(emailInput)) {\n                $emailError.slideDown();\n                return false;\n            }\n            return true;\n        },\n        text: function(textInput, $textError) {\n            var regex = /^[a-z\\d\\-_\\s?]+$/i;\n            if (!regex.test(textInput) || textInput.length < 2) {\n                $textError.slideDown();\n                return false;\n            }\n            return true\n        }\n    },\n    prefillEmail: function() {\n        if (Modules.Cookie.get) {\n            $('input[type=email]').val(Modules.Cookie.get('msp_login_email'));\n        }\n    },\n    setEmailCookie: function(emailInput) {\n        if (!Modules.Cookie.get('msp_login_email')) {\n            setCookie(\"msp_login_email\", emailInput, 365);\n        }\n    },\n    hashHandler: function(hash) {\n        var id;\n        if (hash.length) {\n            /*\n            if ( /ask-qstn/.test(hash)) {\n                $('.ask-qstn').removeClass('collapse');\n                $('.js-user-answrs').addClass('all-shwn'); // show question and its answers as one\n                $('.js-user-answrs, .js-qstn-answr').show(); // Show all the AnswerQues + UserAns divs\n                $('.js-qstn-answr .js-wrt-answr__ttl').show(); // show button/link to open an answer form\n                $('.js-qstn-answr .js-wrt-answr-form').hide(); // hide the answer forms themselves\n                QnA.data.answeringSingleQuestion = false;\n            } else if ( /read-qstn/.test(hash)) {\n                id = hash.split('-').pop(); // Fetch Question ID from hash \n                $('.js-user-answrs').removeClass('all-shwn'); // Do not club a question close to its answers\n                QnA.data.answeringSingleQuestion = false;\n                $('.js-ask-qstn__btn').closest('.ask-qstn').addClass('collapse'); // Hide ask question form\n                $('.js-user-answrs, .js-qstn-answr').hide(); // Hide all the AnswerQues + UserAns divs\n                $('.js-qstn-answr[data-question-id=' + id + ']').show(); // show only required AnswerQues\n                $('.js-user-answrs[data-question-id=' + id + ']').show(); // show only required UserAns\n            } else if ( /ans-qstn/.test(hash)) {\n                id = hash.split('-').pop(); // Fetch Question ID from hash \n                $('.js-user-answrs').removeClass('all-shwn'); // Do not club a question close to its answers\n                QnA.data.answeringSingleQuestion = true;\n                $('.js-ask-qstn__btn').closest('.ask-qstn').addClass('collapse'); // Hide ask question form\n                $('.js-user-answrs, .js-qstn-answr').hide(); // Hide all the AnswerQues + UserAns divs\n                $('.js-qstn-answr[data-question-id=' + id + '] .js-wrt-answr__ttl').hide(); // show only required AnswerQues\n                $('.js-qstn-answr[data-question-id=' + id + '], .js-qstn-answr[data-question-id=' + id + '] .js-wrt-answr-form').show(); // show only required AnswerQues and AnswerForm\n                $('.answr-next-qstn').show(); // Display option to answer other questions\n                if (!/hide-ans/.test(hash)) {\n                    $('.js-dsply-answrs').hide();\n                    $('.js-user-answrs[data-question-id=' + id + ']').show(); // show all the UserAns divs for that question if 'hide-ans' is not in hash\n                } else {\n                    $('.js-dsply-answrs').show();\n                }\n            } else \n            */\n            if (/ans-qstn/.test(hash)) {\n                var q_id = $(\".wrt-answr__ttl\").data(\"qid\");\n                (Modules.Cookie.get('msp_uid') % 2) ?\n                openPopup(\"/review/qna/popup/answer_question.php?source=desktop_q_single&q_id=\" + q_id):\n                    openPopup(\"/review/qna/popup/fb_answer_question.php?source=desktop_q_single&q_id=\" + q_id);\n                //openPopup(\"/review/qna/popup/answer_question.php?source=desktop_q_single&q_id=\"+q_id);\n                $(\".popup-overlay\") && $(\".popup-overlay\").addClass(\"noclose\");\n                $(\".popup-closebutton\").on(\"click\", function() {\n                    //window.location.hash = '';\n                });\n            }\n        } else {\n            /*\n            // No hash condition: (Show all questions and answers):\n            QnA.data.answeringSingleQuestion = false;\n            $('.js-user-answrs').addClass('all-shwn'); // show question and its answers as one\n            $('.js-user-answrs, .js-qstn-answr').show(); // Show all the AnswerQues + UserAns divs\n            $('.js-qstn-answr .js-wrt-answr__ttl').show(); // show button/link to open an answer form\n            $('.js-qstn-answr .js-wrt-answr-form').hide(); // hide the answer forms themselves\n            */\n        }\n    },\n    addAndSortQuestions: function() { // sorts questions on page from least answered to most answered.\n        // Should be called on load to fetch all questions for a product at one time.\n        // MUST BE CALLED after hashHandler() function.\n        var hash = window.location.hash,\n            id = false;\n        if (QnA.data.answeringSingleQuestion) {\n            id = +hash.split('-').pop();\n        }\n        $('.qstn-answr').each(function() {\n            var questionId = +$(this).data('question-id'),\n                answerCount = $('.user-answrs[data-question-id=' + questionId + '] .user-answrs__answr').length;\n            // If currently viewing one particular question, \n            // Do not add it to the list of least answered questions (We don't want to see it again).\n            if (id !== questionId) {\n                QnA.data.leastAnsweredQuestionsList.push({\n                    questionId: questionId,\n                    numAnswers: answerCount\n                });\n            }\n        });\n        QnA.data.leastAnsweredQuestionsList.sort(function(q1, q2) {\n            return q1.numAnswers - q2.numAnswers;\n        });\n    },\n    init: function() {\n        /* Initial Hash Trigger (On Load): */\n        QnA.hashHandler(window.location.hash);\n        /* Make a list of all questions and sort them (ONE time operation - on load) */\n        QnA.addAndSortQuestions(); // MUST COME AFTER hashHandler function (on load).\n\n        /* Hash change on user action: */\n        $(window).on('hashchange', function() {\n            QnA.hashHandler(window.location.hash);\n        });\n\n        /* Prefill data functions: */\n        QnA.prefillEmail();\n\n        /* Puting random numbers in upvote, downvote and follow */\n        $(\".upvt\").each(function(index) {\n            //fetching numbers from backend for now.\n            //$(this).html(QnA.generalFunctions.randomInt(20, 40));\n            //$($(\".dwnvt\")[index]).html(QnA.generalFunctions.randomInt(0, 20));\n            //$($(\".js-qstn-answr__flw__count\")[index]).html(QnA.generalFunctions.randomInt(10, 100));\n\n        });\n\n        /* Event Handlers for showing/hiding: */\n        $('.js-ask-qstn__btn').on('click', function(e) {\n            e.preventDefault();\n            //QnA.eventFunctions.showQuestionForm($(this));\n\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"ask-qstn\");\n        });\n\n        $(\".js-qstn-answr__flw\").on('click', function() {\n            QnA.eventFunctions.followQuestion($(this));\n        });\n\n        $('.js-wrt-answr__ttl').on('click', function() {\n            //QnA.eventFunctions.showAnswerForm($(this));\n\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"write-ans\");\n        });\n\n        $('.js-dsply-answrs').on('click', function(e) {\n            e.preventDefault();\n            QnA.eventFunctions.viewAllAnswers($(this));\n        });\n\n        $('.js-next-qstn-link').on('click', function(e) {\n            e.preventDefault();\n            QnA.eventFunctions.gotoNextQuestion($(this));\n        });\n\n        /* Form submit & Ajax handlers: */\n        $(\".js-ask-qstn__submit\").on(\"click\", function(e) {\n            e.preventDefault();\n            var emailInput = $('.ask-qstn-form__ttl').val(),\n                $emailError = $('.ask-qstn__ttl-err'),\n                quesInput = $('.ask-qstn-form__desc').val(),\n                $quesError = $('.ask-qstn-form__desc-err'),\n                $successDiv = $('.ask-qstn__scs');\n\n            if (!QnA.inputHandler.email(emailInput, $emailError) ||\n                !QnA.inputHandler.text(quesInput, $quesError)) {\n                return;\n            }\n            QnA.setEmailCookie(emailInput);\n            QnA.ajaxFunctions.submitQuestion(emailInput, quesInput, $successDiv);\n        });\n\n        $('.js-wrt-answr-form__sbmt').on('click', function(e) {\n            e.preventDefault();\n            var $this = $(this),\n                emailInput = $this.closest('.wrt-answr-form').find('.wrt-answr-form__eml').val(),\n                $emailError = $this.closest('.wrt-answr-form').find('.wrt-answr-form__eml-error').slideDown(),\n                ansInput = $this.closest('.wrt-answr-form').find('.wrt-answr-form__desc').val(),\n                $ansError = $this.closest('.wrt-answr-form').find('.wrt-answr-form__desc-error').slideDown(),\n                questionId = $this.closest('.qstn-answr').data('question-id');\n\n            if (!QnA.inputHandler.email(emailInput, $emailError) ||\n                !QnA.inputHandler.text(ansInput, $ansError)) {\n                return;\n            }\n            QnA.setEmailCookie(emailInput);\n            QnA.ajaxFunctions.submitAnswer(emailInput, ansInput, questionId);\n        });\n\n        $(\".js-qsnt-upvt\").on('click', function() {\n            QnA.eventFunctions.upvoteQuestion($(this));\n        });\n        $('.qstn-vote .upvt').on('click', function() {\n            QnA.eventFunctions.upvoteQuestion($(this));\n        });\n        $('.qstn-vote .dwnvt').on('click', function() {\n            QnA.eventFunctions.downvoteQuestion($(this));\n        });\n\n        $('.answr-vote .upvt').on('click', function() {\n            QnA.eventFunctions.upvoteAnswer($(this));\n        });\n        $('.answr-vote .dwnvt').on('click', function() {\n            QnA.eventFunctions.downvoteAnswer($(this));\n        });\n\n        $(\".js-ask-qstn__view-all-qstn--href\").on(\"click\", function() {\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"read-more-questions\");\n        });\n        //View all ques btn on single page\n        $(\".ask-qstn__view-all-qstn__inr\").on(\"click\", function() {\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"viewall-ques-goto-list\");\n        });\n        //Back to product link\n        $(\".ask-qstn__rtrn--href\").on(\"click\", function() {\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"back-to-pdp\");\n        });\n    }\n};\n\n$(document).ready(function() {\n    /* Initialize QnA Page functionality: */\n    QnA.init();\n\n    Modules.$doc.on(\"click\", \".js-user-answr__more-answr\", function() {\n        var state = $(this).data(\"state\"),\n            question_id = $(this).parents(\".js-user-answrs\").data(\"question-id\"),\n            answers_count = $(this).parents(\".js-qstn-answr\").data(\"ans-count\"),\n            moreAnswr = \"More Answers (\" + (parseInt(answers_count, 10) - 1) + \")\";\n        if (state === \"collapsed\") {\n            $(this).text(\"Collapse Answers\").data(\"state\", \"opened\");\n            if (parseInt(answers_count) > 10)\n                $(this).before('<a class=\"user-answr__all-answrs js-all-answrs\" href=\"single.php?q_id=' + question_id + '\" target=\"_blank\">Show all answers (' + answers_count + ')</a>');\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"read-more-answers\");\n        } else {\n\n            $(this).text(moreAnswr).data(\"state\", \"collapsed\");\n            // $(this).parent().find(\".js-answr-qstn\").remove();\n            $(this).parent().find(\".js-all-answrs\").remove();\n            window.ga && ga('send', 'event', \"QNA\", \"click\", \"collapse-more-answers\");\n        }\n        $(this).toggleClass(\"qna__more-answr--opnd\");\n        $(this).parent().parent().find(\".user-answrs__answr\").toggleClass(\"user-answrs__answr--show\");\n    });\n\n    Modules.$doc.on(\"submit\", \".js-ask-qstn__frm\", function() {\n        $(\".js-ask-qstn\").click();\n        return false;\n    });\n\n    $(\".js-qstn-txt\").on(\"focus\", function() {\n        $(\".qna__ask-wrpr, .ask-qstn__ask-wrpr\").css(\"border-color\", \"#999\");\n    }).on(\"blur\", function() {\n        $(\".qna__ask-wrpr, .ask-qstn__ask-wrpr\").css(\"border-color\", \"#bbb\");\n    });\n});\n\n$('body').on('click', '.js-ask-qstn', function(e) {\n    if (!validInput(e)) {\n        return false;\n    }\n});\n\nModules.$doc.on(\"keyup\", \".js-qstn-txt\", function() {\n    console.log($(this).val().length);\n    var queryLength = $(this).val().length;\n    $(\".qna__ask-wrpr\").removeClass(\"qna__ask-wrpr-err\");\n    $(\".qna__ask-wrpr-msg\").hide();\n    $(\".js-qna__srch-kywrds\").show();\n    $(\".ask-qstn__ask-wrpr\").removeClass(\"ask-qstn__ask-wrpr-err\");\n    $(\".ask-qstn__ask-wrpr-msg\").hide();\n});\n\n//If header is scrollable then dont hide the subheader\nModules.$win.scroll(Modules.throttle(function(e) {\n    var scrollTop = Modules.$win.scrollTop(),\n        delta = 5,\n        $subHeader = $('.sub-hdr'),\n        $header = $('.hdr'),\n        subHeaderHeight = $subHeader.outerHeight(),\n        footerOffset = $($(\".ftr\")[0]).offset().top,\n        $adSidebar = $('.ad-sdbr'),\n        sidebarHeight = $adSidebar.height() + 40;\n\n    if (footerOffset < (sidebarHeight + scrollTop) && !visited) {\n        var pos = footerOffset - 620;\n        $adSidebar.css(\"position\", \"absolute\").css(\"top\", pos + \"px\");\n        visited = true;\n    } else if (footerOffset > (sidebarHeight + scrollTop) && visited) {\n        $adSidebar.css(\"position\", \"fixed\").css(\"top\", \"20px\");\n        visited = false;\n    } else if (footerOffset > (sidebarHeight + scrollTop)) {\n        if ($header.height() > scrollTop) {\n            $adSidebar.css(\"position\", \"absolute\").css(\"top\", \"120px\");\n        } else {\n            $adSidebar.css(\"position\", \"fixed\").css(\"top\", \"20px\");\n        }\n    }\n\n    // QnA Scrolling Event\n    if ($('.qna').length > 0) {\n        if (scrollTop >= $('.qna').position().top && !qnaScrolled) {\n            ga('send', 'event', 'QNA', 'qna-scroll', \"\", {\n                nonInteraction: true\n            });\n            qnaScrolled = true;\n        }\n    }\n\n    // Recommendations Scrolling Event\n    if ($('#recomm').length > 0) {\n        if (scrollTop >= $('#recomm').position().top && !recommScrolled) {\n            ga('send', 'event', 'recommendations', 'scrollTo', \"\", {\n                nonInteraction: true\n            });\n            recommScrolled = true;\n        }\n    }\n\n    // Hide Menu on Scroll\n    if ($('.drpdwn-menu-ovrly--show').length) {\n        $('.js-ctgry-btn').click(); //if browse menu is displayed close it  \n    }\n    if (!$header.hasClass(\"hdr--scrl\")) {\n\n        if (scrollTop <= 0) {\n            $subHeader.removeClass('not-vsbl');\n            if ($(\".lead-hdr-wrpr\").length && !Modules.Cookie.get(\"msp_lead_hdr_hide\")) {\n                $(\".lead-hdr-wrpr\").slideDown();\n            }\n            return;\n        }\n        if (Math.abs(lastScrollTop - scrollTop) <= delta) return;\n\n        if (scrollTop > lastScrollTop && scrollTop > subHeaderHeight) {\n            // Scroll Down\n            $header.addClass('hdr--sld');\n            $subHeader.addClass('not-vsbl');\n            if ($(\".lead-hdr-wrpr\").length && !Modules.Cookie.get(\"msp_lead_hdr_hide\")) {\n                $(\".lead-hdr-wrpr\").slideUp();\n            }\n            $(\".ad-sdbr\").addClass(\"ad-sdbr--top\");\n        } else {\n            // Scroll Up\n            if (scrollTop + Modules.$win.height() < Modules.$doc.height()) {\n                $subHeader.removeClass('not-vsbl');\n                $header.removeClass('hdr--sld');\n                $(\".ad-sdbr\").removeClass(\"ad-sdbr--top\");\n                if ($(\".lead-hdr-wrpr\").length && !Modules.Cookie.get(\"msp_lead_hdr_hide\")) {\n                    $(\".lead-hdr-wrpr\").slideDown();\n                }\n            }\n        }\n\n        lastScrollTop = scrollTop;\n    }\n\n    //Run tasks assigned to Lazy Load which run when scroll position hits the corresponding nodes.\n    Modules.lazyLoad.run();\n}, 100));\n/* RUI:: reveal new subheader when user scrolls - end */\n\n\n//When coming for answer ackg email to asker.Clicks on say thanks btn.\nif (url.getAQueryParam && url.getAQueryParam('ref') === \"email\") {\n    openPopup(\"/review/qna/popup/thankyou.html\");\n}\n\nfunction validInput(e) {\n    var searchText = $('.js-qstn-txt').val().length;\n    if (!searchText) {\n        $(\".qna__ask-wrpr\").addClass(\"qna__ask-wrpr-err\");\n        $(\".js-qna__srch-kywrds\").hide();\n        $(\".qna__ask-wrpr-msg\").show();\n        $(\".ask-qstn__ask-wrpr\").addClass(\"ask-qstn__ask-wrpr-err\");\n        $(\".ask-qstn__ask-wrpr-msg\").show();\n        return false;\n    } else {\n        return true;\n    }\n}\n\nfunction validInput(e) {\n    var searchText = $('.js-qstn-txt').val().length; \n    if (!searchText) {\n        \n        $(\".qna__ask-wrpr\").addClass(\"qna__ask-wrpr-err\");\n        $(\".js-qna__srch-kywrds\").hide();\n    $(\".qna__ask-wrpr-msg\").show();\n    return false;\n    } else {\n        return true;\n    }\n}\n\nModules.$doc.on(\"focus\", \".js-qstn-txt\", function () {\n   \n    if (window.ga) {\n        ga('send', 'event', 'QNA', 'focus', 'search-input');\n    }\n});\n\nModules.$doc.one(\"click\", \".js-qna__srch-kywrd\", function() {\n    if(window.QnASearch) {\n        QnASearch.data.searchWordsArr = QnASearch.buildFunction.init(QnASearch.settings.qnaApi());\n    }\n});\n\nModules.$doc.on(\"click\", \".js-qna__srch-kywrd\", function() {\n    window.ga && ga('send', 'event', 'qna', 'click', 'qna-suggested-search');\n    $('.js-qstn-txt').val($(this).text()).trigger('input');\n});\n\nModules.$doc.on(\"click\", \".js-more-answr\", function () {\n    var state = $(this).data(\"state\"),\n        question_id = $(this).parents(\".qna__item\").data(\"qid\") || $(this).parents(\".qna__item\").data(\"question-id\"),\n        answers_count = $(this).parents(\".qna__item\").data(\"ans-count\");\n    if(state===\"collapsed\"){\n        $(this).text(\"Collapse Answers\").data(\"state\",\"opened\");\n        if(parseInt(answers_count) > 5)\n            $(this).before('<a class=\"qna__all-answrs js-all-answrs\" href=\"/qna/single/?q_id='+ question_id +'\" target=\"_blank\">Show all answers ('+ answers_count +')</a>');\n    } else {\n        var moreAnswr = \"More Answers (\" + ( parseInt(answers_count,10) -1 ) + \")\";\n        $(this).text(moreAnswr).data(\"state\",\"collapsed\");\n        $(this).parent().find(\".js-all-answrs\").remove();\n    }\n    $(this).toggleClass(\"qna__more-answr--opnd\");\n    $(this).parent().find(\".qna__answr\").toggleClass(\"qna__answr--show\");\n    $(this).parent().find(\".qna__answr-upvt\").toggleClass(\"hide\");\n});\n\n\nModules.$doc.off('.qns__frm').on(\"submit\", \".qna__frm\", function (e) {\n    if (!validInput(e)) {\n        return false;\n    }\n    $(\".js-ask-qstn\").click();\n    return false;   \n});\n\n$('body').on('click' , '.js-ask-qstn' , function (e) {\n    if (!validInput(e)) {\n        return false;\n    }\n})\n\nModules.$doc.on(\"click\", \".js-qna-bbl\", function(){\n    $(this).hide();\n});\n\nModules.$doc.on(\"click\", \".js-ask-qstn__submit\", function (e) {\n    e.preventDefault();\n    var emailInput = $(\".ask-qstn-form__ttl\").val(),\n        quesInput = $(\".ask-qstn-form__desc\").val(),\n        email = /^(([^<>()[\\]\\.,;:\\s@\"]+(\\.[^<>()[\\]\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\n        text = /^[a-z\\d\\-_\\s?]+$/i;\n    if (!email.test(emailInput)) {\n        $(\".ask-qstn__ttl-err\").slideDown();\n        return false;\n    }\n    if (!text.test(quesInput) || quesInput.length < 20) {\n        $(\".ask-qstn-form__desc-err\").slideDown();\n        return false;\n    }\n    $.ajax({\n        \"url\": \"/review/qna/submit_qna.php\",\n        \"data\": {\n            \"email\": emailInput,\n            \"question\": quesInput,\n            \"mspid\": PriceTable.dataPoints.mspid\n        }\n    }).done(function () {\n        $(\".ask-qstn__scs\").slideDown();\n    });\n    return false;\n});\n\n$(document).on(\"click\", \".js-qna__rqst-answr\", function(e) {\n    $this = $(this);\n    e.preventDefault();\n    e.stopPropagation();\n    var questionId = $(this).data(\"qid\");\n    if ($this.data(\"followstate\") == \"unfollow\") {\n        return;\n    } else {\n        $this.addClass('js-qna__rqst-answr-actv');\n    }\n    openPopup('/review/qna/popup/request_answer.php?source=desktop_q_list&q_id=' + questionId);\n});\n\nModules.$doc.on(\"focus\", \".js-qstn-txt\", function() {\n    if (window.ga) {\n        ga('send', 'event', 'QNA', 'focus', 'search-input');\n    }\n});","function storeProductInfo() {\n    var url = document.URL;\n    if (dataLayer[0].url !== undefined && (url.indexOf('-msp') > -1 || url.indexOf('-msf') > -1 || url.indexOf('products') > -1 || url.indexOf('-dealid') > -1)) {\n        var productInfo = {\n            title: dataLayer[0].title,\n            image: dataLayer[0].image,\n            price: dataLayer[0][\"min-price\"],\n            url: dataLayer[0].url,\n            mspid: dataLayer[0].mspid,\n            productType: dataLayer[0][\"product-type\"],\n            timeStamp: Date.now()\n        }\n        if (window.indexedDB) {\n            var request = window.indexedDB.open(\"userDb\", 1);\n            request.onupgradeneeded = function(event) {\n                var db = event.target.result;\n                // Create an objectStore for this database\n                if (!db.objectStoreNames.contains(\"recentlyViewed\")) {\n                    var objectStore = db.createObjectStore(\"recentlyViewed\", { autoIncrement: true });\n                    objectStore.createIndex(\"url\", \"url\", { unique: true });\n                    objectStore.createIndex(\"timeStamp\", \"timeStamp\", { unique: false });\n                }\n            };\n            request.onerror = function(event) {\n                // Do something with request.errorCode!\n                console.log(\"error on indexdb open\");\n            };\n            request.onsuccess = function(event) {\n                db = event.target.result;\n                var transaction = db.transaction([\"recentlyViewed\"], \"readwrite\");\n                var store = transaction.objectStore(\"recentlyViewed\");\n                var myIndex = store.index('url');\n                var getKeyRequest = myIndex.getKey(productInfo.url);\n                getKeyRequest.onsuccess = function(event) {\n                    var key = getKeyRequest.result;\n                    if (key === undefined) {\n                        store.put(productInfo);\n                    } else {\n                        var getRequest = store.get(key);\n                        getRequest.onsuccess = function(event) {\n                            var oldPrice = getRequest.result.price;\n                            var newPrice = productInfo.price;\n                            var lastVisited = new Date(getRequest.result.timeStamp).toDateString();\n                            if (lastVisited == new Date().toDateString()) {\n                                lastVisited = '';\n                            } else {\n                                lastVisited = ' on ' + lastVisited;\n                            }\n                            if (oldPrice > newPrice && oldPrice != '0' && newPrice != '0') {\n                                var priceDiff = ((oldPrice - newPrice) * 100 / oldPrice).toFixed(1);\n                                var priceText = \"Price dropped by \" + priceDiff + \"% since your last visit\" + lastVisited;\n                                var eventAction = 'Dropped';\n                            } else if (oldPrice < newPrice && oldPrice != '0' && newPrice != '0') {\n                                var priceDiff = ((newPrice - oldPrice) * 100 / oldPrice).toFixed(1);\n                                var priceText = \"Price increased by \" + priceDiff + \"% since your last visit\" + lastVisited;\n                                var eventAction = 'Increased';\n                            } else if (oldPrice = newPrice && oldPrice != '0' && newPrice != '0') {\n                                var priceDiff = 0;\n                                var priceText = \"Price remained same since your last visit\" + lastVisited;\n                                var eventAction = 'Remainedsame';\n                            }\n                            //disabled by mallik\n                            if (false && priceText !== undefined) {\n                                var priceDiffHtml = \"<div class='prdct-dtl__str-ftrs'><span class='prdct-dtl__str-ftr prdct-dtl__str-ftr--hghlght'>\" + priceText + \"</span>  </div>\";\n                                $(\".prdct-dtl__str-dtls\").append(priceDiffHtml);\n                                ga('send', 'event', 'pricetool', eventAction, getRequest.result.mspid, priceDiff);\n                            }\n                            store.put(productInfo, key);\n                        }\n                    }\n                }\n                var countRequest = store.count();\n                countRequest.onsuccess = function() {\n                    if (countRequest.result > 20) {\n                        delCount = countRequest.result - 20;\n                        store.index(\"timeStamp\").openCursor().onsuccess = function(event) {\n                            var cursor = event.target.result;\n                            if (cursor && delCount > 0) {\n                                delCount--;\n                                console.log(delCount);\n                                store.delete(cursor.primaryKey);\n                                cursor.continue();\n                            }\n                        };\n                    }\n                }\n            };\n        }\n    }\n}\n\nfunction fillRecentlyViewedSection() {\n    var isDealPage = window.location.pathname === \"/deals/\" ? true : false;\n\n    if (window.indexedDB) {\n        var request = indexedDB.open(\"userDb\", 1);\n        request.onupgradeneeded = function(event) {\n            var thisDB = event.target.result;\n\n            // Create an objectStore for this database\n            if (!thisDB.objectStoreNames.contains(\"recentlyViewed\")) {\n                var objectStore = thisDB.createObjectStore(\"recentlyViewed\", { autoIncrement: true });\n                objectStore.createIndex(\"url\", \"url\", { unique: true });\n                objectStore.createIndex(\"timeStamp\", \"timeStamp\", { unique: false });\n            }\n        };\n        request.onerror = function(event) {\n            // Do something with request.errorCode!\n            console.log(\"error on indexdb open\");\n        };\n        request.onsuccess = function(event) {\n            db = event.target.result;\n            var transaction = db.transaction([\"recentlyViewed\"], \"readonly\");\n            var objectStore = transaction.objectStore(\"recentlyViewed\");\n            var cursor = objectStore.index(\"timeStamp\").openCursor(null, \"prev\");\n            var startHtml = '<div class=\"sctn\" id=\"rcntly_vwd\" data-slideitem=\"prdct-item\" data-slideitemwrprper=\"sctn__inr\"><div class=\"sctn__hdr clearfix\"><div class=\"sctn__ttl\">You Recently Viewed</div><div class=\"sctn__nvgtn\"></div></div><div class=\"sctn__inr prdct-grid clearfix\">';\n            var snippet = '<div class=\"prdct-item\" data-mspid=\"--mspid--\"><div class=\"prdct-item__save-btn js-save-btn\"></div><a class=\"prdct-item__img-wrpr\" href=\"--url--\"><img class=\"prdct-item__img\" src=\"https://assets.mspcdn.net/w_70/logos/mysmartprice/owl/lazy.png\" data-lazy-src=\"--image--\" alt=\"--alttitle--\"></a><div class=\"prdct-item__dtls\"><a class=\"prdct-item__name\" href=\"--hrefurl--\">--title--</a><div class=\"prdct-item__prc\"><span class=\"prdct-item__rpe\">--priceSym--</span><span class=\"prdct-item__prc-val\">--price--</span></div></div></div>';\n            var endHtml = '</div></div>';\n            var rvCount = 0;\n            cursor.onsuccess = function(e) {\n                var res = e.target.result;\n                console.log(res);\n                if (rvCount == 5) {\n                    res = null;\n                }\n                if (res) {\n                    newSnippet = snippet;\n                    var price = res.value.price,\n                        productType = res.value.productType;\n\n                    if ((isDealPage && productType == \"deals\") || (!isDealPage && productType != \"deals\")) {\n                        price = price.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n                        var priceSym = '';\n                        if (price == '0') {\n                            var priceSym = '';\n                            price = 'Not Available';\n                        }\n                        newSnippet = newSnippet.replace('--url--', res.value.url + '?ref=rv').replace('--title--', res.value.title).replace('--image--', res.value.image).replace('--price--', price).replace('--mspid--', res.value.mspid).replace('--alttitle--', res.value.title).replace('--hrefurl--', res.value.url).replace('--priceSym--', priceSym);\n                        rvCount++;\n                        startHtml += newSnippet;\n                    }\n\n                    res.continue();\n\n                } else {\n                    if (rvCount > 0) {\n                        startHtml += endHtml;\n                        if ($('.spnsr-cntnt').length) {\n                            $('.spnsr-cntnt').before(startHtml);\n                        } else {\n                            $('.main-wrpr').append(startHtml);\n                        }\n                        lazyLoadImages();\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Function to store current viewed item to indexed db\nstoreProductInfo();\n\n$(document).ready(function() {\n    if (window.location.pathname == '/' || window.location.pathname == '/deals/') {\n        fillRecentlyViewedSection();\n    }\n});","// expert review page gallery js\nModules.$doc.on(\"click\", \"#exprt-rvw__prvw .exprt-rvw__glry-img\", function(e) {\n  if(!$(this).parent().hasClass(\"exprt-rvw__glry-thmbnl\")) {\n    return;\n  }\n  var $imageGalleryThumbnail = $(this).closest(\".exprt-rvw__glry-thmbnl\"),\n    imageLeftCoordinate = $(this).offset().left,\n    imageRightCoordinate = $(this).width() + imageLeftCoordinate,\n    firstImageLeftCoordinate = $imageGalleryThumbnail.find(\".exprt-rvw__glry-img:first\").offset().left,\n    parentLeftCoordinate = $imageGalleryThumbnail.offset().left,\n    parentWidth = $imageGalleryThumbnail.width() + 15,\n    imageGallery = $(this).closest(\".exprt-rvw__glry\");\n\n  $(imageGallery).find(\".exprt-rvw__glry-img-active\").removeClass(\"exprt-rvw__glry-img-active\");\n  $(this).addClass(\"exprt-rvw__glry-img-active\");\n  $(imageGallery).find(\".exprt-rvw__glry-main-img\").attr(\"src\", $(this).data(\"image-src\"))\n\n    $(imageGallery).find(\".exprt-rvw__glry-cntr\").html(($(this).data(\"image-index\") + 1) + \" of \" + ($(imageGallery).find(\"img\").length - 1));\n    $(imageGallery).find(\".exprt-rvw__glry-main-img\").data(\"href\", \"/mobile/review_image_popup.php?image_url=\" + encodeURIComponent($(this).data(\"image-src\")));\n    $(imageGallery).find(\".exprt-rvw__glry-main-img\").data(\"image-index\", $(this).data(\"image-index\"));\n\n  // scroll image if not visible\n  if (imageRightCoordinate > parentLeftCoordinate + parentWidth) {\n    $imageGalleryThumbnail.animate({\n      scrollLeft: imageRightCoordinate - (firstImageLeftCoordinate + parentWidth) + 40\n    }, \"fast\");\n  }\n  else if (imageLeftCoordinate < parentLeftCoordinate) {\n    $imageGalleryThumbnail.animate({\n      scrollLeft: firstImageLeftCoordinate - imageLeftCoordinate\n    }, \"fast\");\n  }\n});\n\n// expert review page gallery js\nModules.$doc.on(\"click\", \"#exprt-rvw__prvw .zoom-viewer__arrow\", function(e) {\n    var imageGallery = $(this).closest(\".exprt-rvw__glry\"),\n      currentImageIndex = $(imageGallery).find(\".exprt-rvw__glry-main-img\").data(\"image-index\"),\n      newImageElement = null;\n\n    currentImageIndex = currentImageIndex !== undefined ? parseInt(currentImageIndex, 10) : 0;\n\n    currentImageIndex = $(this).hasClass(\"zoom-viewer__arrow--prev\") ? currentImageIndex - 1 : currentImageIndex + 1;\n\n    if(currentImageIndex > $(imageGallery).find(\"img\").length - 2)\n      currentImageIndex = 0;\n\n    if(currentImageIndex < 0)\n      currentImageIndex = $(imageGallery).find(\"img\").length - 2;\n\n    newImageElement = $(imageGallery).find(\".exprt-rvw__glry-img[data-image-index='\"+ currentImageIndex +\"']\");\n    $(newImageElement).click();\n  });\n\n//Show video on click of thumbnail - Start\n$(\".exprt-rvw__vid-play\").on(\"click\", function(e) {\n    var $playNode = $(this);\n    $imageNode = $playNode.siblings(\".exprt-rvw__vid-img\"),\n        $container = $playNode.parent(),\n        height = $container.height(),\n        width = $container.width(),\n        videoId = $imageNode.data(\"video-id\");\n\n    $imageNode.remove();\n    $playNode.remove();\n    $container.append('<iframe class=\"exprt-rvw__vid-iframe\" width=\"' + width + '\" height=\"' + height + '\" src=\"//www.youtube.com/embed/' + videoId + '?rel=0&autoplay=1\" frameborder=\"0\" allowfullscreen></iframe>');\n});\n//Show video on click of thumbnail - End","Modules.$doc.ready(function() {\n    if ($(\".usr-rvw-form--sngl\").length) {\n\n        // this class is being added from php\n        // if the msp uid is even\n        if ($(\".usr-rvw-form__ttl-wrpr-vsbl\").length > 0) {\n            window.ga && ga('send', 'event', \"user-review\", \"landing\", \"title-visible\");\n        } else {\n            window.ga && ga('send', 'event', \"user-review\", \"landing\", \"title-hidden\");\n        }\n\n        var ratingWidth = $(\".usr-rvw-form__rtng-wrpr .rtng-star\").width(),\n            $ratingInr = $(\".usr-rvw-form__rtng-wrpr .rtng-star__inr\"),\n            $ratingRemark = $(\".usr-rvw-form__rtng-rmrk\"),\n            remarksList = $ratingRemark.data(\"remarks\").split(\",\"),\n            $ratingInput = $(\".usr-rvw-form__rtng-inpt\");\n        isUserDetailsDisplayed = false;\n\n        if (url.getAQueryParam && url.getAQueryParam('rating')) {\n            var inrWidth = parseInt(url.getAQueryParam('rating')) * 20,\n                rating = parseInt(url.getAQueryParam('rating')) || 1,\n                remarks = [\"Terrible\", \"Bad\", \"Average\", \"Good\", \"Excellent\"];\n\n            $ratingRemark.data(\"remark\", remarks[rating - 1]);\n            $ratingInput.val(rating);\n            $ratingInr.data(\"width\", inrWidth).addClass(\"rtng-star__inr--rated\");\n            $ratingInr.width((rating * 20) + \"%\");\n            $ratingRemark.text(remarks[rating - 1]);\n\n            setTimeout(function() {\n                $(\".usr-rvw-form__desc-wrpr\").slideDown(\"fast\");\n                $(\".usr-rvw-form__submit\").slideDown(\"fast\");\n            }, 500)\n            // enlargeCompressRating(false);\n        }\n\n        Modules.$doc.on(\"keyup\", \".js-usr-rvw__desc\", function(e) {\n            if (e.target.value.trim().length > 0) {\n                if ($(\".usr-rvw-form__ttl-wrpr-vsbl\").length === 0) {\n                    $(this).closest(\".usr-rvw-form--sngl\").find(\".usr-rvw-form__ttl-wrpr\").slideDown(\"fast\");\n                }\n                // enlargeCompressRating(false);\n            } else {\n                if ($(\".usr-rvw-form__ttl-wrpr-vsbl\").length === 0) {\n                    $(this).closest(\".usr-rvw-form--sngl\").find(\".usr-rvw-form__ttl-wrpr\").slideUp(\"fast\");\n                }\n                // enlargeCompressRating(true);\n            }\n        });\n\n        Modules.$doc.on(\"mousemove\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function(e) {\n            var offsetX = parseInt(e.pageX - $(this).offset().left, 10),\n                rating = Math.ceil((offsetX / ratingWidth) * 5) || 1;\n\n            $ratingRemark.text(remarksList[rating - 1]);\n            if (offsetX <= ratingWidth) {\n                $ratingInr.width((rating * 20) + \"%\");\n            }\n        });\n\n        Modules.$doc.on(\"click\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function() {\n            var inrWidth = $ratingInr.width(),\n                rating = Math.ceil((inrWidth / ratingWidth) * 5) || 1;\n\n            $ratingRemark.data(\"remark\", $ratingRemark.text());\n            $ratingInput.val(rating);\n            $ratingInr.data(\"width\", inrWidth).addClass(\"rtng-star__inr--rated\");\n\n            $(\".usr-rvw-form__desc-wrpr\").slideDown(\"fast\");\n            $(\".usr-rvw-form__submit\").slideDown(\"fast\");\n\n            // enlargeCompressRating(false);\n        });\n\n        Modules.$doc.on(\"mouseleave\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function() {\n            if ($ratingInr.hasClass(\"rtng-star__inr--rated\")) {\n                $ratingRemark.text($ratingRemark.data(\"remark\"));\n                $ratingInr.width($ratingInr.data(\"width\"));\n            } else {\n                $ratingInr.width(0);\n                $ratingRemark.empty();\n            }\n        });\n\n        Modules.$doc.on(\"submit\", \".usr-rvw-form--sngl\", function() {\n            MSP.utils.validate.form([{\n                \"type\": \"rating\",\n                \"inputField\": $(\".usr-rvw-form__rtng-inpt\"),\n                \"errorNode\": $(\".usr-rvw-form__rtng-err\")\n            }, {\n                \"type\": \"text\",\n                \"inputField\": $(\".usr-rvw-form__ttl\"),\n                \"errorNode\": $(\".usr-rvw-form__ttl-err\"),\n                \"options\": { \"min\": 1 }\n            }, {\n                \"type\": \"required\",\n                \"inputField\": $(\".usr-rvw-form__desc\"),\n                \"errorNode\": $(\".usr-rvw-form__desc-err\"),\n                \"options\": { \"min\": 1 }\n            }]).done(function() {\n                var rating = $(\".usr-rvw-form__rtng-inpt\").val(),\n                    title = $(\".usr-rvw-form__ttl\").val(),\n                    details = $(\".usr-rvw-form__desc\").val(),\n                    errorMessage = \"There was a problem submitting your review. Please try again.\",\n                    email_id = \"\",\n                    mspLoginEmail = Modules.Cookie.get(\"msp_login_email\");\n\n                if (false && Modules.Cookie.get(\"msp_login_email\") && Modules.Cookie.get(\"msp_login\")) {\n                    var submit_api = \"/msp/review/save_a_review.php\";\n                } else {\n                    var submit_api = \"/msp/review/save_review_basic.php\";\n                }\n\n                // 1st priority: User Email Query String\n                if (url.getAQueryParam && url.getAQueryParam('user')) {\n                    try {\n                        email_id = atob(url.getAQueryParam('user')); // throws error if unsuccessful\n                        doAjax(true);\n                    } catch (e) {\n                        // Error in reading QS email: (Check for email cookie instead first)\n                        if (mspLoginEmail) {\n                            email_id = mspLoginEmail;\n                            doAjax(true);\n                        } else {\n                            loginFetchEmail.call(this);\n                        }\n                    }\n                } else if (mspLoginEmail) { // 2nd priority: MSP Login Email Cookie\n                    email_id = mspLoginEmail;\n                    doAjax(true);\n                } else {\n                    loginFetchEmail.call(this);\n                }\n\n                /*******************/\n\n                function loginFetchEmail() {\n                    loginCallback(doAjax, this, [false]);\n                }\n\n                function doAjax(qsEmailExists) {\n                    if (!qsEmailExists) email_id = Modules.Cookie.get('msp_login_email');\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: submit_api,\n                        data: {\n                            \"mspid\": url.getAQueryParam('mspid'),\n                            \"title\": title,\n                            \"details\": details,\n                            \"rating_review\": rating,\n                            \"email_id\": email_id,\n                            \"source\": 'desktop'\n                        }\n                    }).done(function(response) {\n                        response = JSON.parse(response);\n                        if (response.success == 1) {\n                            $(\".sctn__hdr\").hide();\n                            $(\".usr-rvw-prdct\").addClass(\"usr-rvw-prdct__scs\");\n                            $(\".usr-rvw-form--sngl\").hide();\n                            $(\".usr-rvw-form__wrpr\").hide();\n                            $(\".usr-wrt-rvw__scs\").fadeIn();\n                            $(\".usr-rvw-form\").data(\"submitted\", true);\n                            $(\".usr-wrt-rvw__scs-desc\").after($(\".usr-rvw-form--sngl\").html());\n                            $(\".usr-rvw-form__rtng-lbl\").text(\"You rated\");\n\n                            if ($(\".usr-rvw-form__ttl-wrpr-vsbl\").length > 0) {\n                                window.ga && ga('send', 'event', \"user-review\", \"submit\", \"title-visible\");\n                            } else {\n                                window.ga && ga('send', 'event', \"user-review\", \"submit\", \"title-hidden\");\n                            }\n\n                        } else {\n                            alert(errorMessage);\n                        }\n                    }).fail(function() {\n                        alert(errorMessage);\n                    });\n                }\n            });\n            return false;\n        });\n\n        function enlargeCompressRating(enlargeCompress) {\n            if (enlargeCompress) {\n                $(\".usr-rvw-prdct\").addClass(\"usr-rvw-prdct--xl\");\n                $ratingInr.width($ratingInr.width() * 2);\n            } else {\n                $(\".usr-rvw-prdct\").removeClass(\"usr-rvw-prdct--xl\");\n                $ratingInr.width($ratingInr.width() / 2);\n            }\n\n            ratingWidth = $(\".usr-rvw-form__rtng-wrpr .rtng-star\").width();\n        }\n    }\n});\n\n;\n(function() {\n    if (!$(\".usr-wrt-rvw\").length) {\n        return;\n    }\n    var ratingWidth = $(\".usr-rvw-form__rtng-wrpr .rtng-star\").width(),\n        $ratingInr = $(\".usr-rvw-form__rtng-wrpr .rtng-star__inr\"),\n        $ratingRemark = $(\".usr-rvw-form__rtng-rmrk\"),\n        remarksList = $ratingRemark.data(\"remarks\").split(\",\"),\n        $ratingInput = $(\".usr-rvw-form__rtng-inpt\");\n    isUserDetailsDisplayed = false;\n\n    if (Modules.Cookie.get(\"msp_login\") === \"1\") {\n        $(\".usr-rvw-form__dtls-img\").attr(\"src\", Modules.Cookie.get(\"msp_user_image\"));\n        $(\".usr-rvw-form__dtls-name\").text(Modules.Cookie.get(\"msp_login_name\") || \"MySmartPrice User\");\n        $(\".usr-rvw-form__dtls-email\").text(Modules.Cookie.get(\"msp_login_email\"));\n        $(\".usr-rvw-form__dtls\").show();\n        isUserDetailsDisplayed = true;\n    }\n\n    Modules.$doc.on(\"mousemove\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function(e) {\n        var offsetX = parseInt(e.pageX - $(this).offset().left, 10),\n            rating = Math.ceil((offsetX / ratingWidth) * 5) || 1;\n\n        $ratingRemark.text(remarksList[rating - 1]);\n        if (offsetX <= ratingWidth) {\n            $ratingInr.width((rating * 20) + \"%\");\n        }\n    });\n\n    Modules.$doc.on(\"click\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function() {\n        var inrWidth = $ratingInr.width(),\n            rating = Math.ceil((inrWidth / ratingWidth) * 5) || 1;\n\n        $ratingRemark.data(\"remark\", $ratingRemark.text());\n        $ratingInput.val(rating);\n        $ratingInr.data(\"width\", inrWidth).addClass(\"rtng-star__inr--rated\");\n    });\n\n    Modules.$doc.on(\"mouseleave\", \".usr-rvw-form__rtng-wrpr .rtng-star\", function() {\n        if ($ratingInr.hasClass(\"rtng-star__inr--rated\")) {\n            $ratingRemark.text($ratingRemark.data(\"remark\"));\n            $ratingInr.width($ratingInr.data(\"width\"));\n        } else {\n            $ratingInr.width(0);\n            $ratingRemark.empty();\n        }\n    });\n\n    Modules.$doc.on(\"click\", \".js-usr-rvw-item-more\", function() {\n        $(this).hide();\n        $(this).closest(\".usr-rvw-item__text\").find(\".usr-rvw-item__text-hide\").fadeIn();\n    });\n\n    Modules.$doc.on(\"submit\", \".usr-rvw-form\", function() {\n        loginCallback(function() {\n            MSP.utils.validate.form([{\n                \"type\": \"rating\",\n                \"inputField\": $(\".usr-rvw-form__rtng-inpt\"),\n                \"errorNode\": $(\".usr-rvw-form__rtng-err\")\n            }, {\n                \"type\": \"text\",\n                \"inputField\": $(\".usr-rvw-form__ttl\"),\n                \"errorNode\": $(\".usr-rvw-form__ttl-err\"),\n                \"options\": { \"min\": 20 }\n            }, {\n                \"type\": \"required\",\n                \"inputField\": $(\".usr-rvw-form__desc\"),\n                \"errorNode\": $(\".usr-rvw-form__desc-err\"),\n                \"options\": { \"min\": 100 }\n            }]).done(function() {\n                var rating = $(\".usr-rvw-form__rtng-inpt\").val(),\n                    title = $(\".usr-rvw-form__ttl\").val(),\n                    details = $(\".usr-rvw-form__desc\").val(),\n                    errorMessage = \"There was a problem submitting your review. Please try again.\";\n\n                $.ajax({\n                    type: \"POST\",\n                    url: \"/msp/review/save_a_review.php\",\n                    data: {\n                        \"mspid\": PriceTable.dataPoints.mspid,\n                        \"title\": title,\n                        \"details\": details,\n                        \"rating_review\": rating,\n                        \"email_id\": Modules.Cookie.get(\"msp_login_email\")\n                    }\n                }).done(function(response) {\n                    response = JSON.parse(response);\n                    if (response.success == 1) {\n                        $(\".usr-rvw-form\").hide();\n                        $(\".usr-wrt-rvw__scs\").fadeIn();\n                        $(\".usr-rvw-form\").data(\"submitted\", true);\n                    } else {\n                        alert(errorMessage);\n                    }\n                }).fail(function() {\n                    alert(errorMessage);\n                });\n            });\n        });\n        return false;\n    });\n\n\n    // Refer https://developer.mozilla.org/en-US/docs/Web/Events/beforeunload#Example\n    window.onbeforeunload = function(e) {\n        var message = \"You have not finished submitting your review.\";\n        if (!$(\".usr-rvw-form\").data(\"submitted\") && $.trim($(\".usr-rvw-form__desc\").val()).length) {\n            (e || window.event).returnValue = message; // Gecko + IE\n            return message; // Gecko + Webkit, Safari, Chrome etc.\n        }\n    }\n}());\n\nModules.$doc.on(\"click\", \".js-usr-rvw-vote-up, .js-usr-rvw-vote-down\", (function() {\n    // private voteReview function that is declared on load.\n    function voteReview(voteButton) {\n        var reviewId = voteButton.closest(\".usr-rvw__bttm__rvw\").data(\"review-id\"),\n            mspid = PriceTable.dataPoints.mspid,\n            vote = voteButton.hasClass(\"js-usr-rvw-vote-up\") ? 1 : -1,\n            parentEl = voteButton.closest('.usr-rvw__bttm__rvw-vote'),\n            hasVoted = parentEl.find('span').hasClass('done');\n        if(!hasVoted) {\n            $.post(\"/msp/review/post_vote.php\", {\n                reviewid: reviewId,\n                mspid: mspid,\n                vote: vote\n            });\n\n            var otherVoteButton = parentEl.find('span:not(.text-link)').not(voteButton),\n                reportSpamLink = parentEl.find('.js-usr-rvw-rprt-spam');\n            otherVoteButton.removeClass('done');\n            voteButton.text(Number(voteButton.text()) + 1).addClass('done');\n            reportSpamLink.remove();\n        }\n    }\n\n    // click handler function that runs evertime user clicks.\n    return function() {\n        loginCallback(voteReview, this, [$(this)]);\n        return false;\n    }\n})());","/* Search Function/Feature */\nModules.$doc.on(\"submit\", \".js-srch-wdgt__frm\", function() {\n    var srch_inpt = $(\".js-hdr-srch\").val();\n    var search_type = '';\n    if ($('.js-srch-wdgt__frm .search_type').val()) {\n        search_type = $('.js-srch-wdgt__frm .search_type').val();\n    }\n    var typed_term = '';\n    if ($('.js-srch-wdgt__frm .typed_term').val()) {\n        typed_term = $('.js-srch-wdgt__frm .typed_term').val();\n    }\n    var srch_url = '/msp/search/search.php?search_type=' + search_type + '&typed_term=' + typed_term +\n        '&s=' + srch_inpt + '#s=' + srch_inpt;\n    $('.js-srch-wdgt__frm').attr('action', srch_url);\n});\n\n\nModules.$doc.on(\"focus\", \".srch-wdgt__fld\", function() {\n    $(this).autocomplete(\"search\");\n});\n// autocomplete processing end here\n","init(); // Save #pages visited, session start time, and active time.\ncountPages(); // Initially count the number of pages visited by user\n\nfunction init() {\n    if (!Modules.Cookie.get(\"visit_num_pages\")) {\n        Modules.Cookie.set(\"visit_num_pages\", 1);\n    } else {\n        Modules.Cookie.set(\"visit_num_pages\", (parseInt(Modules.Cookie.get(\"visit_num_pages\")) + 1));\n    }\n\n    if (!Modules.Cookie.get(\"session-start-time\")) {\n        Modules.Cookie.set(\"session-start-time\", new Date().getTime());\n    }\n    Modules.Cookie.set(\"active_time\", ((new Date().getTime()) - Modules.Cookie.get(\"session-start-time\")) / 1000);\n}\n\n/* Count no. of pages visited by user: */\nfunction countPages() {\n    var number = Modules.Cookie.get(\"num_pages\");\n    if (!number) number = 1;\n    else number = parseInt(number, 10) + 1;\n    Modules.Cookie.set(\"num_pages\", number, \"7d\");\n}\n\nfunction validUID() {\n    var UID = Modules.Cookie.get(\"msp_uid\");\n    var URL = \"/api/transacting_uid_popup.php\";\n\n    var dfd = $.Deferred();\n    $.ajax({\n        \"url\": URL,\n        \"type\": \"GET\",\n        \"data\": {\n            uid: UID\n        }\n    }).done(function(response) {\n        dfd.resolve(response);\n    });\n    return dfd.promise();\n}","$(\".list-best__vdo\").on(\"click\", function(e) {\n    //Params to work with NC\n    var videoUrl = $(this).data(\"video-id\");\n    //Params for Comp redesigned popup\n    var offset_media_key = $(this).data(\"media_key\");\n    var offset_media_position = $(this).data(\"media_position\");\n    var mspid = $(this).closest(\".list-best__item\").data(\"mspid\");\n    var query = [\n        'mspid=' + mspid,\n        'offset_media_key=' + offset_media_key,\n        'offset_position=' + offset_media_position,\n        /*Params to work with old popup in NC*/\n        'primaryThumb=' + $(\".list-best__img\").data(\"image\"),\n        'maxThumbs=' + 0,\n        'thumbId=' + $(\".list-best__img\").data(\"thumb-id\"),\n        'videoUrl=' + videoUrl\n    ].join(\"&\");\n    var images_popup = $(\".list-best__vdo\").data(\"href\");\n    openPopup(\"http://www.mysmartprice.com/mobile/\" + images_popup + \"?\" + query);\n});\n\n/* Open video in popup on clicking thumbnail */\nfunction loadVideoReviews() {\n    var videosIdList      = [],\n        videosInfoObj     = {},\n        $allVideoElements = $('.js-yt-vdo'),\n        $featuredVideo    = $('.js-yt-vdo__ftrd'),\n        $otherVideosList  = $('.js-vdo-list');\n\n    if($allVideoElements.length) {\n        $allVideoElements.each(pushToVideosIdList);\n        ajaxVideosAndUpdateUI();\n    }\n\n    /*****************/\n    function pushToVideosIdList(idx, vdo)  {\n        var id = $(vdo).data('yt-vdo-id');\n        videosIdList.push(id);\n    }\n    function ajaxVideosAndUpdateUI() {\n        $.ajax({\n            url: 'https://www.googleapis.com/youtube/v3/videos',\n            data: {\n                part: 'snippet, contentDetails',\n                id: videosIdList.join(),\n                key: 'AIzaSyCJrzy0GTt2WfQF8jMVCfXHIhHIOLz2luQ'\n            }\n        }).done(function(response) {\n            prepareVideosInfoObj(response);\n            MakefeaturedVideo($featuredVideo);\n            ListOtherVideos($otherVideosList);\n        });\n    }\n    function prepareVideosInfoObj(response) {\n        if(response && response.items) {\n            response.items.forEach(function(item, idx) {\n                var snippet        = item.snippet,\n                    contentDetails = item.contentDetails;\n\n                videosInfoObj[ videosIdList[idx] ] = {\n                    id          : videosIdList[idx],\n                    publishedAt : snippet.publishedAt,\n                    thumbnails  : snippet.thumbnails,\n                    title       : snippet.title,\n                    duration    : contentDetails.duration\n                };\n            });\n        }\n    }\n    function MakefeaturedVideo($featuredVideo) {\n        if($featuredVideo.length) {\n            var firstVideo  = videosInfoObj[ videosIdList[0] ],\n                id          = $featuredVideo.data('yt-vdo-id'),\n                $thumb      = $featuredVideo.find('.js-thumb'),\n                $duration   = $featuredVideo.find('.js-duration'),\n                $playButton = $featuredVideo.find('.js-play'),\n                $title      = $featuredVideo.find('.js-title');\n\n            if($thumb.length) {\n                $thumb.attr('src', firstVideo.thumbnails.medium.url);\n            }\n            if($duration.length) {\n                $duration.text(decodeDuration(firstVideo.duration));\n            }\n            if($title) {\n                $title.text(firstVideo.title);\n            }\n\n            $thumb.on('click', loadIframe);\n            $playButton.on('click', loadIframe);\n        }\n\n        /**************/\n        function loadIframe(e) {\n            var frameHTML = [\n                '<iframe id=\"vdo-rvw__ftrd__plyr\" type=\"text/html\" width=\"426\" height=\"240\" ',\n                'src=\"https://www.youtube.com/embed/' + firstVideo.id + '?autoplay=1\" frameborder=\"0\" allowfullscreen></iframe>'\n            ].join('');\n            $featuredVideo.html(frameHTML);\n            return false;\n        }\n    }\n    function ListOtherVideos($otherVideosList) {\n        if($otherVideosList.length) {\n            $otherVideosList.find('.js-yt-vdo').each(function(idx, vdo) {\n                var videoId      = $(vdo).data('yt-vdo-id'),\n                    $thumb       = $(vdo).find('.js-thumb'),\n                    $duration    = $(vdo).find('.js-duration'),\n                    $title       = $(vdo).find('.js-title'),\n                    $date        = $(vdo).find('.js-date'),\n                    videoDetails = videosInfoObj[videoId];\n\n                if(videoDetails) {\n                    $(vdo).data('videolink', 'https://www.youtube.com/embed/' + videoId + '?autoplay=1');\n                    $thumb.attr('src', videoDetails.thumbnails.medium.url);\n                    $duration.text(decodeDuration(videoDetails.duration));\n                    $title.text(videoDetails.title);\n                    $date.text(formatDate(videoDetails.publishedAt));\n                }\n                $(vdo).on('click', openVideo);\n            });\n        }\n\n        /*****************/\n        function openVideo(e) {\n            var popupParams = {\n                    mspid            : $('.prdct-dtl__ttl').data('mspid'),\n                    offset_media_key : 'customerReviewVideos',\n                    offset_position  : $('.js-yt-vdo').index(this),\n                    offset_video     : $('.js-yt-vdo').index(this)\n                };\n            openPopup('/mobile/multiple_media_popup.php?' + $.param(popupParams));\n            return false;\n        }\n    }\n    function decodeDuration(duration) {\n        // Duration format: \"PTxxHxxMxxS\".\n        // xxH (or xH) and xxM (or xM) are included only hours and minutes exist.\n        // xxS could also be just xS.\n        if(duration) {\n            var hours   = duration.match(/(\\d+)H/) || '',\n                minutes = duration.match(/(\\d+)M/) || '',\n                seconds = duration.match(/(\\d+)S/) || '';\n\n            if(hours) {\n                hours = (hours[1].length === 1) ? ('0' + hours[1] + ':') : (hours[1] + ':');\n            }\n            if(minutes) {\n                minutes = (minutes[1].length === 1) ? ('0' + minutes[1] + ':') : (minutes[1] + ':');\n            }\n            if(seconds) {\n                seconds = (seconds[1].length === 1) ? ('0' + seconds[1]) : seconds[1];\n            }\n\n            return hours + minutes + seconds;\n        } else {\n            return '';\n        }\n    }\n    function formatDate(dateString) {\n        if(dateString) {\n            try {\n                var publishDate = new Date(dateString),\n                    months = ['Jan', 'Feb', 'March', 'April', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];\n                return months[publishDate.getMonth()] + ' ' + publishDate.getDate() + ', ' + publishDate.getFullYear();\n            } catch(e) {\n                console.error('Error', e); // Log error but do not throw it (return empty string, fail silently)\n                return '';\n            }\n        }\n    }\n}\n/* End video review popup */\n\n/* Lazy load video reviews section: */\n(function lazyLoadVideoReviews() {\n    var $videoReview = $('.vdo-rvw-sctn');\n    if($videoReview.length) {\n        Modules.lazyLoad.assign({\n            \"node\": $videoReview,\n            \"callback\": {\n                \"definition\": loadVideoReviews,\n                \"context\": this,\n                \"arguments\": []\n            }\n        });\n        Modules.lazyLoad.run();\n    }\n})();\n/* End lazyload of video review section */","bindAutoComplete(); // Initializing the autoComplete\ninitScrollToTop(); // Scroll to page top\n\nModules.$doc.on(\"click\", \".js-copy\", handleCopyText);\nModules.$doc.on(\"click\", \".js-send-email\", handleSendEmail);\n\n/* ************** 4. Functions: ************** */\n\nfunction handleCopyText() {\n    $this = $(this);\n    copyText($this, function(){\n        $this.text(\"COPIED\").removeClass(\"bttn--blue\").addClass(\"bttn--grn\");\n    }, function(){\n        //Do something when copying is not supported by browser\n    })\n}\n\nfunction handleSendEmail(){\n    var address = $(this).data(\"address\"),\n        subject = $(this).data(\"subject\"),\n        body = $(this).data(\"body\"),\n        strMail = 'mailto:' + encodeURIComponent(address) + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);\n\n    window.open(strMail, \"_blank\");\n}\n\nfunction bindAutoComplete() {\n    var $searchBox = $(\".srch-wdgt\"),\n        $searchField = $searchBox.find(\".js-atcmplt\");\n    if ($searchField.length) {\n        var autocompleteObj = $searchField.autocomplete({\n            minLength: 0,\n            delay: 110,\n            autoFocus: false,\n            max: 10,\n            open: function(event, ui) {\n                $(\".ui-menu\").css({\n                    \"width\": $searchBox.width(),\n                    \"left\": \"-1px\",\n                    \"top\": \"1px\",\n                    \"clear\": \"both\"\n                });\n                $searchBox.addClass(\"srch-wdgt--show-rslt\");\n            },\n            close: function(event, ui) {\n                $searchBox.removeClass(\"srch-wdgt--show-rslt\");\n            },\n            source: function(request, response) {\n                request.term = $.trim(request.term).toLowerCase();\n                if (request.term.length < 3)\n                    request.term = \"_top_\";\n                var _cache = bindAutoComplete._cache_ = bindAutoComplete._cache_ || { \"keys\": [], \"values\": [] },\n                    keyIndex = _cache.keys.indexOf(request.term);\n                if (keyIndex > -1) {\n                    response(_cache.values[keyIndex]);\n                    return;\n                }\n                $.ajax({\n                    \"url\": \"/msp/search/auto_suggest_search.php\",\n                    \"dataType\": \"json\",\n                    \"data\": request\n                }).done(function(json) {\n                    if (!json) {\n                        response([]);\n                        return;\n                    }\n                    var results = [];\n                    if (json.subcategories && json.subcategories.length)\n                        $.merge(results, json.subcategories);\n                    if (json.terms && json.terms.length)\n                        $.merge(results, json.terms);\n                    if (json.products && json.products.length)\n                        $.merge(results, json.products);\n                    if (!results.length) {\n                        response([]);\n                        return;\n                    }\n                    _cache.keys.push(request.term);\n                    _cache.values.push(results);\n                    if (_cache.keys.length > 25) {\n                        _cache.keys.shift();\n                        _cache.values.shift();\n                    }\n                    response(results);\n                }).fail(function() {\n                    response([]);\n                });\n            },\n            select: function(event, ui) {\n                if (ui.item.url) {\n                    var pageUrl = window.location.href.split(\"#\"),\n                        searchUrl = ui.item.url.split(\"#\");\n                    if (pageUrl[0] === searchUrl[0]) {\n                        if (pageUrl[1] !== searchUrl[1]) {\n                            // Same path, different hashes; update URL and force-refresh\n                            window.location.href = ui.item.url;\n                            window.location.reload();\n                        } else\n                            window.location.reload(); // Identical URLs, just reload\n                    } else\n                        window.location.href = ui.item.url; // Different paths, just update URL\n                } else {\n                    $(this).parent().find('.search_type').val('auto');\n                    var typed_term = $(this).val();\n                    $(this).parent().find('.typed_term').val(typed_term);\n                    $(this).val(ui.item.value).closest(\"form\").submit();\n                }\n            }\n        }).data(\"ui-autocomplete\");\n\n        autocompleteObj._renderItem = function(ul, item) {\n            var term = this.term.split(\" \").join(\"|\"),\n                regEx = new RegExp(\"\\\\b(\" + term + \")\", \"gi\"),\n                innerHtml = item.value.replace(regEx, \"<strong>$1</strong>\"),\n                $listItem = $(\"<li>\").data(\"item.autocomplete\", item);\n            if (item.subcategory) {\n                innerHtml += \" in <span style='font-weight: bold; color: #c00;'>\" + item.subcategory + \"</span>\";\n                $listItem.addClass(\"subcategory-item\");\n            } else if (item.image) {\n                innerHtml = \"<span class='image'><img src='\" + item.image + \"' alt='\" + item.value + \"'/></span>\" + innerHtml;\n                $listItem.addClass(\"product-item\");\n            } else\n                $listItem.addClass(\"string-item\");\n            innerHtml = \"<a>\" + innerHtml + \"</a>\";\n            return $listItem.append(innerHtml).appendTo(ul);\n        };\n\n        autocompleteObj._renderMenu = function(ul, items) {\n            var that = this;\n            $.each(items, function(index, item) {\n                that._renderItemData(ul, item);\n            });\n\n            var $ul = $(ul);\n            $ul.find(\".string-item\").first().not(\":first-child\").before(\"<li class='separator-item'><span>Popular terms</span></li>\");\n            $ul.find(\".product-item\").first().before(\"<li class='separator-item'><span>Popular products</span></li>\");\n        };\n    }\n}\n\n/* RUI:: scroll to top button functionality - start */\nfunction initScrollToTop() {\n    var $body = $('body'),\n        toTopHtml = [\n            \"<div class='to-top'>\",\n            \"<div class='to-top__btn js-lazy-bg'></div>\",\n            \"<div class='to-top__lbl'>Back to top</div>\",\n            \"</div>\"\n        ].join(\"\"),\n        $toTop = $(toTopHtml),\n        showScrollToTopDisplay = 'hidden';\n\n    $body.append($toTop);\n\n    $toTop.on(\"click\", function() {\n        $body.animate({\n            'scrollTop': '0'\n        }, 'slow', function() {\n            showScrollToTopDisplay = 'hidden';\n        });\n        $toTop.stop(true, true).fadeOut();\n    });\n\n    Modules.$win.on(\"scroll\", function() {\n        if ($(this).scrollTop() > 100) {\n            if (showScrollToTopDisplay == 'hidden') {\n                showScrollToTopDisplay = 'display';\n                $toTop.stop(true, true).fadeIn();\n            }\n        } else {\n            if (showScrollToTopDisplay == 'display') {\n                showScrollToTopDisplay = 'hidden';\n                $toTop.stop(true, true).fadeOut();\n            }\n        }\n    });\n}\n\nfunction copyText($selector, successCallback, failCallback) {\n    var text = $selector.data(\"text\");\n    $('body').append(\"<input class='js-temp-txt' value=\" + text + \" />\");\n    $(\".js-temp-txt\").select();\n    try {\n        document.execCommand('copy');\n        successCallback();\n    } catch (e) {\n        failCallback(e);\n    }\n}\n\n\n\nfunction handleSendEmail() {\n    var address = $(this).data(\"address\"),\n        subject = $(this).data(\"subject\"),\n        body = $(this).data(\"body\"),\n        cc = $(this).data(\"cc\"),\n        strMail = 'https://mail.google.com/mail/?view=cm&fs=1&su=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body) + '&cc=' + encodeURIComponent(cc);\n    window.open(strMail, \"_blank\");\n}","if ($(\".body-wrpr\").length !== 0) { /* Enable new (RUI) scroll functionality */\n    scrollToSectionNoAnimation();\n} else { /* OLD::inpageLinking (Backward Compatibility) */\n    Modules.$win.on('hashchange', handleHashChange);\n    Modules.$doc.on('click', 'a[href^=\"#\"]', handleAnchorLinkClick);\n    Modules.$win.on('load', handleLoadEvent);\n}\n\n/* ************** 4. Functions: ************** */\n\nfunction scrollToSectionNoAnimation() {\n    // onload if hash has a scrollTo param then scroll to section without animation.\n    var hashObj = url.hashParams;\n    if (hashObj) {\n        setTimeout(function() {\n            if (hashObj.scrollTo) { scrollToLink(hashObj, true); }\n            if (hashObj.clickElt) { clickElement(hashObj); }\n        }, 300);\n    }\n\n    // on hashchange: act upon the scrollTo and clickElt hash params\n    Modules.$win.on('hashchange', function() {\n        hashObj = url.hashParams;\n        if (hashObj.scrollTo) { scrollToLink(hashObj, false); }\n    });\n\n    // scroll hash handler\n    var scrollToLink = function(hashObj, onLoad) {\n        var offset = $('[data-id=\"' + hashObj.scrollTo + '\"]').offset(),\n            finalScrollPos = 0;\n        if(offset) {\n            finalScrollPos = Math.ceil(offset.top - $(\".sctn--page-nvgtn\").height() - 10);\n        }\n\n        if (onLoad) {\n            $(\"body\").scrollTop(finalScrollPos);\n            return;\n        }\n\n        if (hashObj && hashObj.scrollTo && $('[data-id=\"' + hashObj.scrollTo + '\"]').length) {\n            var $roots = $(\"html, body\");\n\n            $roots.on(\"scroll.inpageLink mousedown.inpageLink wheel.inpageLink DOMMouseScroll.inpageLink mousewheel.inpageLink keyup.inpageLink touchmove.inpageLink\", function() {\n                $roots.stop();\n            });\n\n            $roots.animate({ \"scrollTop\": finalScrollPos }, \"slow\", function() {\n                $roots.off(\"scroll.inpageLink mousedown.inpageLink wheel.inpageLink DOMMouseScroll.inpageLink mousewheel.inpageLink keyup.inpageLink touchmove.inpageLink\");\n            });\n        }\n    };\n\n    // click hash handler\n    var clickElement = function(hashObj) {\n        if (hashObj && hashObj.clickElt) {\n            $(hashObj.clickElt).trigger('click');\n        }\n    };\n\n    var $pageNav = $(\".sctn--page-nvgtn\");\n    if ($pageNav.length) {\n        var stickyPoint = Math.ceil($pageNav.offset().top);\n        Modules.$win.scroll(Modules.throttle(function() {\n            if (Math.ceil(Modules.$win.scrollTop()) > stickyPoint) {\n                $pageNav.addClass(\"sctn--stcky-nvgtn\");\n            } else {\n                $pageNav.removeClass(\"sctn--stcky-nvgtn\");\n            }\n        }, 100));\n    }\n\n    Modules.$doc.on(\"click\", \".js-inpg-link\", function(e) {\n        var $this = $(this);\n        if ($this.data(\"action\") === \"disabled\") return false;\n\n        if (!hashObj) hashObj = {};\n        hashObj.scrollTo = $this.data(\"href\");\n\n        url.hashParams = hashObj;\n        scrollToLink(hashObj);\n        e.preventDefault();\n    });\n\n    // scroll event handler\n    Modules.$doc.on(\"click\", \".js-inpg-link[data-href=user-reviews]\", function() {\n        // a/b testing for video reviews\n        // sending 1/5 of users to video reviews\n        // and remaining 4/5 of users to user reviews\n        var $this = $(this),\n            msp_uid = Modules.Cookie.get(\"msp_uid\");\n        if (msp_uid % 5 === 0) {\n            $this.data(\"href\", \"video-reviews\");\n            window.ga && ga(\"send\", \"event\", \"PDPReviewLink\", \"click\", \"video-reviews\");\n        } else {\n            window.ga && ga(\"send\", \"event\", \"PDPReviewLink\", \"click\", \"text-reviews\");\n        }\n    });\n}\n\n/* Old (compatibility reasons) functions start here: */\nfunction inpageLinking(id) {\n    if (id !== \"\" && id !== \"#\") {\n        try {\n            if ($(id).length) {\n                $('html, body').animate({\n                    \"scrollTop\": ($(id).offset().top - 90) + \"px\"\n                });\n            }\n        } catch (err) {\n            // Do nothing so far... wanna change that?\n        }\n    }\n}\n\nfunction handleHashChange() {\n    inpageLinking(window.location.hash);\n    return false;\n}\n\nfunction handleAnchorLinkClick(event) {\n    event.preventDefault();\n    inpageLinking($(this).attr('href'));\n}\n\nfunction handleLoadEvent() {\n    inpageLinking(window.location.hash);\n}\n/* Old function end here */","/* ************** 1. Classes/Objects/Variables: ************** */\n\nvar Popout = {\n    closePopout: function() {\n        $(\".js-wdgt-flt\").addClass(\"Popout-hide-animate\");\n        setTimeout(function() {\n            $(\".js-wdgt-flt\").remove();\n        }, 100);\n    },\n\n    storePopout: function(obj) {\n        //console.log(obj);\n        if (!$.isEmptyObject(obj)) {\n            localStorage.setItem(\"Popout\", JSON.stringify(obj));\n        } else {\n            return;\n        }\n    },\n    animateProgressBar: function(perc, timeTotal) {\n        var timer;\n        (function animateUpdate() {\n            if (perc < timeTotal) {\n                perc++;\n                updateProgress(perc, timeTotal);\n                timer = setTimeout(animateUpdate);\n                // $('.wdgt-tmr__inr-bg').addClass('wdgt-tmr__inr-bg-animate-long');\n            } else {\n                Popout.closePopout();\n            }\n        })();\n\n        function updateProgress(percentage, timeTotal) {\n            var x = (percentage / timeTotal) * 100;\n            $('.wdgt-tmr__inr-bg').css(\"width\", x + \"%\");\n        }\n    },\n    showPopout: function() {\n        var obj = getStorageData(\"local\", \"Popout\");\n        if (obj) {\n            obj = JSON.parse(obj);\n            var duration = obj.PopoutHide;\n            var position = obj.position;\n\n            if (position == \"bottom\") {\n                position = \"wdgt-flt-btm\";\n            }\n            var html = ['<div class=\"wdgt-flt js-wdgt-flt Popout-show-animate ' + position + '\">',\n                '<div class=\"wdgt-flt--cntnr\"><div class=\"wdgt-flt--cntnr__cls js-Popout-close\"> &times; </div>',\n                '<div class=\"wdgt-flt__ttl\">' + obj.title + '</div>',\n                '<div class=\"wdgt-flt__ttl--sub\">' + obj.subTitle + '</div>',\n                '<div class=\"wdgt-flt__bttns\">'\n            ];\n\n            if (obj.buttonCount == 2) {\n                html.push('<a href=\"#\" class=\"bttn bttn--blue wdgt-flt__bttn js-Popout-close bttn--two\">Close</a>');\n                html.push('<a href=\"' + obj.buttonUrl + '\"  class=\"bttn bttn--grn wdgt-flt__bttn js-wdgt-flt__bttn bttn--two\" target=\"_blank\">' + obj.buttonLabel + '</a>');\n            } else {\n                html.push('<a href=\"' + obj.buttonUrl + '\" target=\"_blank\" class=\"bttn bttn--grn wdgt-flt__bttn js-wdgt-flt__bttn\">' + obj.buttonLabel + '</a>');\n            }\n\n            html.push('</div>',\n                '</div>',\n                '<div class=\"wdgt-tmr\">',\n                '<div class=\"wdgt-tmr__inr-bg\"></div>',\n                '</div>',\n                '</div>'\n            );\n\n            $(\"body\").append(html.join(\"\"));\n            var perc = 0;\n            if (duration == \"short\") {\n                var timeTotal = 1000; // 5 * timeTotal =>  5 Second  \n                setTimeout(function() {\n                    Popout.animateProgressBar(perc, timeTotal);\n                }, 500)\n\n            } else if (duration == \"long\") {\n                var timeTotal = 2000; // 5 * timeTotal => 10 Second\n                setTimeout(function() {\n                    Popout.animateProgressBar(perc, timeTotal);\n                }, 500)\n            } else {\n                $(\".wdgt-tmr\").remove();\n\n            }\n        } else {\n\n            return;\n        }\n        localStorage.removeItem('Popout');\n    },\n    showPopout2: function() {\n        var obj = getStorageData(\"local\", \"Popout\");\n        if (obj) {\n            obj = JSON.parse(obj);\n            var duration = obj.PopoutHide;\n            var position = obj.position;\n\n            if (position == \"bottom\") {\n                position = \"wdgt-flt-btm\";\n            } else {\n                position = \"wdgt-flt\";\n            }\n            console.log(obj.utm_source);\n            var html = ['<div id=\"msp-container\" class=\"plgn-popup Popout-show-animate js-wdgt-flt ' + position + '\"> ',\n                '<div class=\"plgn-popup__innr-wrppr clearfix\">',\n                '<div class=\"plgn-popup__cls\"><span class=\"js-Popout-close\"></span></div>',\n                '<a href=\"' + obj.buttonUrl + '\" data-utmsource=\"' + obj.utm_source + '\"class=\"clearfix plgn-popup-link js-wdgt-flt__bttn\" title=\"Click to earn more on every purchase\" style=\"text-decoration:none\">',\n                '<div class=\"plgn-popup__bst-prc\">',\n                '<div class=\"plgn-popup__prc-ttl\">' + obj.title + '</div>',\n                '<div class=\"plgn-popup__prc-desc\">' + obj.subTitle + '</div>',\n                '<div class=\"plgn-popup__prc-val\"></div>',\n                '</div>',\n                '<div class=\"plgn-popup__send-to-store\">',\n                '<span>' + obj.buttonText + '</span>',\n                '<span class=\"msp_send_to_store_right_arrow\"></span>',\n                '</div>',\n                '<div class=\"privacy-policy\" style=\"position: absolute;right: 20px;bottom: 20px;\">',\n                '<a href=\"/privacy.html\" target=\"_blank\" style=\"color: #fff;\">Privacy Policy</a>',\n                '</div>',\n                '</a> '\n            ];\n\n            // html.push('<div class=\"info-text\"> Earn up to <span class=\"points\">570</span> Smart Points on Purchase </div> ');\n            html.push('</div> </div> ');\n            $(\"body\").append(html.join(\"\"));\n\n            $(document).on('click', '.js-wdgt-flt__bttn', function() {\n                Cookie.setCookie('pluginInstallSource', \"Installed by popout\", 20);\n            });\n            var perc = 0;\n            if (duration == \"short\") {\n                var timeTotal = 1000; // 5 * timeTotal =>  5 Second  \n                setTimeout(function() {\n                    Popout.animateProgressBar(perc, timeTotal);\n                }, 500)\n\n            } else if (duration == \"long\") {\n                var timeTotal = 2000; // 5 * timeTotal => 10 Second\n                setTimeout(function() {\n                    Popout.animateProgressBar(perc, timeTotal);\n                }, 500)\n            } else {\n                $(\".wdgt-tmr\").remove();\n\n            }\n        } else {\n\n            return;\n        }\n        localStorage.removeItem('Popout');\n    },\n    showQnAPopOut: function() {\n        var popup = {\n                position: 'top',\n                title: 'Have a Question about this Product?',\n                subTitle: 'Get answers from verified buyers',\n                url: 'qna',\n                label: 'ASK QUESTION'\n            },\n            position;\n\n        if ($(\".qna\").data(\"ttl-qstn\") >= 3) {\n            popup.label = $(\".qna\").data(\"ttl-qstn\") + \" Answered Questions\"\n        }\n\n        if (popup.position == \"bottom\") {\n            position = \"wdgt-flt-btm\";\n        } else {\n            position = \"wdgt-flt\";\n        }\n\n        var html = ['<div id=\"msp-container\" class=\"plgn-popup Popout-show-animate js-wdgt-flt ' + position + '\"> <div style=\"cursor:pointer\" data-href=\"' + popup.url + '\" class=\"plgn-popup__innr-wrppr js-inpg-link js-qpop-clck clearfix\"> <div class=\"plgn-popup__cls js-qpop-cls\"> <span class=\"js-Popout-close\"></span> </div> <a class=\"clearfix plgn-popup-link\" style=\"text-decoration:none\"> <div class=\"plgn-popup__bst-prc\"> <div class=\"plgn-popup__prc-ttl\">' + popup.title + '</div> <div class=\"plgn-popup__prc-desc\">' + popup.subTitle + '</div> <div class=\"plgn-popup__prc-val\"></div> </div> <div class=\"plgn-popup__send-to-store\"> <span>' + popup.label + '</span> <span class=\"msp_send_to_store_right_arrow\"></span> </div> </a> '];\n\n        $(\"body\").append(html.join(\"\"));\n\n        ga('send', 'event', 'QNA', 'pop-show', '', { nonInteraction: true })\n    }\n}\n\n/* ************** 2. Actions/Events: ************** */\n\nModules.$doc.on(\"click\", \".js-qpop-cls\", qPopCloseHandler);\nModules.$doc.on(\"click\", \".js-qpop-clck\", qPopClickHandler);\nModules.$doc.on(\"click\", \".js-wdgt-flt__bttn\", widgetFilterButtonHandler);\nModules.$doc.on(\"click\", \".js-Popout-close\", popoutCloseHandler);\n\n/* ************** 4. Functions: ************** */\n\nfunction qPopCloseHandler(e) {\n    var popData = localStorage.QNAPop ? JSON.parse(localStorage.QNAPop) : {},\n        mspid = dataLayer[0].mspid;\n\n    popData[mspid] = {\n        'lastClosed': new Date()\n    }\n\n    localStorage.QNAPop = JSON.stringify(popData);\n    e.stopPropagation();\n}\n\nfunction qPopClickHandler() {\n    ga('send', 'event', 'QNA', 'pop-click', '', { nonInteraction: true })\n    Popout.closePopout();\n}\n\nfunction widgetFilterButtonHandler(e) {\n    var obj = getStorageData(\"local\", \"Popout\");\n    var signupUTM = $(this).data(\"utmsource\");\n    //console.log(signupUTM);\n    Cookie.setCookieMins(\"signup-utm\", signupUTM, 2);\n    if (window.ga) {\n        ga(\"send\", \"event\", \"Loyalty\", signupUTM + \"clicked\", Modules.Cookie.get(\"msp_uid\") + \"\");\n    }\n    Popout.closePopout();\n}\n\nfunction popoutCloseHandler(e) {\n    if (window.ga) {\n        ga(\"send\", \"event\", \"Loyalty\", \"Popout closed clicked\", Modules.Cookie.get(\"msp_uid\") + \"\");\n    }\n    Popout.closePopout();\n    e.preventDefault();\n}","var _gPopStoreUrl = null;\n\n/* ************** 1. Classes/Objects/Variables: ************** */\n\nvar popupDataObj = {};\nvar autoPopupTimeout = 10000;\nvar pageLeaveTimeout = 4000;\n\nvar popupCallbackQueue = [];\nvar popupQueue = []\n\n/* ************** 2. Actions/Events: ************** */\n\nModules.$doc.on('click', '.popup-target, .js-popup-trgt', handlePopupTargetClick);\nModules.$doc.on('click', \".chrmcshbck-popup-target, .js-chrmcshbck-popup-trgt\", chromePluginPopupTarget); // pln CB offer  \n\n// This function is to be refactored when single page goes live:\nModules.$doc.on('click', \".loyalty-popup-target, .js-lylty-popup-trgt\", loyaltyPopupTarget);\n\n/* Old: */\nModules.$doc.on('click', '.popup-closebutton', function() { closePopup() });\nModules.$doc.on('click', '.popup-overlay', handlePopupOverlayClick);\n\n/* New: */\nModules.$doc.on('click', '.pop-up__cls-btn, .popup-optn__link.usr-inputbox__input--lnk', function() { closePopup_RUI() });\nModules.$doc.on('click', '.pop-up__ovrly', handlePopupOverlayClickRUI);\n\n/* autopopup processing start: */\nsetTimeout(function() {\n    openAutoPopup(); // open auto popup after autoPopupTimeout\n}, autoPopupTimeout);\n\nsetTimeout(function() {\n    pageLeavePopupBind(); // bind page leave auto popup after pageLeaveTimeout\n}, pageLeaveTimeout);\n/* autopopup processing end */\n\ngetAutopopupURL($(\".auto-popup-data\"));\n\n// Exit intent popup selection (search for plugin_id and not instatab):\nif (location.href.indexOf(\"/deals/promotions\") === -1 && !Modules.Cookie.get('plugin_id')) {\n    openPageLeaveGTSPopup();\n}\n\nsetPopUpCookie();\n\nModules.$doc.on(\"click\", \".js-open-link\", function() {\n    var $this = $(this),\n        url = $this.data(\"open-link\"),\n        inNewTab = $this.data(\"new-tab\"),\n        needLogin = $this.data(\"need-login\");\n\n    if (!url) return false;\n\n    function openLink() {\n        if (inNewTab === true) {\n            window.open(url);\n        } else {\n            window.location.href = url;\n        }\n    }\n\n    if (needLogin == true) {\n        if (getCookie(\"new_user\")) {\n            openPopup('/users/cp.html');\n            return true;\n        }\n        loginCallback(openLink, window, []);\n    } else {\n        openLink();\n    }\n\n    return false;\n});\n\n/* ************** 4. Functions: ************** */\n\nfunction closePopup() {\n    $('.popup-overlay').addClass('not-vsbl');\n    $('.popup-container').addClass('not-vsbl');\n    $('.popup-closebutton').addClass('not-vsbl');\n    setTimeout(function() {\n        $('.popup-overlay').remove();\n        $('.popup-container').remove();\n        $('.popup-closebutton').remove();\n    }, 400);\n    while (popupCallbackQueue.length > 0) {\n        (popupCallbackQueue.shift())();\n    }\n}\n\nfunction closePopup_RUI() {\n    $('.pop-up__ovrly').addClass('not-opq');\n    $('.pop-up__cntnr').addClass('not-opq');\n    setTimeout(function() {\n        $('.pop-up__ovrly').remove();\n        $('.pop-up__cntnr').remove();\n    }, 300);\n    while (popupCallbackQueue.length > 0) {\n        (popupCallbackQueue.shift())();\n    }\n}\n\nfunction popupQueueFn(fn, context, params) {\n    return function() {\n        fn.apply(context, params);\n    };\n}\n\n/* OLD::autopopup function */\nfunction openAutoPopup(pageLeave) {\n    if (!$(\".popup-overlay\").length) {\n        var $popupData = $(\"[data-autopopup]\");\n        if ($popupData.length) {\n            var popupUrl = $popupData.data(\"autopopup\");\n            if (popupUrl) {\n                if ($popupData.data(\"autopopup-login\") && (Modules.Cookie.get(\"msp_login_email\") || Modules.Cookie.get(\"msp_login\")))\n                    return;\n\n                //To be moved to attribute based categorization\n                openPopup(popupUrl + (pageLeave ? ((popupUrl.indexOf(\"?\") > -1 ? \"&\" : \"?\") + \"pl=1\") : \"\"), \"PromoA\");\n            }\n        }\n    }\n}\n\nfunction handlePopupTargetClick() {\n\n    if ($(this).parent(\".exprt-rvw__glry-thmbnl\").length != 0)\n        return false;\n\n    var $this = $(this),\n        popupUrl = $this.attr('href'),\n        storeUrl,\n        popupType = $this.data('promo');\n\n    popupDataObj = {\n        type: $this.data('popup-type')\n    }\n\n    if ($this.hasClass(\"js-wdgt-gts\")) {\n        window.ga && ga(\"send\", \"event\", \"Loyalty\", \"click\", \"lylty-deals-wdgt-cta\", \"1\");\n        var storeLink = $(this).data(\"url\");\n        window.open(storeLink, '_blank');\n\n        if (Modules.Cookie.get(\"msp_login\")) {\n            return true;\n        }\n        Modules.Cookie.setCookieMins(\"signup-utm\", $(this).data(\"utmsource\") || \"\", 2);\n    }\n\n    if ($this.is(\".prdct-dtl__tlbr-prc-alrt\")) {\n        if (handleStorePriceAlert($this)) {\n            return false;\n        }\n    }\n\n    if ($this.hasClass(\"js-prc-tbl__gts-btn\")) {\n        var cookieName = $this.data(\"cookiename\");\n        storeUrl = $this.data('url');\n\n        if (Modules.Cookie.get(cookieName)) {\n            window.open(storeUrl);\n            return true;\n        }\n\n        if ((Modules.Cookie.get('msp_login') || Modules.Cookie.get('partial_login')) && ($this.hasClass(\"js-check-email-cookie\") || ($this.hasClass(\"check-email-cookie\")))) {\n            window.open(storeUrl);\n            return true;\n        }\n\n        if (cookieName) {\n            var cookieTimeMins = parseInt($this.data(\"cookietimemins\"), 10),\n                cookieTimeDays = parseInt($this.data(\"cookietimedays\"), 10);\n            if (!isNaN(cookieTimeMins)) {\n                Modules.Cookie.set(cookieName, \"true\", cookieTimeMins);\n            } else if (!isNaN(cookieTimeDays)) {\n                Modules.Cookie.set(cookieName, \"true\", cookieTimeDays + \"d\");\n            }\n        }\n\n        Modules.Cookie.set('autoPopup', '1', \"1d\");\n    }\n\n    if (!popupUrl || popupUrl == \"#\" || $this.hasClass(\"storebutton\")) {\n        popupUrl = $this.data('href');\n    }\n    _gPopStoreUrl = storeUrl;\n\n    if (popupUrl && popupUrl !== \"#\") {\n        openPopup(popupUrl, popupType);\n    }\n\n    return false;\n}\n\nfunction chromePluginPopupTarget() {\n    var $this = $(this),\n        cookieName = $this.data(\"cookiename\"),\n        popupUrl = $this.data(\"href\"),\n        popupType = $this.data(\"promo\");\n\n    Modules.Cookie.set('autoPopup', '1', '1d');\n\n    if (Modules.Cookie.get(cookieName) === \"true\") {\n        window.open($this.data(\"url\"));\n        return false;\n    }\n\n    if (cookieName) {\n        var cookieTimeMins = parseInt($this.data(\"cookietimemins\"), 10),\n            cookieTimeDays = parseInt($this.data(\"cookietimedays\"), 10);\n\n        if (!isNaN(cookieTimeMins)) {\n            Modules.Cookie.set(cookieName, \"true\", cookieTimeMins);\n        } else if (!isNaN(cookieTimeDays)) {\n            Modules.Cookie.set(cookieName, \"true\", cookieTimeDays + 'd');\n        }\n    }\n\n\n    _gPopStoreUrl = $this.data('url');\n    openPopup(popupUrl, popupType);\n\n    return false;\n}\n\nfunction loyaltyPopupTarget() {\n    var $this = $(this),\n        isLoggedIn = Modules.Cookie.get(\"msp_login\"),\n        loyaltyOnBoarded = Modules.Cookie.get(\"hideLoyaltyOnBoarded\");\n        cookieName = $this.data(\"cookiename\"),\n        popupUrl = $this.data(\"href\"),\n        isMandatory = false;\n\n    Modules.Cookie.set('autoPopup', '1', 30);\n\n    // Make loyalty GTS popup mandatory in appliances to 50% users (even uids) if logged out\n    if (window.dataLayer && dataLayer[0].category === \"appliance\" && Modules.Cookie.get(\"msp_uid\") % 2 === 0) {\n        isMandatory = true;\n    } else if (Modules.Cookie.get(cookieName) === \"true\") {\n        window.open($this.data(\"url\"));\n        return true;\n    }\n\n    if (cookieName) {\n        var cookieTimeMins = parseInt($this.data(\"cookietimemins\"), 10),\n            cookieTimeDays = parseInt($this.data(\"cookietimedays\"), 10);\n\n        if (!isNaN(cookieTimeMins)) {\n            Modules.Cookie.set(cookieName, \"true\", cookieTimeMins);\n        } else if (!isNaN(cookieTimeDays)) {\n            Modules.Cookie.set(cookieName, \"true\", cookieTimeDays + 'd');\n        }\n    }\n\n    if (isMandatory && (isLoggedIn || Modules.Cookie.get(\"partial_login\"))) {\n        window.open($this.data(\"url\"));\n        return true;\n    } else if (isLoggedIn) {\n        if (!loyaltyOnBoarded) {\n            _gPopStoreUrl = $this.data(\"url\");\n            openPopup(popupUrl, \"PromoB\");\n        } else {\n            window.open($this.data(\"url\"));\n            return true;\n        }\n    } else {\n        _gPopStoreUrl = $this.data(\"url\");\n        openPopup(popupUrl, \"PromoB\");\n    }\n\n    return false;\n}\n\nfunction handlePopupOverlayClick() {\n    $link = $(\".popup-closebutton > a\");\n    if ($link[0] && $(this).hasClass(\"noclose\")) {\n        if ($link[0]) {\n            window.open($link.attr('href'), '_blank');\n        }\n        closePopup();\n    } else if (!$(this).hasClass(\"noclose\")) {\n        closePopup();\n    }\n}\n\nfunction handlePopupOverlayClickRUI() {\n    $link = $(\".pop-up__cls-btn > a\");\n    if ($link[0] && $(this).hasClass(\"noclose\")) {\n        if ($link[0]) {\n            window.open($link.attr('href'), '_blank');\n        }\n        closePopup_RUI();\n    } else if (!$(this).hasClass(\"noclose\")) {\n        closePopup_RUI();\n    }\n}\n\nfunction getAjaxDataSync(ajaxURL) {\n    var ajaxData;\n    $.ajax({\n        url: ajaxURL,\n        async: false\n    }).done(function(data) {\n        ajaxData = data;\n    });\n    return ajaxData;\n}\n\nfunction getBrowsePopupData() {\n    return getAjaxDataSync(\"/browse-menu.htm\");\n}\n\nfunction getPopupData(popupUrl) {\n    return getAjaxDataSync(popupUrl);\n}\n\n// should be isPromoPopupSeen\nfunction isPromoPopupShown(popupType) {\n\n    if (typeof(disablePromoPopup) !== \"undefined\" && disablePromoPopup) {\n        return true;\n    }\n\n\n    // promoB has higher priority than promoA\n    if ((Modules.Cookie.get('promo_a_shown') && popupType === \"PromoA\") || (Modules.Cookie.get('promo_b_shown') && popupType === \"PromoB\")) {\n        return true;\n    }\n\n    if (popupType == \"PromoA\") {\n        Modules.Cookie.set('promo_a_shown', 1, '1d'); // For a day\n    } else if (popupType == \"PromoB\") {\n        Modules.Cookie.set('promo_a_shown', 1, '1d'); // For a day\n        Modules.Cookie.set('promo_b_shown', 1, '1d'); // For a day\n    }\n    return false;\n}\n\nfunction popupCallback(fn, context, params) {\n    return function() {\n        fn.apply(context, params);\n    };\n}\n\nfunction openPopup(popupUrl, popupType) {\n\n    storeUrl = _gPopStoreUrl ? _gPopStoreUrl : null;\n    _gPopStoreUrl = null;\n\n    if ((popupType && (popupType === \"PromoA\" || popupType === \"PromoB\")) && isPromoPopupShown(popupType)) {\n        if (storeUrl) window.open(storeUrl, \"_blank\");\n        popupCallbackQueue = [];\n        return;\n    }\n\n    if (!Modules.Cookie.get('test_no_popup')) {\n        var popupData = getPopupData(popupUrl),\n            isForRUI = popupData.indexOf(\"pop-up__cntnr\") > 0;\n        \n        while (popupCallbackQueue.length > 0) {\n            (popupCallbackQueue.shift())();   \n        }\n\n        if (isForRUI) {\n            $('.pop-up__ovrly, .pop-up__cntnr').remove();\n\n            if (storeUrl) {\n                $('body').append([\n                    '<div class=\"pop-up__ovrly js-pop-up__ovrly not-opq noclose\"></div>',\n                    '<div class=\"pop-up__cntnr not-opq\"></div>'\n                ].join(\"\"));\n            } else {\n                $('body').append([\n                    '<div class=\"pop-up__ovrly js-pop-up__ovrly not-opq\"></div>',\n                    '<div class=\"pop-up__cntnr not-opq\"></div>'\n                ].join(\"\"));\n            }\n\n            var $popup = $(popupData),\n                $containers = $popup.filter(\".pop-up__cntnr\").add($popup.find(\".pop-up__cntnr\"));\n            $containers.each(function() {\n                $(this).addClass(\"not-opq\");\n            });\n            $(\".pop-up__cntnr\").replaceWith($popup);\n\n            if (storeUrl) {\n                $(\".pop-up__cntnr .pop-up__cls-btn\").replaceWith('<div class=\"pop-up__cls-btn js-pop-up__cls-btn\"><a href=\"' + storeUrl + '\" target=\"_blank\">&#10005;</a></div>');\n                $(\".pop-up__cntnr a.usr-inputbox__input--lnk\").attr({ href: storeUrl, target: \"_blank\" });\n            }\n\n            setTimeout((function() {\n                $(\".pop-up__ovrly, .pop-up__cntnr\").removeClass(\"not-opq\");\n            }), 200);\n        } else {\n            $(\".popup-overlay, .popup-container, .popup-closebutton\").remove();\n\n            if (storeUrl) {\n                $('body').append([\n                    '<div class=\"popup-overlay not-vsbl noclose\"></div>',\n                    '<div class=\"popup-container not-vsbl\">',\n                    '<div class=\"popup-closebutton not-vsbl\">',\n                    '<a href=\"' + storeUrl + '\" target=\"_blank\">&#10005;</a>',\n                    '</div>',\n                    '</div>'\n                ].join(\"\"));\n            } else {\n                $('body').append([\n                    '<div class=\"popup-overlay not-vsbl\"></div>',\n                    '<div class=\"popup-container not-vsbl\">',\n                    '<div class=\"popup-closebutton not-vsbl\">&#10005;</div>',\n                    '</div>'\n                ].join(\"\"));\n            }\n\n            setTimeout((function() {\n                $(\".popup-overlay, .popup-container\").removeClass(\"not-vsbl\");\n            }), 300);\n            setTimeout((function() {\n                $('.popup-closebutton').removeClass('not-vsbl');\n            }), 900);\n\n            $('.popup-container').append(popupData).css('width', $('.popup-inner-content').outerWidth());\n\n            if (storeUrl) {\n                $(\".popup-container .popup-skip a, .popup-container a.popup-submit\").attr(\"href\", storeUrl);\n            }\n        }\n    }\n}\n\nfunction openAutoPopupURL(url) {\n    if (Modules.Cookie.get('msp_login_email') || Modules.Cookie.get('msp_login')) return;\n\n    //To be moved to attribute based categorization\n    openPopup(url, \"PromoA\");\n    var msp_uid = Modules.Cookie.get(\"msp_uid\");\n    var msp_vid = Modules.Cookie.get(\"msp_vid\");\n    var overall_visits = Modules.Cookie.get(\"num_pages\");\n    var session_visits = Modules.Cookie.get(\"visit_num_pages\");\n    var gts_count = Modules.Cookie.get(\"gts_count\");\n    var transaction_count = Modules.Cookie.get(\"transaction_count\");\n    var popup_id = $(\".auto-popup-data\").data(\"popup_id\");\n    var experiment_id = $(\".auto-popup-data\").data(\"experimentid\");\n    var emailValue = encodeURIComponent($(\".popup-email\").val());\n    $.post(\"/users/popup_capture_user_details.php\", {\n        \"experiment_id\": experiment_id,\n        \"msp_uid\": msp_uid,\n        \"msp_vid\": msp_vid,\n        \"overall_visits\": overall_visits,\n        \"session_visits\": session_visits,\n        \"gts_count\": gts_count,\n        \"transaction_count\": transaction_count,\n        \"popup_id\": popup_id,\n        \"emailValue\": emailValue\n    }, function(data, status) {});\n}\n\nfunction getAutopopupURL($dataElement) {\n\n    if (Modules.Cookie.get(\"msp_login\") == 1) {\n        return;\n    }\n\n    if ($dataElement.length <= 0) {\n        return;\n    }\n    $popupData = $dataElement.data(\"popuprule\");\n\n\n    if ($popupData[\"first-visit\"] === true) {\n        if (Modules.Cookie.get(\"msp_uid\") == Modules.Cookie.get(\"msp_vid\")) {\n            $dataElement.data(\"popup_id\", $popupData[\"first-visit-id\"]);\n            openAutoPopupURL($popupData[\"first-visit-url\"]);\n            return;\n        }\n    }\n    if ($popupData[\"repeat-visit\"] === true) {\n        if (Modules.Cookie.get(\"msp_uid\") != Modules.Cookie.get(\"msp_vid\")) {\n            $dataElement.data(\"popup_id\", $popupData[\"repeat-visit-id\"]);\n            openAutoPopupURL($popupData[\"repeat-visit-url\"]);\n            return;\n        }\n    }\n    if ($popupData[\"pages-visited\"] === true) {\n        if (Modules.Cookie.get(\"visit_num_pages\") >= $popupData[\"pages-visited-count\"]) {\n            $dataElement.data(\"popup_id\", $popupData[\"pages-visited-id\"]);\n            openAutoPopupURL($popupData[\"pages-visited-url\"]);\n            return;\n        }\n    }\n    if ($popupData[\"time-spend\"] === true) {\n        if (parseInt(Modules.Cookie.get(\"active_time\")) >= parseInt($popupData[\"time-spend-count\"])) {\n            $dataElement.data(\"popup_id\", $popupData[\"time-spend-id\"]);\n            openAutoPopupURL($popupData[\"time-spend-url\"]);\n            return;\n        }\n    }\n    if ($popupData[\"scroll\"] === true) {\n        if (window.location.href.indexOf(\"msp\") !== -1 || window.location.href.indexOf(\"msf\") !== -1) {\n            Modules.$doc.on('scroll', function(e) {\n                if (Modules.$doc.scrollTop() >= Modules.$win.height()) {\n                    $dataElement.data(\"popup_id\", $popupData[\"scroll-id\"]);\n                    openAutoPopupURL($popupData[\"scroll-url\"]);\n                }\n            });\n        }\n    }\n    if ($popupData[\"gts-made\"] === true) {\n        if (Modules.Cookie.get(\"gts_count\") >= $popupData[\"gts-made-count\"]) {\n            $dataElement.data(\"popup_id\", $popupData[\"gts-made-id\"]);\n            openAutoPopupURL($popupData[\"gts-made-url\"]);\n            return;\n        }\n    }\n    if ($popupData[\"transaction\"] === true) {\n        if (Modules.Cookie.get(\"transaction_count\") >= $popupData[\"time-spend-count\"]) {\n            $dataElement.data(\"popup_id\", $popupData[\"transaction-id\"]);\n            openAutoPopupURL($popupData[\"transaction-url\"]);\n            return;\n        }\n    }\n}\n\nfunction pageLeavePopupBind() {\n    $('body').on('mouseleave', function(e) {\n        if (e.pageY < 5) openAutoPopup(true);\n    });\n}\n\n// Show loyalty education page-leave auto-popup\nfunction openPageLeaveGTSPopup() {\n    if (window.location.pathname.indexOf(\"/refurbished/\") !== 0 && $(\".prdct-dtl, .fltr-wrpr1\").length) {\n        var invalidSources = [\"pa-transact\", \"ps-transact\", \"browsing_pa_emailer\", \"browsing_ps_emailer\"];\n        if (url.getAQueryParam && invalidSources.indexOf(url.getAQueryParam('utm_source')) === -1) {\n            setTimeout(function() {\n                $(\"body\").on(\"mouseleave\", function(e) {\n                    if (e.pageY < 5 && !Modules.Cookie.get(\"msp_login\") && !$(\".pop-up__ovrly, .popup-overlay\").length) {\n                        openPopup(\"https://www.mysmartprice.com/loyalty/popup/gts.php?type=pageleave\", \"PromoB\");\n                    }\n                });\n            }, 5000);\n        }\n    }\n}\n\nfunction closeRefreshPopup() {\n    location.reload();\n}\n\nfunction openRefreshPagePopup() {\n    var refreshPagePopup = '<div onClick=\"closeRefreshPopup()\" style=\"position: fixed; top: 0px; z-index: 1000; cursor: pointer; left: 0px; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7);\">\\\n        <div style=\"position: relative; width: 100%; height: 100%;\">\\\n            <div style=\"position: absolute; padding: 10px; border-radius: 3px; top: 0px; left: 0px; right: 0px; bottom: 0px; height: 100px; width: 300px; margin: auto; background-color: white; cursor: auto;\">\\\n            <span style=\"position: absolute; top: -15px; right: -15px; cursor: pointer; color: #eee;\">&#10006;</span><p style=\"font-size: 16px;\">Please refresh the page after adding extension.</p>\\\n            <center><a class=\"bttn bttn--blue\" style=\"margin-top: 12px;\" href=\"' + window.location.href + '\">Refresh the Page</a></center>\\\n            </div>\\\n        </div>\\\n    </div>';\n    document.body.innerHTML += refreshPagePopup;\n}\n\nfunction setPopUpCookie() {\n    setTimeout(function() {\n        if (!Modules.Cookie.get('autoPopup')) {\n            var popupUrl = $('[data-autopopup]').data('autopopup');\n            openPopup(popupUrl);\n            Modules.Cookie.set('autoPopup', '1', '1d');\n        }\n    }, 5000);\n}\n","/* ************** 2. Actions/Events: ************** */\n\nModules.$doc.on('mouseenter', '.js-tltp', handleMouseEnter);\nModules.$doc.on('mouseleave', '.js-tltp', removeTooltip);\n\nModules.$doc.on(\"click\", \".js-msg-box-trgt\", showMessageBox);\nModules.$doc.on(\"click\", \".js-msg-box__cls\", hideMessageBox);\n\n/* ************** 4. Functions: ************** */\n\nfunction handleMouseEnter() {\n    $('.tltp').remove();\n    var $this = $(this),\n        data = $this.data('tooltip'),\n        tooltipDirection = $this.data('tooltip-direction') || \"tltp--top-left\";\n    if (data === \"\" || data === undefined) return;\n    $('body').append('<div class=\"tltp ' + tooltipDirection + '\">' + data + '</div>');\n    $tooltip = $('.tltp');\n\n    if ($(this).data('tooltip').length > 50) {\n        $tooltip.css({ 'font-size': '11px', 'line-height': '1.5' });\n    }\n\n    if (tooltipDirection === \"tltp--top-rght\") {\n        $tooltip.css('left', $this.offset().left - $tooltip.outerWidth() + $(this).outerWidth() + 4);\n        $tooltip.css('top', $this.offset().top - $tooltip.outerHeight() - 10);\n        if ($tooltip.offset().top - Modules.$win.scrollTop() < 0) {\n            $tooltip.removeClass(tooltipDirection).addClass('tltp--btm-rght');\n            $tooltip.css('top', $this.outerHeight() + $this.offset().top + 10);\n        }\n    } else if (tooltipDirection === \"tltp--top-left\") {\n        $tooltip.css('left', $this.offset().left - 4);\n        $tooltip.css('top', $this.offset().top - $tooltip.outerHeight() - 10);\n        if ($tooltip.offset().top - Modules.$win.scrollTop() < 0) {\n            $tooltip.removeClass(tooltipDirection).addClass('tltp--btm-left');\n            $tooltip.css('top', $this.outerHeight() + $this.offset().top + 10);\n        }\n    } else if (tooltipDirection === \"tltp--btm-rght\") {\n        $tooltip.css('left', $this.offset().left - $tooltip.outerWidth() + $(this).outerWidth() + 4);\n        $tooltip.css('top', $this.offset().top + $this.outerHeight() + 10);\n        if (Modules.$win.scrollTop() + Modules.$win.height() - $tooltip.offset().top < 0) {\n            $tooltip.removeClass(tooltipDirection).addClass('tltp--btm-rght');\n            $tooltip.css('top', $this.offset().top - $tooltip.outerHeight() - 10);\n        }\n    } else if (tooltipDirection === \"tltp--btm-left\") {\n        $tooltip.css('left', $this.offset().left - 4);\n        $tooltip.css('top', $this.offset().top + $this.outerHeight() + 10);\n        if (Modules.$win.scrollTop() + Modules.$win.height() - $tooltip.offset().top < 0) {\n            $tooltip.removeClass(tooltipDirection).addClass('tltp--btm-left');\n            $tooltip.css('top', $this.offset().top - $tooltip.outerHeight() - 10);\n        }\n    } else if (tooltipDirection === \"tltp--left\") {\n        $tooltip.css('left', $this.offset().left - $tooltip.width() - 30);\n        $tooltip.css('top', $this.offset().top + $this.outerHeight() / 2 - 10);\n    }\n}\n\nfunction removeTooltip() {\n    $('.tltp').remove();\n}\n\nfunction showMessageBox(e) {\n    if ($(e.target).hasClass(\"js-msg-box__cls\")) return false;\n\n    $(\".msg-box\").removeClass(\"msg-box--show\");\n    $(this).find(\".msg-box\").addClass(\"msg-box--show\");\n}\n\nfunction hideMessageBox() {\n    $(this).closest(\".msg-box\").removeClass(\"msg-box--show\");\n    return false;\n}"]}